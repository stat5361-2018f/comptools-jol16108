<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Advanced R</title>
  <meta name="description" content="The book is designed primarily for R users who want to improve their programming skills and understanding of the language. It should also be useful for programmers coming to R from other languages, as it explains some of R’s quirks and shows how some parts that seem horrible do have a positive side.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Advanced R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://adv-r.hadley.nz/" />
  <meta property="og:image" content="https://adv-r.hadley.nz/cover.png" />
  <meta property="og:description" content="The book is designed primarily for R users who want to improve their programming skills and understanding of the language. It should also be useful for programmers coming to R from other languages, as it explains some of R’s quirks and shows how some parts that seem horrible do have a positive side." />
  <meta name="github-repo" content="hadley/adv-r" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Advanced R" />
  <meta name="twitter:site" content="@hadley" />
  <meta name="twitter:description" content="The book is designed primarily for R users who want to improve their programming skills and understanding of the language. It should also be useful for programmers coming to R from other languages, as it explains some of R’s quirks and shows how some parts that seem horrible do have a positive side." />
  <meta name="twitter:image" content="https://adv-r.hadley.nz/cover.png" />

<meta name="author" content="Hadley Wickham">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="fp.html">
<link rel="next" href="function-factories.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="adv-r.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Advanced R</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#other-books"><i class="fa fa-check"></i>Other books</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i><b>1</b> Preface</a><ul>
<li class="chapter" data-level="1.1" data-path="preface.html"><a href="preface.html#rlang"><i class="fa fa-check"></i><b>1.1</b> rlang</a></li>
<li class="chapter" data-level="1.2" data-path="preface.html"><a href="preface.html#foundations"><i class="fa fa-check"></i><b>1.2</b> Foundations</a></li>
<li class="chapter" data-level="1.3" data-path="preface.html"><a href="preface.html#programming-paradigms"><i class="fa fa-check"></i><b>1.3</b> Programming paradigms</a></li>
<li class="chapter" data-level="1.4" data-path="preface.html"><a href="preface.html#techniques"><i class="fa fa-check"></i><b>1.4</b> Techniques</a></li>
<li class="chapter" data-level="1.5" data-path="preface.html"><a href="preface.html#removals"><i class="fa fa-check"></i><b>1.5</b> Removals</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#who-should-read"><i class="fa fa-check"></i><b>2.1</b> Who should read this book</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#related-work"><i class="fa fa-check"></i><b>2.2</b> Related work</a></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#what-you-will-get"><i class="fa fa-check"></i><b>2.3</b> What you will get out of this book</a></li>
<li class="chapter" data-level="2.4" data-path="introduction.html"><a href="introduction.html#meta-techniques"><i class="fa fa-check"></i><b>2.4</b> Meta-techniques</a></li>
<li class="chapter" data-level="2.5" data-path="introduction.html"><a href="introduction.html#recommended-reading"><i class="fa fa-check"></i><b>2.5</b> Recommended reading</a></li>
<li class="chapter" data-level="2.6" data-path="introduction.html"><a href="introduction.html#getting-help"><i class="fa fa-check"></i><b>2.6</b> Getting help</a></li>
<li class="chapter" data-level="2.7" data-path="introduction.html"><a href="introduction.html#intro-ack"><i class="fa fa-check"></i><b>2.7</b> Acknowledgments</a></li>
<li class="chapter" data-level="2.8" data-path="introduction.html"><a href="introduction.html#conventions"><i class="fa fa-check"></i><b>2.8</b> Conventions</a></li>
<li class="chapter" data-level="2.9" data-path="introduction.html"><a href="introduction.html#colophon"><i class="fa fa-check"></i><b>2.9</b> Colophon</a></li>
</ul></li>
<li class="part"><span><b>I Foundations</b></span></li>
<li class="chapter" data-level="" data-path="foundations-intro.html"><a href="foundations-intro.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="3" data-path="names-values.html"><a href="names-values.html"><i class="fa fa-check"></i><b>3</b> Names and values</a><ul>
<li class="chapter" data-level="3.1" data-path="names-values.html"><a href="names-values.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#quiz"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#sources"><i class="fa fa-check"></i>Sources</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="names-values.html"><a href="names-values.html#binding-basics"><i class="fa fa-check"></i><b>3.2</b> Binding basics</a><ul>
<li class="chapter" data-level="3.2.1" data-path="names-values.html"><a href="names-values.html#non-syntactic"><i class="fa fa-check"></i><b>3.2.1</b> Non-syntactic names</a></li>
<li class="chapter" data-level="3.2.2" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>3.2.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="names-values.html"><a href="names-values.html#copy-on-modify"><i class="fa fa-check"></i><b>3.3</b> Copy-on-modify</a><ul>
<li class="chapter" data-level="3.3.1" data-path="names-values.html"><a href="names-values.html#tracemem"><i class="fa fa-check"></i><b>3.3.1</b> <code>tracemem()</code></a></li>
<li class="chapter" data-level="3.3.2" data-path="names-values.html"><a href="names-values.html#function-calls"><i class="fa fa-check"></i><b>3.3.2</b> Function calls</a></li>
<li class="chapter" data-level="3.3.3" data-path="names-values.html"><a href="names-values.html#list-references"><i class="fa fa-check"></i><b>3.3.3</b> Lists</a></li>
<li class="chapter" data-level="3.3.4" data-path="names-values.html"><a href="names-values.html#df-modify"><i class="fa fa-check"></i><b>3.3.4</b> Data frames</a></li>
<li class="chapter" data-level="3.3.5" data-path="names-values.html"><a href="names-values.html#character-vectors"><i class="fa fa-check"></i><b>3.3.5</b> Character vectors</a></li>
<li class="chapter" data-level="3.3.6" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>3.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="names-values.html"><a href="names-values.html#object-size"><i class="fa fa-check"></i><b>3.4</b> Object size</a><ul>
<li class="chapter" data-level="3.4.1" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>3.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="names-values.html"><a href="names-values.html#modify-in-place"><i class="fa fa-check"></i><b>3.5</b> Modify-in-place</a><ul>
<li class="chapter" data-level="3.5.1" data-path="names-values.html"><a href="names-values.html#single-binding"><i class="fa fa-check"></i><b>3.5.1</b> Objects with a single binding</a></li>
<li class="chapter" data-level="3.5.2" data-path="names-values.html"><a href="names-values.html#env-modify"><i class="fa fa-check"></i><b>3.5.2</b> Environments</a></li>
<li class="chapter" data-level="3.5.3" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>3.5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="names-values.html"><a href="names-values.html#gc"><i class="fa fa-check"></i><b>3.6</b> Unbinding and the garbage collector</a></li>
<li class="chapter" data-level="3.7" data-path="names-values.html"><a href="names-values.html#names-values-answers"><i class="fa fa-check"></i><b>3.7</b> Answers</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="vectors-chap.html"><a href="vectors-chap.html"><i class="fa fa-check"></i><b>4</b> Vectors</a><ul>
<li class="chapter" data-level="4.1" data-path="vectors-chap.html"><a href="vectors-chap.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="vectors-chap.html"><a href="vectors-chap.html#quiz-1"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="vectors-chap.html"><a href="vectors-chap.html#outline-1"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="vectors-chap.html"><a href="vectors-chap.html#atomic-vectors"><i class="fa fa-check"></i><b>4.2</b> Atomic vectors</a><ul>
<li class="chapter" data-level="4.2.1" data-path="vectors-chap.html"><a href="vectors-chap.html#scalars"><i class="fa fa-check"></i><b>4.2.1</b> Scalars</a></li>
<li class="chapter" data-level="4.2.2" data-path="vectors-chap.html"><a href="vectors-chap.html#atomic-constructing"><i class="fa fa-check"></i><b>4.2.2</b> Making longer vectors with <code>c()</code></a></li>
<li class="chapter" data-level="4.2.3" data-path="vectors-chap.html"><a href="vectors-chap.html#testing-and-coercing"><i class="fa fa-check"></i><b>4.2.3</b> Testing and coercing</a></li>
<li class="chapter" data-level="4.2.4" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-4"><i class="fa fa-check"></i><b>4.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="vectors-chap.html"><a href="vectors-chap.html#attributes"><i class="fa fa-check"></i><b>4.3</b> Attributes</a><ul>
<li class="chapter" data-level="4.3.1" data-path="vectors-chap.html"><a href="vectors-chap.html#getting-and-setting"><i class="fa fa-check"></i><b>4.3.1</b> Getting and setting</a></li>
<li class="chapter" data-level="4.3.2" data-path="vectors-chap.html"><a href="vectors-chap.html#attr-names"><i class="fa fa-check"></i><b>4.3.2</b> Names</a></li>
<li class="chapter" data-level="4.3.3" data-path="vectors-chap.html"><a href="vectors-chap.html#attr-dims"><i class="fa fa-check"></i><b>4.3.3</b> Dimensions</a></li>
<li class="chapter" data-level="4.3.4" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-5"><i class="fa fa-check"></i><b>4.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="vectors-chap.html"><a href="vectors-chap.html#s3-atomic-vectors"><i class="fa fa-check"></i><b>4.4</b> S3 atomic vectors</a><ul>
<li class="chapter" data-level="4.4.1" data-path="vectors-chap.html"><a href="vectors-chap.html#factors"><i class="fa fa-check"></i><b>4.4.1</b> Factors</a></li>
<li class="chapter" data-level="4.4.2" data-path="vectors-chap.html"><a href="vectors-chap.html#dates"><i class="fa fa-check"></i><b>4.4.2</b> Dates</a></li>
<li class="chapter" data-level="4.4.3" data-path="vectors-chap.html"><a href="vectors-chap.html#date-times"><i class="fa fa-check"></i><b>4.4.3</b> Date-times</a></li>
<li class="chapter" data-level="4.4.4" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-6"><i class="fa fa-check"></i><b>4.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="vectors-chap.html"><a href="vectors-chap.html#lists"><i class="fa fa-check"></i><b>4.5</b> Lists</a><ul>
<li class="chapter" data-level="4.5.1" data-path="vectors-chap.html"><a href="vectors-chap.html#list-creating"><i class="fa fa-check"></i><b>4.5.1</b> Creating</a></li>
<li class="chapter" data-level="4.5.2" data-path="vectors-chap.html"><a href="vectors-chap.html#list-types"><i class="fa fa-check"></i><b>4.5.2</b> Testing and coercing</a></li>
<li class="chapter" data-level="4.5.3" data-path="vectors-chap.html"><a href="vectors-chap.html#list-array"><i class="fa fa-check"></i><b>4.5.3</b> Matrices and arrays</a></li>
<li class="chapter" data-level="4.5.4" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-7"><i class="fa fa-check"></i><b>4.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="vectors-chap.html"><a href="vectors-chap.html#tibble"><i class="fa fa-check"></i><b>4.6</b> Data frames and tibbles</a><ul>
<li class="chapter" data-level="4.6.1" data-path="vectors-chap.html"><a href="vectors-chap.html#df-create"><i class="fa fa-check"></i><b>4.6.1</b> Creating</a></li>
<li class="chapter" data-level="4.6.2" data-path="vectors-chap.html"><a href="vectors-chap.html#rownames"><i class="fa fa-check"></i><b>4.6.2</b> Row names</a></li>
<li class="chapter" data-level="4.6.3" data-path="vectors-chap.html"><a href="vectors-chap.html#printing"><i class="fa fa-check"></i><b>4.6.3</b> Printing</a></li>
<li class="chapter" data-level="4.6.4" data-path="vectors-chap.html"><a href="vectors-chap.html#safe-subsetting"><i class="fa fa-check"></i><b>4.6.4</b> Subsetting</a></li>
<li class="chapter" data-level="4.6.5" data-path="vectors-chap.html"><a href="vectors-chap.html#df-test-coerce"><i class="fa fa-check"></i><b>4.6.5</b> Testing and coercing</a></li>
<li class="chapter" data-level="4.6.6" data-path="vectors-chap.html"><a href="vectors-chap.html#list-columns"><i class="fa fa-check"></i><b>4.6.6</b> List columns</a></li>
<li class="chapter" data-level="4.6.7" data-path="vectors-chap.html"><a href="vectors-chap.html#matrix-and-data-frame-columns"><i class="fa fa-check"></i><b>4.6.7</b> Matrix and data frame columns</a></li>
<li class="chapter" data-level="4.6.8" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-8"><i class="fa fa-check"></i><b>4.6.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="vectors-chap.html"><a href="vectors-chap.html#null"><i class="fa fa-check"></i><b>4.7</b> <code>NULL</code></a></li>
<li class="chapter" data-level="4.8" data-path="vectors-chap.html"><a href="vectors-chap.html#data-structure-answers"><i class="fa fa-check"></i><b>4.8</b> Answers</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="subsetting.html"><a href="subsetting.html"><i class="fa fa-check"></i><b>5</b> Subsetting</a><ul>
<li class="chapter" data-level="5.1" data-path="subsetting.html"><a href="subsetting.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#quiz-2"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#outline-2"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="subsetting.html"><a href="subsetting.html#subset-multiple"><i class="fa fa-check"></i><b>5.2</b> Selecting multiple elements</a><ul>
<li class="chapter" data-level="5.2.1" data-path="subsetting.html"><a href="subsetting.html#atomic-vectors-1"><i class="fa fa-check"></i><b>5.2.1</b> Atomic vectors</a></li>
<li class="chapter" data-level="5.2.2" data-path="subsetting.html"><a href="subsetting.html#lists-1"><i class="fa fa-check"></i><b>5.2.2</b> Lists</a></li>
<li class="chapter" data-level="5.2.3" data-path="subsetting.html"><a href="subsetting.html#matrix-subsetting"><i class="fa fa-check"></i><b>5.2.3</b> Matrices and arrays</a></li>
<li class="chapter" data-level="5.2.4" data-path="subsetting.html"><a href="subsetting.html#df-subsetting"><i class="fa fa-check"></i><b>5.2.4</b> Data frames and tibbles</a></li>
<li class="chapter" data-level="5.2.5" data-path="subsetting.html"><a href="subsetting.html#simplify-preserve"><i class="fa fa-check"></i><b>5.2.5</b> Preserving dimensionality</a></li>
<li class="chapter" data-level="5.2.6" data-path="subsetting.html"><a href="subsetting.html#exercises-9"><i class="fa fa-check"></i><b>5.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="subsetting.html"><a href="subsetting.html#subset-single"><i class="fa fa-check"></i><b>5.3</b> Selecting a single element</a><ul>
<li class="chapter" data-level="5.3.1" data-path="subsetting.html"><a href="subsetting.html#section"><i class="fa fa-check"></i><b>5.3.1</b> <code>[[</code></a></li>
<li class="chapter" data-level="5.3.2" data-path="subsetting.html"><a href="subsetting.html#section-1"><i class="fa fa-check"></i><b>5.3.2</b> <code>$</code></a></li>
<li class="chapter" data-level="5.3.3" data-path="subsetting.html"><a href="subsetting.html#missingout-of-bounds-indices"><i class="fa fa-check"></i><b>5.3.3</b> Missing/out of bounds indices</a></li>
<li class="chapter" data-level="5.3.4" data-path="subsetting.html"><a href="subsetting.html#and-slot"><i class="fa fa-check"></i><b>5.3.4</b> <code>@</code> and <code>slot()</code></a></li>
<li class="chapter" data-level="5.3.5" data-path="subsetting.html"><a href="subsetting.html#exercises-10"><i class="fa fa-check"></i><b>5.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="subsetting.html"><a href="subsetting.html#subassignment"><i class="fa fa-check"></i><b>5.4</b> Subsetting and assignment</a></li>
<li class="chapter" data-level="5.5" data-path="subsetting.html"><a href="subsetting.html#applications"><i class="fa fa-check"></i><b>5.5</b> Applications</a><ul>
<li class="chapter" data-level="5.5.1" data-path="subsetting.html"><a href="subsetting.html#lookup-tables"><i class="fa fa-check"></i><b>5.5.1</b> Lookup tables (character subsetting)</a></li>
<li class="chapter" data-level="5.5.2" data-path="subsetting.html"><a href="subsetting.html#matching-merging"><i class="fa fa-check"></i><b>5.5.2</b> Matching and merging by hand (integer subsetting)</a></li>
<li class="chapter" data-level="5.5.3" data-path="subsetting.html"><a href="subsetting.html#random-samplesbootstraps-integer-subsetting"><i class="fa fa-check"></i><b>5.5.3</b> Random samples/bootstraps (integer subsetting)</a></li>
<li class="chapter" data-level="5.5.4" data-path="subsetting.html"><a href="subsetting.html#ordering-integer-subsetting"><i class="fa fa-check"></i><b>5.5.4</b> Ordering (integer subsetting)</a></li>
<li class="chapter" data-level="5.5.5" data-path="subsetting.html"><a href="subsetting.html#expanding-aggregated-counts-integer-subsetting"><i class="fa fa-check"></i><b>5.5.5</b> Expanding aggregated counts (integer subsetting)</a></li>
<li class="chapter" data-level="5.5.6" data-path="subsetting.html"><a href="subsetting.html#removing-columns-from-data-frames-character-subsetting"><i class="fa fa-check"></i><b>5.5.6</b> Removing columns from data frames (character subsetting)</a></li>
<li class="chapter" data-level="5.5.7" data-path="subsetting.html"><a href="subsetting.html#selecting-rows-based-on-a-condition-logical-subsetting"><i class="fa fa-check"></i><b>5.5.7</b> Selecting rows based on a condition (logical subsetting)</a></li>
<li class="chapter" data-level="5.5.8" data-path="subsetting.html"><a href="subsetting.html#boolean-algebra-vs.sets-logical-integer-subsetting"><i class="fa fa-check"></i><b>5.5.8</b> Boolean algebra vs. sets (logical &amp; integer subsetting)</a></li>
<li class="chapter" data-level="5.5.9" data-path="subsetting.html"><a href="subsetting.html#exercises-11"><i class="fa fa-check"></i><b>5.5.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="subsetting.html"><a href="subsetting.html#subsetting-answers"><i class="fa fa-check"></i><b>5.6</b> Answers</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>6</b> Functions</a><ul>
<li class="chapter" data-level="6.1" data-path="functions.html"><a href="functions.html#introduction-4"><i class="fa fa-check"></i><b>6.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#quiz-3"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#outline-3"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="functions.html"><a href="functions.html#function-fundamentals"><i class="fa fa-check"></i><b>6.2</b> Function fundamentals</a><ul>
<li class="chapter" data-level="6.2.1" data-path="functions.html"><a href="functions.html#first-class-functions"><i class="fa fa-check"></i><b>6.2.1</b> First-class functions</a></li>
<li class="chapter" data-level="6.2.2" data-path="functions.html"><a href="functions.html#function-components"><i class="fa fa-check"></i><b>6.2.2</b> Function components</a></li>
<li class="chapter" data-level="6.2.3" data-path="functions.html"><a href="functions.html#primitive-functions"><i class="fa fa-check"></i><b>6.2.3</b> Primitive functions</a></li>
<li class="chapter" data-level="6.2.4" data-path="functions.html"><a href="functions.html#exercises-12"><i class="fa fa-check"></i><b>6.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="functions.html"><a href="functions.html#lexical-scoping"><i class="fa fa-check"></i><b>6.3</b> Lexical scoping</a><ul>
<li class="chapter" data-level="6.3.1" data-path="functions.html"><a href="functions.html#name-masking"><i class="fa fa-check"></i><b>6.3.1</b> Name masking</a></li>
<li class="chapter" data-level="6.3.2" data-path="functions.html"><a href="functions.html#functions-vs.variables"><i class="fa fa-check"></i><b>6.3.2</b> Functions vs. variables</a></li>
<li class="chapter" data-level="6.3.3" data-path="functions.html"><a href="functions.html#fresh-start"><i class="fa fa-check"></i><b>6.3.3</b> A fresh start</a></li>
<li class="chapter" data-level="6.3.4" data-path="functions.html"><a href="functions.html#dynamic-lookup"><i class="fa fa-check"></i><b>6.3.4</b> Dynamic lookup</a></li>
<li class="chapter" data-level="6.3.5" data-path="functions.html"><a href="functions.html#exercises-13"><i class="fa fa-check"></i><b>6.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="functions.html"><a href="functions.html#lazy-evaluation"><i class="fa fa-check"></i><b>6.4</b> Lazy evaluation</a><ul>
<li class="chapter" data-level="6.4.1" data-path="functions.html"><a href="functions.html#forcing-evaluation"><i class="fa fa-check"></i><b>6.4.1</b> Forcing evaluation</a></li>
<li class="chapter" data-level="6.4.2" data-path="functions.html"><a href="functions.html#promises"><i class="fa fa-check"></i><b>6.4.2</b> Promises</a></li>
<li class="chapter" data-level="6.4.3" data-path="functions.html"><a href="functions.html#default-arguments"><i class="fa fa-check"></i><b>6.4.3</b> Default arguments</a></li>
<li class="chapter" data-level="6.4.4" data-path="functions.html"><a href="functions.html#missing-arguments"><i class="fa fa-check"></i><b>6.4.4</b> Missing arguments</a></li>
<li class="chapter" data-level="6.4.5" data-path="functions.html"><a href="functions.html#exercises-14"><i class="fa fa-check"></i><b>6.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="functions.html"><a href="functions.html#fun-dot-dot-dot"><i class="fa fa-check"></i><b>6.5</b> <code>...</code> (dot-dot-dot)</a><ul>
<li class="chapter" data-level="6.5.1" data-path="functions.html"><a href="functions.html#exercises-15"><i class="fa fa-check"></i><b>6.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="functions.html"><a href="functions.html#exiting-a-function"><i class="fa fa-check"></i><b>6.6</b> Exiting a function</a><ul>
<li class="chapter" data-level="6.6.1" data-path="functions.html"><a href="functions.html#implicit-vs.explict-returns"><i class="fa fa-check"></i><b>6.6.1</b> Implicit vs. explict returns</a></li>
<li class="chapter" data-level="6.6.2" data-path="functions.html"><a href="functions.html#invisible-values"><i class="fa fa-check"></i><b>6.6.2</b> Invisible values</a></li>
<li class="chapter" data-level="6.6.3" data-path="functions.html"><a href="functions.html#errors"><i class="fa fa-check"></i><b>6.6.3</b> Errors</a></li>
<li class="chapter" data-level="6.6.4" data-path="functions.html"><a href="functions.html#on-exit"><i class="fa fa-check"></i><b>6.6.4</b> Exit handlers</a></li>
<li class="chapter" data-level="6.6.5" data-path="functions.html"><a href="functions.html#exercises-16"><i class="fa fa-check"></i><b>6.6.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="functions.html"><a href="functions.html#function-forms"><i class="fa fa-check"></i><b>6.7</b> Function forms</a><ul>
<li class="chapter" data-level="6.7.1" data-path="functions.html"><a href="functions.html#rewriting-to-prefix-form"><i class="fa fa-check"></i><b>6.7.1</b> Rewriting to prefix form</a></li>
<li class="chapter" data-level="6.7.2" data-path="functions.html"><a href="functions.html#prefix-form-prefix-form"><i class="fa fa-check"></i><b>6.7.2</b> Prefix form {prefix-form}</a></li>
<li class="chapter" data-level="6.7.3" data-path="functions.html"><a href="functions.html#infix-functions"><i class="fa fa-check"></i><b>6.7.3</b> Infix functions</a></li>
<li class="chapter" data-level="6.7.4" data-path="functions.html"><a href="functions.html#replacement-functions"><i class="fa fa-check"></i><b>6.7.4</b> Replacement functions</a></li>
<li class="chapter" data-level="6.7.5" data-path="functions.html"><a href="functions.html#special-forms"><i class="fa fa-check"></i><b>6.7.5</b> Special forms</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="functions.html"><a href="functions.html#invoking-a-function"><i class="fa fa-check"></i><b>6.8</b> Invoking a function</a><ul>
<li class="chapter" data-level="6.8.1" data-path="functions.html"><a href="functions.html#exercises-17"><i class="fa fa-check"></i><b>6.8.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="functions.html"><a href="functions.html#function-answers"><i class="fa fa-check"></i><b>6.9</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="environments.html"><a href="environments.html"><i class="fa fa-check"></i><b>7</b> Environments</a><ul>
<li class="chapter" data-level="7.1" data-path="environments.html"><a href="environments.html#introduction-5"><i class="fa fa-check"></i><b>7.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#quiz-4"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#outline-4"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#prerequisites-1"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="environments.html"><a href="environments.html#env-basics"><i class="fa fa-check"></i><b>7.2</b> Environment basics</a><ul>
<li class="chapter" data-level="7.2.1" data-path="environments.html"><a href="environments.html#basics"><i class="fa fa-check"></i><b>7.2.1</b> Basics</a></li>
<li class="chapter" data-level="7.2.2" data-path="environments.html"><a href="environments.html#important-environments"><i class="fa fa-check"></i><b>7.2.2</b> Important environments</a></li>
<li class="chapter" data-level="7.2.3" data-path="environments.html"><a href="environments.html#parents"><i class="fa fa-check"></i><b>7.2.3</b> Parents</a></li>
<li class="chapter" data-level="7.2.4" data-path="environments.html"><a href="environments.html#getting-and-setting-1"><i class="fa fa-check"></i><b>7.2.4</b> Getting and setting</a></li>
<li class="chapter" data-level="7.2.5" data-path="environments.html"><a href="environments.html#finalisers"><i class="fa fa-check"></i><b>7.2.5</b> Finalisers</a></li>
<li class="chapter" data-level="7.2.6" data-path="environments.html"><a href="environments.html#advanced-bindings"><i class="fa fa-check"></i><b>7.2.6</b> Advanced bindings</a></li>
<li class="chapter" data-level="7.2.7" data-path="environments.html"><a href="environments.html#exercises-18"><i class="fa fa-check"></i><b>7.2.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="environments.html"><a href="environments.html#env-recursion"><i class="fa fa-check"></i><b>7.3</b> Recursing over environments</a><ul>
<li class="chapter" data-level="7.3.1" data-path="environments.html"><a href="environments.html#exercises-19"><i class="fa fa-check"></i><b>7.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="environments.html"><a href="environments.html#function-envs"><i class="fa fa-check"></i><b>7.4</b> Special environments</a><ul>
<li class="chapter" data-level="7.4.1" data-path="environments.html"><a href="environments.html#package-environments-and-the-search-path"><i class="fa fa-check"></i><b>7.4.1</b> Package environments and the search path</a></li>
<li class="chapter" data-level="7.4.2" data-path="environments.html"><a href="environments.html#the-function-environment"><i class="fa fa-check"></i><b>7.4.2</b> The function environment</a></li>
<li class="chapter" data-level="7.4.3" data-path="environments.html"><a href="environments.html#namespaces"><i class="fa fa-check"></i><b>7.4.3</b> Namespaces</a></li>
<li class="chapter" data-level="7.4.4" data-path="environments.html"><a href="environments.html#execution-environments"><i class="fa fa-check"></i><b>7.4.4</b> Execution environments</a></li>
<li class="chapter" data-level="7.4.5" data-path="environments.html"><a href="environments.html#exercises-20"><i class="fa fa-check"></i><b>7.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="environments.html"><a href="environments.html#the-call-stack"><i class="fa fa-check"></i><b>7.5</b> The call stack</a><ul>
<li class="chapter" data-level="7.5.1" data-path="environments.html"><a href="environments.html#simple-call-stacks"><i class="fa fa-check"></i><b>7.5.1</b> Simple call stacks</a></li>
<li class="chapter" data-level="7.5.2" data-path="environments.html"><a href="environments.html#lazy-evaluation-1"><i class="fa fa-check"></i><b>7.5.2</b> Lazy evaluation</a></li>
<li class="chapter" data-level="7.5.3" data-path="environments.html"><a href="environments.html#frames"><i class="fa fa-check"></i><b>7.5.3</b> Frames</a></li>
<li class="chapter" data-level="7.5.4" data-path="environments.html"><a href="environments.html#dynamic-scope"><i class="fa fa-check"></i><b>7.5.4</b> Dynamic scope</a></li>
<li class="chapter" data-level="7.5.5" data-path="environments.html"><a href="environments.html#exercises-21"><i class="fa fa-check"></i><b>7.5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="environments.html"><a href="environments.html#explicit-envs"><i class="fa fa-check"></i><b>7.6</b> As data structures</a></li>
<li class="chapter" data-level="7.7" data-path="environments.html"><a href="environments.html#section-2"><i class="fa fa-check"></i><b>7.7</b> <code>&lt;&lt;-</code></a><ul>
<li class="chapter" data-level="7.7.1" data-path="environments.html"><a href="environments.html#exercises-22"><i class="fa fa-check"></i><b>7.7.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="environments.html"><a href="environments.html#env-answers"><i class="fa fa-check"></i><b>7.8</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditions.html"><a href="conditions.html"><i class="fa fa-check"></i><b>8</b> Conditions</a><ul>
<li class="chapter" data-level="8.1" data-path="conditions.html"><a href="conditions.html#introduction-6"><i class="fa fa-check"></i><b>8.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#quiz-5"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#overview"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="8.1.1" data-path="conditions.html"><a href="conditions.html#prerequisites-2"><i class="fa fa-check"></i><b>8.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditions.html"><a href="conditions.html#signalling-conditions"><i class="fa fa-check"></i><b>8.2</b> Signalling conditions</a><ul>
<li class="chapter" data-level="8.2.1" data-path="conditions.html"><a href="conditions.html#errors-1"><i class="fa fa-check"></i><b>8.2.1</b> Errors</a></li>
<li class="chapter" data-level="8.2.2" data-path="conditions.html"><a href="conditions.html#warnings"><i class="fa fa-check"></i><b>8.2.2</b> Warnings</a></li>
<li class="chapter" data-level="8.2.3" data-path="conditions.html"><a href="conditions.html#messages"><i class="fa fa-check"></i><b>8.2.3</b> Messages</a></li>
<li class="chapter" data-level="8.2.4" data-path="conditions.html"><a href="conditions.html#exercises-23"><i class="fa fa-check"></i><b>8.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="conditions.html"><a href="conditions.html#ignoring-conditions"><i class="fa fa-check"></i><b>8.3</b> Ignoring conditions</a></li>
<li class="chapter" data-level="8.4" data-path="conditions.html"><a href="conditions.html#handling-conditions"><i class="fa fa-check"></i><b>8.4</b> Handling conditions</a><ul>
<li class="chapter" data-level="8.4.1" data-path="conditions.html"><a href="conditions.html#condition-objects"><i class="fa fa-check"></i><b>8.4.1</b> Condition objects</a></li>
<li class="chapter" data-level="8.4.2" data-path="conditions.html"><a href="conditions.html#exiting-handlers"><i class="fa fa-check"></i><b>8.4.2</b> Exiting handlers</a></li>
<li class="chapter" data-level="8.4.3" data-path="conditions.html"><a href="conditions.html#calling-handlers"><i class="fa fa-check"></i><b>8.4.3</b> Calling handlers</a></li>
<li class="chapter" data-level="8.4.4" data-path="conditions.html"><a href="conditions.html#call-stacks"><i class="fa fa-check"></i><b>8.4.4</b> Call stacks</a></li>
<li class="chapter" data-level="8.4.5" data-path="conditions.html"><a href="conditions.html#exercises-24"><i class="fa fa-check"></i><b>8.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="conditions.html"><a href="conditions.html#custom-conditions"><i class="fa fa-check"></i><b>8.5</b> Custom conditions</a><ul>
<li class="chapter" data-level="8.5.1" data-path="conditions.html"><a href="conditions.html#motivation"><i class="fa fa-check"></i><b>8.5.1</b> Motivation</a></li>
<li class="chapter" data-level="8.5.2" data-path="conditions.html"><a href="conditions.html#signalling"><i class="fa fa-check"></i><b>8.5.2</b> Signalling</a></li>
<li class="chapter" data-level="8.5.3" data-path="conditions.html"><a href="conditions.html#handling"><i class="fa fa-check"></i><b>8.5.3</b> Handling</a></li>
<li class="chapter" data-level="8.5.4" data-path="conditions.html"><a href="conditions.html#exercises-25"><i class="fa fa-check"></i><b>8.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="conditions.html"><a href="conditions.html#condition-applications"><i class="fa fa-check"></i><b>8.6</b> Applications</a><ul>
<li class="chapter" data-level="8.6.1" data-path="conditions.html"><a href="conditions.html#failure-value"><i class="fa fa-check"></i><b>8.6.1</b> Failure value</a></li>
<li class="chapter" data-level="8.6.2" data-path="conditions.html"><a href="conditions.html#success-and-failure-values"><i class="fa fa-check"></i><b>8.6.2</b> Success and failure values</a></li>
<li class="chapter" data-level="8.6.3" data-path="conditions.html"><a href="conditions.html#resignal"><i class="fa fa-check"></i><b>8.6.3</b> Resignal</a></li>
<li class="chapter" data-level="8.6.4" data-path="conditions.html"><a href="conditions.html#record"><i class="fa fa-check"></i><b>8.6.4</b> Record</a></li>
<li class="chapter" data-level="8.6.5" data-path="conditions.html"><a href="conditions.html#no-default-behaviour"><i class="fa fa-check"></i><b>8.6.5</b> No default behaviour</a></li>
<li class="chapter" data-level="8.6.6" data-path="conditions.html"><a href="conditions.html#exercises-26"><i class="fa fa-check"></i><b>8.6.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="conditions.html"><a href="conditions.html#conditions-answers"><i class="fa fa-check"></i><b>8.7</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="connections.html"><a href="connections.html"><i class="fa fa-check"></i><b>9</b> Connections</a><ul>
<li class="chapter" data-level="9.1" data-path="connections.html"><a href="connections.html#basics-1"><i class="fa fa-check"></i><b>9.1</b> Basics</a></li>
<li class="chapter" data-level="9.2" data-path="connections.html"><a href="connections.html#reading-and-writing-binary-data"><i class="fa fa-check"></i><b>9.2</b> Reading and writing binary data</a></li>
<li class="chapter" data-level="9.3" data-path="connections.html"><a href="connections.html#reading-and-writing-text-data"><i class="fa fa-check"></i><b>9.3</b> Reading and writing text data</a></li>
</ul></li>
<li class="part"><span><b>II Functional programming</b></span></li>
<li class="chapter" data-level="" data-path="fp.html"><a href="fp.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="10" data-path="functionals.html"><a href="functionals.html"><i class="fa fa-check"></i><b>10</b> Functionals</a><ul>
<li class="chapter" data-level="10.1" data-path="functionals.html"><a href="functionals.html#introduction-7"><i class="fa fa-check"></i><b>10.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#outline-5"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#prerequisites-3"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="functionals.html"><a href="functionals.html#map"><i class="fa fa-check"></i><b>10.2</b> My first functional: <code>map()</code></a><ul>
<li class="chapter" data-level="10.2.1" data-path="functionals.html"><a href="functionals.html#producing-atomic-vectors"><i class="fa fa-check"></i><b>10.2.1</b> Producing atomic vectors</a></li>
<li class="chapter" data-level="10.2.2" data-path="functionals.html"><a href="functionals.html#anonymous-functions-and-helpers"><i class="fa fa-check"></i><b>10.2.2</b> Anonymous functions and helpers</a></li>
<li class="chapter" data-level="10.2.3" data-path="functionals.html"><a href="functionals.html#passing-arguments"><i class="fa fa-check"></i><b>10.2.3</b> Passing arguments with <code>...</code></a></li>
<li class="chapter" data-level="10.2.4" data-path="functionals.html"><a href="functionals.html#argument-names"><i class="fa fa-check"></i><b>10.2.4</b> Argument names</a></li>
<li class="chapter" data-level="10.2.5" data-path="functionals.html"><a href="functionals.html#change-argument"><i class="fa fa-check"></i><b>10.2.5</b> Varying another argument</a></li>
<li class="chapter" data-level="10.2.6" data-path="functionals.html"><a href="functionals.html#exercises-27"><i class="fa fa-check"></i><b>10.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="functionals.html"><a href="functionals.html#functionals-loop"><i class="fa fa-check"></i><b>10.3</b> Map variants</a><ul>
<li class="chapter" data-level="10.3.1" data-path="functionals.html"><a href="functionals.html#modify"><i class="fa fa-check"></i><b>10.3.1</b> Same type of output as input: <code>modify()</code></a></li>
<li class="chapter" data-level="10.3.2" data-path="functionals.html"><a href="functionals.html#map2"><i class="fa fa-check"></i><b>10.3.2</b> Two inputs: <code>map2()</code> and friends</a></li>
<li class="chapter" data-level="10.3.3" data-path="functionals.html"><a href="functionals.html#no-outputs-walk-and-friends"><i class="fa fa-check"></i><b>10.3.3</b> No outputs: <code>walk()</code> and friends</a></li>
<li class="chapter" data-level="10.3.4" data-path="functionals.html"><a href="functionals.html#iterating-over-values-and-indices"><i class="fa fa-check"></i><b>10.3.4</b> Iterating over values and indices</a></li>
<li class="chapter" data-level="10.3.5" data-path="functionals.html"><a href="functionals.html#pmap"><i class="fa fa-check"></i><b>10.3.5</b> Any number of inputs: <code>pmap()</code> and friends</a></li>
<li class="chapter" data-level="10.3.6" data-path="functionals.html"><a href="functionals.html#exercises-28"><i class="fa fa-check"></i><b>10.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="functionals.html"><a href="functionals.html#reduce"><i class="fa fa-check"></i><b>10.4</b> Reduce</a><ul>
<li class="chapter" data-level="10.4.1" data-path="functionals.html"><a href="functionals.html#basics-2"><i class="fa fa-check"></i><b>10.4.1</b> Basics</a></li>
<li class="chapter" data-level="10.4.2" data-path="functionals.html"><a href="functionals.html#algebra"><i class="fa fa-check"></i><b>10.4.2</b> Algebra</a></li>
<li class="chapter" data-level="10.4.3" data-path="functionals.html"><a href="functionals.html#initialise"><i class="fa fa-check"></i><b>10.4.3</b> Initialise</a></li>
<li class="chapter" data-level="10.4.4" data-path="functionals.html"><a href="functionals.html#reduce2"><i class="fa fa-check"></i><b>10.4.4</b> reduce2</a></li>
<li class="chapter" data-level="10.4.5" data-path="functionals.html"><a href="functionals.html#accumulate"><i class="fa fa-check"></i><b>10.4.5</b> Accumulate</a></li>
<li class="chapter" data-level="10.4.6" data-path="functionals.html"><a href="functionals.html#map-reduce"><i class="fa fa-check"></i><b>10.4.6</b> Map-reduce</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="functionals.html"><a href="functionals.html#predicate-functionals"><i class="fa fa-check"></i><b>10.5</b> Predicate functionals</a><ul>
<li class="chapter" data-level="10.5.1" data-path="functionals.html"><a href="functionals.html#basics-3"><i class="fa fa-check"></i><b>10.5.1</b> Basics</a></li>
<li class="chapter" data-level="10.5.2" data-path="functionals.html"><a href="functionals.html#predicate-map"><i class="fa fa-check"></i><b>10.5.2</b> Map variants</a></li>
<li class="chapter" data-level="10.5.3" data-path="functionals.html"><a href="functionals.html#exercises-29"><i class="fa fa-check"></i><b>10.5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="functionals.html"><a href="functionals.html#functionals-math"><i class="fa fa-check"></i><b>10.6</b> Base functionals</a><ul>
<li class="chapter" data-level="10.6.1" data-path="functionals.html"><a href="functionals.html#matrices-and-array-operations"><i class="fa fa-check"></i><b>10.6.1</b> Matrices and array operations</a></li>
<li class="chapter" data-level="10.6.2" data-path="functionals.html"><a href="functionals.html#tapply"><i class="fa fa-check"></i><b>10.6.2</b> <code>tapply()</code></a></li>
<li class="chapter" data-level="10.6.3" data-path="functionals.html"><a href="functionals.html#mathmatical"><i class="fa fa-check"></i><b>10.6.3</b> Mathmatical</a></li>
<li class="chapter" data-level="10.6.4" data-path="functionals.html"><a href="functionals.html#exercises-30"><i class="fa fa-check"></i><b>10.6.4</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="function-factories.html"><a href="function-factories.html"><i class="fa fa-check"></i><b>11</b> Function factories</a><ul>
<li class="chapter" data-level="11.1" data-path="function-factories.html"><a href="function-factories.html#introduction-8"><i class="fa fa-check"></i><b>11.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#outline-6"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#prerequisites-4"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="function-factories.html"><a href="function-factories.html#factory-fundamentals"><i class="fa fa-check"></i><b>11.2</b> Factory fundamentals</a><ul>
<li class="chapter" data-level="11.2.1" data-path="function-factories.html"><a href="function-factories.html#environments-1"><i class="fa fa-check"></i><b>11.2.1</b> Environments</a></li>
<li class="chapter" data-level="11.2.2" data-path="function-factories.html"><a href="function-factories.html#diagram-conventions"><i class="fa fa-check"></i><b>11.2.2</b> Diagram conventions</a></li>
<li class="chapter" data-level="11.2.3" data-path="function-factories.html"><a href="function-factories.html#stateful-funs"><i class="fa fa-check"></i><b>11.2.3</b> Stateful functions</a></li>
<li class="chapter" data-level="11.2.4" data-path="function-factories.html"><a href="function-factories.html#potential-pitfalls"><i class="fa fa-check"></i><b>11.2.4</b> Potential pitfalls</a></li>
<li class="chapter" data-level="11.2.5" data-path="function-factories.html"><a href="function-factories.html#exercises-31"><i class="fa fa-check"></i><b>11.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="function-factories.html"><a href="function-factories.html#graph-fact"><i class="fa fa-check"></i><b>11.3</b> Graphical factories</a><ul>
<li class="chapter" data-level="11.3.1" data-path="function-factories.html"><a href="function-factories.html#labelling"><i class="fa fa-check"></i><b>11.3.1</b> Labelling</a></li>
<li class="chapter" data-level="11.3.2" data-path="function-factories.html"><a href="function-factories.html#histogram-bins"><i class="fa fa-check"></i><b>11.3.2</b> Histogram bins</a></li>
<li class="chapter" data-level="11.3.3" data-path="function-factories.html"><a href="function-factories.html#ggsave"><i class="fa fa-check"></i><b>11.3.3</b> ggsave</a></li>
<li class="chapter" data-level="11.3.4" data-path="function-factories.html"><a href="function-factories.html#exercises-32"><i class="fa fa-check"></i><b>11.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="function-factories.html"><a href="function-factories.html#stat-fact"><i class="fa fa-check"></i><b>11.4</b> Statistical factories</a><ul>
<li class="chapter" data-level="11.4.1" data-path="function-factories.html"><a href="function-factories.html#box-cox-transformation"><i class="fa fa-check"></i><b>11.4.1</b> Box-Cox transformation</a></li>
<li class="chapter" data-level="11.4.2" data-path="function-factories.html"><a href="function-factories.html#bootstrap-generators"><i class="fa fa-check"></i><b>11.4.2</b> Bootstrap generators</a></li>
<li class="chapter" data-level="11.4.3" data-path="function-factories.html"><a href="function-factories.html#MLE"><i class="fa fa-check"></i><b>11.4.3</b> Maximum likelihood estimation</a></li>
<li class="chapter" data-level="11.4.4" data-path="function-factories.html"><a href="function-factories.html#exercises-33"><i class="fa fa-check"></i><b>11.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="function-factories.html"><a href="function-factories.html#functional-factories"><i class="fa fa-check"></i><b>11.5</b> Function factories + functionals</a><ul>
<li class="chapter" data-level="11.5.1" data-path="function-factories.html"><a href="function-factories.html#moving-a-lists-to-the-global-environment"><i class="fa fa-check"></i><b>11.5.1</b> Moving a lists to the global environment</a></li>
<li class="chapter" data-level="11.5.2" data-path="function-factories.html"><a href="function-factories.html#another-approach"><i class="fa fa-check"></i><b>11.5.2</b> Another approach</a></li>
<li class="chapter" data-level="11.5.3" data-path="function-factories.html"><a href="function-factories.html#exercises-34"><i class="fa fa-check"></i><b>11.5.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="function-operators.html"><a href="function-operators.html"><i class="fa fa-check"></i><b>12</b> Function operators</a><ul>
<li class="chapter" data-level="12.1" data-path="function-operators.html"><a href="function-operators.html#introduction-9"><i class="fa fa-check"></i><b>12.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="function-operators.html"><a href="function-operators.html#outline-7"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="function-operators.html"><a href="function-operators.html#prerequisites-5"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="function-operators.html"><a href="function-operators.html#behavioural-fos"><i class="fa fa-check"></i><b>12.2</b> Behavioural FOs</a><ul>
<li class="chapter" data-level="12.2.1" data-path="function-operators.html"><a href="function-operators.html#memoisation"><i class="fa fa-check"></i><b>12.2.1</b> Memoisation</a></li>
<li class="chapter" data-level="12.2.2" data-path="function-operators.html"><a href="function-operators.html#tee"><i class="fa fa-check"></i><b>12.2.2</b> Capturing function invocations</a></li>
<li class="chapter" data-level="12.2.3" data-path="function-operators.html"><a href="function-operators.html#laziness"><i class="fa fa-check"></i><b>12.2.3</b> Laziness</a></li>
<li class="chapter" data-level="12.2.4" data-path="function-operators.html"><a href="function-operators.html#exercises-35"><i class="fa fa-check"></i><b>12.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="function-operators.html"><a href="function-operators.html#output-fos"><i class="fa fa-check"></i><b>12.3</b> Output FOs</a><ul>
<li class="chapter" data-level="12.3.1" data-path="function-operators.html"><a href="function-operators.html#minor-modifications"><i class="fa fa-check"></i><b>12.3.1</b> Minor modifications</a></li>
<li class="chapter" data-level="12.3.2" data-path="function-operators.html"><a href="function-operators.html#changing-what-a-function-does"><i class="fa fa-check"></i><b>12.3.2</b> Changing what a function does</a></li>
<li class="chapter" data-level="12.3.3" data-path="function-operators.html"><a href="function-operators.html#exercises-36"><i class="fa fa-check"></i><b>12.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="function-operators.html"><a href="function-operators.html#input-fos"><i class="fa fa-check"></i><b>12.4</b> Input FOs</a><ul>
<li class="chapter" data-level="12.4.1" data-path="function-operators.html"><a href="function-operators.html#prefilling-function-arguments-partial-function-application"><i class="fa fa-check"></i><b>12.4.1</b> Prefilling function arguments: partial function application</a></li>
<li class="chapter" data-level="12.4.2" data-path="function-operators.html"><a href="function-operators.html#changing-input-types"><i class="fa fa-check"></i><b>12.4.2</b> Changing input types</a></li>
<li class="chapter" data-level="12.4.3" data-path="function-operators.html"><a href="function-operators.html#exercises-37"><i class="fa fa-check"></i><b>12.4.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="function-operators.html"><a href="function-operators.html#combining-fos"><i class="fa fa-check"></i><b>12.5</b> Combining FOs</a><ul>
<li class="chapter" data-level="12.5.1" data-path="function-operators.html"><a href="function-operators.html#function-composition"><i class="fa fa-check"></i><b>12.5.1</b> Function composition</a></li>
<li class="chapter" data-level="12.5.2" data-path="function-operators.html"><a href="function-operators.html#logical-predicates-and-boolean-algebra"><i class="fa fa-check"></i><b>12.5.2</b> Logical predicates and boolean algebra</a></li>
<li class="chapter" data-level="12.5.3" data-path="function-operators.html"><a href="function-operators.html#exercises-38"><i class="fa fa-check"></i><b>12.5.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Object oriented programming</b></span></li>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="12.6" data-path="oo.html"><a href="oo.html#oop-systems"><i class="fa fa-check"></i><b>12.6</b> OOP Systems</a></li>
<li class="chapter" data-level="12.7" data-path="oo.html"><a href="oo.html#oop-in-r"><i class="fa fa-check"></i><b>12.7</b> OOP in R</a></li>
<li class="chapter" data-level="12.8" data-path="oo.html"><a href="oo.html#field-guide"><i class="fa fa-check"></i><b>12.8</b> Field guide</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="base-types.html"><a href="base-types.html"><i class="fa fa-check"></i><b>13</b> Base types</a><ul>
<li class="chapter" data-level="13.1" data-path="base-types.html"><a href="base-types.html#introduction-10"><i class="fa fa-check"></i><b>13.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="base-types.html"><a href="base-types.html#outline-8"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="base-types.html"><a href="base-types.html#base-objects-vs-oo-objects"><i class="fa fa-check"></i><b>13.2</b> Base objects vs OO objects</a></li>
<li class="chapter" data-level="13.3" data-path="base-types.html"><a href="base-types.html#base-types-2"><i class="fa fa-check"></i><b>13.3</b> Base types</a></li>
<li class="chapter" data-level="13.4" data-path="base-types.html"><a href="base-types.html#is-functions"><i class="fa fa-check"></i><b>13.4</b> The is functions</a><ul>
<li class="chapter" data-level="13.4.1" data-path="base-types.html"><a href="base-types.html#numeric-type"><i class="fa fa-check"></i><b>13.4.1</b> Numeric type</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="s3.html"><a href="s3.html"><i class="fa fa-check"></i><b>14</b> S3</a><ul>
<li class="chapter" data-level="14.1" data-path="s3.html"><a href="s3.html#introduction-11"><i class="fa fa-check"></i><b>14.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#outline-9"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#prerequisites-6"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="s3.html"><a href="s3.html#s3-basics"><i class="fa fa-check"></i><b>14.2</b> Basics</a><ul>
<li class="chapter" data-level="14.2.1" data-path="s3.html"><a href="s3.html#exercises-39"><i class="fa fa-check"></i><b>14.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="s3.html"><a href="s3.html#classes"><i class="fa fa-check"></i><b>14.3</b> Classes</a><ul>
<li class="chapter" data-level="14.3.1" data-path="s3.html"><a href="s3.html#constructors"><i class="fa fa-check"></i><b>14.3.1</b> Constructors</a></li>
<li class="chapter" data-level="14.3.2" data-path="s3.html"><a href="s3.html#validators"><i class="fa fa-check"></i><b>14.3.2</b> Validators</a></li>
<li class="chapter" data-level="14.3.3" data-path="s3.html"><a href="s3.html#helpers"><i class="fa fa-check"></i><b>14.3.3</b> Helpers</a></li>
<li class="chapter" data-level="14.3.4" data-path="s3.html"><a href="s3.html#object-styles"><i class="fa fa-check"></i><b>14.3.4</b> Object styles</a></li>
<li class="chapter" data-level="14.3.5" data-path="s3.html"><a href="s3.html#exercises-40"><i class="fa fa-check"></i><b>14.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="s3.html"><a href="s3.html#generics-and-methods"><i class="fa fa-check"></i><b>14.4</b> Generics and methods</a><ul>
<li class="chapter" data-level="14.4.1" data-path="s3.html"><a href="s3.html#coercion"><i class="fa fa-check"></i><b>14.4.1</b> Coercion</a></li>
<li class="chapter" data-level="14.4.2" data-path="s3.html"><a href="s3.html#s3-arguments"><i class="fa fa-check"></i><b>14.4.2</b> Arguments</a></li>
<li class="chapter" data-level="14.4.3" data-path="s3.html"><a href="s3.html#exercises-41"><i class="fa fa-check"></i><b>14.4.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="s3.html"><a href="s3.html#method-dispatch"><i class="fa fa-check"></i><b>14.5</b> Method dispatch</a><ul>
<li class="chapter" data-level="14.5.1" data-path="s3.html"><a href="s3.html#usemethod"><i class="fa fa-check"></i><b>14.5.1</b> <code>UseMethod()</code></a></li>
<li class="chapter" data-level="14.5.2" data-path="s3.html"><a href="s3.html#nextmethod"><i class="fa fa-check"></i><b>14.5.2</b> <code>NextMethod()</code></a></li>
<li class="chapter" data-level="14.5.3" data-path="s3.html"><a href="s3.html#exercises-42"><i class="fa fa-check"></i><b>14.5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="s3.html"><a href="s3.html#inheritance"><i class="fa fa-check"></i><b>14.6</b> Inheritance</a><ul>
<li class="chapter" data-level="14.6.1" data-path="s3.html"><a href="s3.html#constructors-1"><i class="fa fa-check"></i><b>14.6.1</b> Constructors</a></li>
<li class="chapter" data-level="14.6.2" data-path="s3.html"><a href="s3.html#coercion-1"><i class="fa fa-check"></i><b>14.6.2</b> Coercion</a></li>
<li class="chapter" data-level="14.6.3" data-path="s3.html"><a href="s3.html#methods"><i class="fa fa-check"></i><b>14.6.3</b> Methods</a></li>
<li class="chapter" data-level="14.6.4" data-path="s3.html"><a href="s3.html#exercises-43"><i class="fa fa-check"></i><b>14.6.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.7" data-path="s3.html"><a href="s3.html#dispatch-details"><i class="fa fa-check"></i><b>14.7</b> Dispatch details</a><ul>
<li class="chapter" data-level="14.7.1" data-path="s3.html"><a href="s3.html#environments-and-namespaces"><i class="fa fa-check"></i><b>14.7.1</b> Environments and namespaces</a></li>
<li class="chapter" data-level="14.7.2" data-path="s3.html"><a href="s3.html#s3-and-base-types"><i class="fa fa-check"></i><b>14.7.2</b> S3 and base types</a></li>
<li class="chapter" data-level="14.7.3" data-path="s3.html"><a href="s3.html#internal-generics"><i class="fa fa-check"></i><b>14.7.3</b> Internal generics</a></li>
<li class="chapter" data-level="14.7.4" data-path="s3.html"><a href="s3.html#group-generics"><i class="fa fa-check"></i><b>14.7.4</b> Group generics</a></li>
<li class="chapter" data-level="14.7.5" data-path="s3.html"><a href="s3.html#double-dispatch"><i class="fa fa-check"></i><b>14.7.5</b> Double dispatch</a></li>
<li class="chapter" data-level="14.7.6" data-path="s3.html"><a href="s3.html#exercises-44"><i class="fa fa-check"></i><b>14.7.6</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="s4.html"><a href="s4.html"><i class="fa fa-check"></i><b>15</b> S4</a><ul>
<li class="chapter" data-level="15.1" data-path="s4.html"><a href="s4.html#introduction-12"><i class="fa fa-check"></i><b>15.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#outline-10"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#prerequisites-7"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="s4.html"><a href="s4.html#classes-1"><i class="fa fa-check"></i><b>15.2</b> Classes</a><ul>
<li class="chapter" data-level="15.2.1" data-path="s4.html"><a href="s4.html#slots"><i class="fa fa-check"></i><b>15.2.1</b> Slots</a></li>
<li class="chapter" data-level="15.2.2" data-path="s4.html"><a href="s4.html#helper"><i class="fa fa-check"></i><b>15.2.2</b> Helper</a></li>
<li class="chapter" data-level="15.2.3" data-path="s4.html"><a href="s4.html#introspection"><i class="fa fa-check"></i><b>15.2.3</b> Introspection</a></li>
<li class="chapter" data-level="15.2.4" data-path="s4.html"><a href="s4.html#exercises-45"><i class="fa fa-check"></i><b>15.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="s4.html"><a href="s4.html#generics-and-methods-1"><i class="fa fa-check"></i><b>15.3</b> Generics and methods</a><ul>
<li class="chapter" data-level="15.3.1" data-path="s4.html"><a href="s4.html#show-method"><i class="fa fa-check"></i><b>15.3.1</b> Show method</a></li>
<li class="chapter" data-level="15.3.2" data-path="s4.html"><a href="s4.html#accessor-methods"><i class="fa fa-check"></i><b>15.3.2</b> Accessor methods</a></li>
<li class="chapter" data-level="15.3.3" data-path="s4.html"><a href="s4.html#coercion-methods"><i class="fa fa-check"></i><b>15.3.3</b> Coercion methods</a></li>
<li class="chapter" data-level="15.3.4" data-path="s4.html"><a href="s4.html#introspection-1"><i class="fa fa-check"></i><b>15.3.4</b> Introspection</a></li>
<li class="chapter" data-level="15.3.5" data-path="s4.html"><a href="s4.html#exercises-46"><i class="fa fa-check"></i><b>15.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="s4.html"><a href="s4.html#method-dispatch-1"><i class="fa fa-check"></i><b>15.4</b> Method dispatch</a><ul>
<li class="chapter" data-level="15.4.1" data-path="s4.html"><a href="s4.html#single-dispatch"><i class="fa fa-check"></i><b>15.4.1</b> Single dispatch</a></li>
<li class="chapter" data-level="15.4.2" data-path="s4.html"><a href="s4.html#multiple-inheritance"><i class="fa fa-check"></i><b>15.4.2</b> Multiple inheritance</a></li>
<li class="chapter" data-level="15.4.3" data-path="s4.html"><a href="s4.html#multiple-dispatch"><i class="fa fa-check"></i><b>15.4.3</b> Multiple dispatch</a></li>
<li class="chapter" data-level="15.4.4" data-path="s4.html"><a href="s4.html#multiple-dispatch-and-multiple-inheritance"><i class="fa fa-check"></i><b>15.4.4</b> Multiple dispatch and multiple inheritance</a></li>
<li class="chapter" data-level="15.4.5" data-path="s4.html"><a href="s4.html#exercises-47"><i class="fa fa-check"></i><b>15.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="s4.html"><a href="s4.html#s4-and-existing-code"><i class="fa fa-check"></i><b>15.5</b> S4 and existing code</a><ul>
<li class="chapter" data-level="15.5.1" data-path="s4.html"><a href="s4.html#classes-2"><i class="fa fa-check"></i><b>15.5.1</b> Classes</a></li>
<li class="chapter" data-level="15.5.2" data-path="s4.html"><a href="s4.html#generics"><i class="fa fa-check"></i><b>15.5.2</b> Generics</a></li>
<li class="chapter" data-level="15.5.3" data-path="s4.html"><a href="s4.html#exercises-48"><i class="fa fa-check"></i><b>15.5.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="R6.html"><a href="R6.html"><i class="fa fa-check"></i><b>16</b> R6</a><ul>
<li class="chapter" data-level="16.1" data-path="R6.html"><a href="R6.html#introduction-13"><i class="fa fa-check"></i><b>16.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="R6.html"><a href="R6.html#outline-11"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="R6.html"><a href="R6.html#prequisites"><i class="fa fa-check"></i>Prequisites</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="R6.html"><a href="R6.html#classes-and-methods"><i class="fa fa-check"></i><b>16.2</b> Classes and methods</a><ul>
<li class="chapter" data-level="16.2.1" data-path="R6.html"><a href="R6.html#method-chaining"><i class="fa fa-check"></i><b>16.2.1</b> Method chaining</a></li>
<li class="chapter" data-level="16.2.2" data-path="R6.html"><a href="R6.html#important-methods"><i class="fa fa-check"></i><b>16.2.2</b> Important methods</a></li>
<li class="chapter" data-level="16.2.3" data-path="R6.html"><a href="R6.html#adding-methods-after-creation"><i class="fa fa-check"></i><b>16.2.3</b> Adding methods after creation</a></li>
<li class="chapter" data-level="16.2.4" data-path="R6.html"><a href="R6.html#inheritance-1"><i class="fa fa-check"></i><b>16.2.4</b> Inheritance</a></li>
<li class="chapter" data-level="16.2.5" data-path="R6.html"><a href="R6.html#introspection-2"><i class="fa fa-check"></i><b>16.2.5</b> Introspection</a></li>
<li class="chapter" data-level="16.2.6" data-path="R6.html"><a href="R6.html#exercises-49"><i class="fa fa-check"></i><b>16.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="R6.html"><a href="R6.html#controlling-access"><i class="fa fa-check"></i><b>16.3</b> Controlling access</a><ul>
<li class="chapter" data-level="16.3.1" data-path="R6.html"><a href="R6.html#privacy"><i class="fa fa-check"></i><b>16.3.1</b> Privacy</a></li>
<li class="chapter" data-level="16.3.2" data-path="R6.html"><a href="R6.html#active-fields"><i class="fa fa-check"></i><b>16.3.2</b> Active fields</a></li>
<li class="chapter" data-level="16.3.3" data-path="R6.html"><a href="R6.html#exercises-50"><i class="fa fa-check"></i><b>16.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="R6.html"><a href="R6.html#reference-semantics"><i class="fa fa-check"></i><b>16.4</b> Reference semantics</a><ul>
<li class="chapter" data-level="16.4.1" data-path="R6.html"><a href="R6.html#reasoning"><i class="fa fa-check"></i><b>16.4.1</b> Reasoning</a></li>
<li class="chapter" data-level="16.4.2" data-path="R6.html"><a href="R6.html#finalizer"><i class="fa fa-check"></i><b>16.4.2</b> Finalizer</a></li>
<li class="chapter" data-level="16.4.3" data-path="R6.html"><a href="R6.html#r6-fields"><i class="fa fa-check"></i><b>16.4.3</b> R6 fields</a></li>
<li class="chapter" data-level="16.4.4" data-path="R6.html"><a href="R6.html#exercises-51"><i class="fa fa-check"></i><b>16.4.4</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html"><i class="fa fa-check"></i><b>17</b> Trade-offs</a><ul>
<li class="chapter" data-level="17.1" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#introduction-14"><i class="fa fa-check"></i><b>17.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#outline-12"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#s3-s4"><i class="fa fa-check"></i><b>17.2</b> S4 vs S3</a></li>
<li class="chapter" data-level="17.3" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#s3-r6"><i class="fa fa-check"></i><b>17.3</b> R6 vs S3</a><ul>
<li class="chapter" data-level="17.3.1" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#namespacing"><i class="fa fa-check"></i><b>17.3.1</b> Namespacing</a></li>
<li class="chapter" data-level="17.3.2" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#threading-state"><i class="fa fa-check"></i><b>17.3.2</b> Threading state</a></li>
<li class="chapter" data-level="17.3.3" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#tradeoffs-pipe"><i class="fa fa-check"></i><b>17.3.3</b> Method chaining</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Metaprogramming</b></span></li>
<li class="chapter" data-level="" data-path="meta.html"><a href="meta.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="17.3.4" data-path="meta.html"><a href="meta.html#trading-precision-for-concision"><i class="fa fa-check"></i><b>17.3.4</b> Trading precision for concision</a></li>
<li class="chapter" data-level="17.4" data-path="meta.html"><a href="meta.html#domain-specific-languages"><i class="fa fa-check"></i><b>17.4</b> Domain specific languages</a></li>
<li class="chapter" data-level="17.5" data-path="meta.html"><a href="meta.html#overview-1"><i class="fa fa-check"></i><b>17.5</b> Overview</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="expressions.html"><a href="expressions.html"><i class="fa fa-check"></i><b>18</b> Expressions</a><ul>
<li class="chapter" data-level="18.1" data-path="expressions.html"><a href="expressions.html#introduction-15"><i class="fa fa-check"></i><b>18.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="expressions.html"><a href="expressions.html#outline-13"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="expressions.html"><a href="expressions.html#prerequisites-8"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="expressions.html"><a href="expressions.html#abstract-syntax-trees"><i class="fa fa-check"></i><b>18.2</b> Abstract syntax trees</a><ul>
<li class="chapter" data-level="18.2.1" data-path="expressions.html"><a href="expressions.html#infix-vs.prefix-calls"><i class="fa fa-check"></i><b>18.2.1</b> Infix vs. prefix calls</a></li>
<li class="chapter" data-level="18.2.2" data-path="expressions.html"><a href="expressions.html#special-forms-1"><i class="fa fa-check"></i><b>18.2.2</b> Special forms</a></li>
<li class="chapter" data-level="18.2.3" data-path="expressions.html"><a href="expressions.html#function-factories-1"><i class="fa fa-check"></i><b>18.2.3</b> Function factories</a></li>
<li class="chapter" data-level="18.2.4" data-path="expressions.html"><a href="expressions.html#argument-names-1"><i class="fa fa-check"></i><b>18.2.4</b> Argument names</a></li>
<li class="chapter" data-level="18.2.5" data-path="expressions.html"><a href="expressions.html#exercises-52"><i class="fa fa-check"></i><b>18.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="expressions.html"><a href="expressions.html#rs-grammar"><i class="fa fa-check"></i><b>18.3</b> R’s grammar</a><ul>
<li class="chapter" data-level="18.3.1" data-path="expressions.html"><a href="expressions.html#operator-precedence"><i class="fa fa-check"></i><b>18.3.1</b> Operator precedence</a></li>
<li class="chapter" data-level="18.3.2" data-path="expressions.html"><a href="expressions.html#associativity"><i class="fa fa-check"></i><b>18.3.2</b> Associativity</a></li>
<li class="chapter" data-level="18.3.3" data-path="expressions.html"><a href="expressions.html#whitespace"><i class="fa fa-check"></i><b>18.3.3</b> Whitespace</a></li>
<li class="chapter" data-level="18.3.4" data-path="expressions.html"><a href="expressions.html#exercises-53"><i class="fa fa-check"></i><b>18.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="expressions.html"><a href="expressions.html#data-structures"><i class="fa fa-check"></i><b>18.4</b> Data structures</a><ul>
<li class="chapter" data-level="18.4.1" data-path="expressions.html"><a href="expressions.html#naming-conventions"><i class="fa fa-check"></i><b>18.4.1</b> Naming conventions</a></li>
<li class="chapter" data-level="18.4.2" data-path="expressions.html"><a href="expressions.html#constants"><i class="fa fa-check"></i><b>18.4.2</b> Constants</a></li>
<li class="chapter" data-level="18.4.3" data-path="expressions.html"><a href="expressions.html#symbols"><i class="fa fa-check"></i><b>18.4.3</b> Symbols</a></li>
<li class="chapter" data-level="18.4.4" data-path="expressions.html"><a href="expressions.html#calls"><i class="fa fa-check"></i><b>18.4.4</b> Calls</a></li>
<li class="chapter" data-level="18.4.5" data-path="expressions.html"><a href="expressions.html#pairlists"><i class="fa fa-check"></i><b>18.4.5</b> Pairlists</a></li>
<li class="chapter" data-level="18.4.6" data-path="expressions.html"><a href="expressions.html#expression-objects"><i class="fa fa-check"></i><b>18.4.6</b> Expression objects</a></li>
<li class="chapter" data-level="18.4.7" data-path="expressions.html"><a href="expressions.html#exercises-54"><i class="fa fa-check"></i><b>18.4.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="expressions.html"><a href="expressions.html#parsing-and-deparsing"><i class="fa fa-check"></i><b>18.5</b> Parsing and deparsing</a><ul>
<li class="chapter" data-level="18.5.1" data-path="expressions.html"><a href="expressions.html#exercises-55"><i class="fa fa-check"></i><b>18.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="expressions.html"><a href="expressions.html#ast-funs"><i class="fa fa-check"></i><b>18.6</b> Case study: Walking the AST with recursive functions</a><ul>
<li class="chapter" data-level="18.6.1" data-path="expressions.html"><a href="expressions.html#finding-f-and-t"><i class="fa fa-check"></i><b>18.6.1</b> Finding F and T</a></li>
<li class="chapter" data-level="18.6.2" data-path="expressions.html"><a href="expressions.html#finding-all-variables-created-by-assignment"><i class="fa fa-check"></i><b>18.6.2</b> Finding all variables created by assignment</a></li>
<li class="chapter" data-level="18.6.3" data-path="expressions.html"><a href="expressions.html#exercises-56"><i class="fa fa-check"></i><b>18.6.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="quasiquotation.html"><a href="quasiquotation.html"><i class="fa fa-check"></i><b>19</b> Quasiquotation</a><ul>
<li class="chapter" data-level="19.1" data-path="quasiquotation.html"><a href="quasiquotation.html#introduction-16"><i class="fa fa-check"></i><b>19.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#outline-14"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#prerequisites-9"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="19.2" data-path="quasiquotation.html"><a href="quasiquotation.html#motivation-1"><i class="fa fa-check"></i><b>19.2</b> Motivation</a><ul>
<li class="chapter" data-level="19.2.1" data-path="quasiquotation.html"><a href="quasiquotation.html#vocabulary"><i class="fa fa-check"></i><b>19.2.1</b> Vocabulary</a></li>
<li class="chapter" data-level="19.2.2" data-path="quasiquotation.html"><a href="quasiquotation.html#theory"><i class="fa fa-check"></i><b>19.2.2</b> Theory</a></li>
<li class="chapter" data-level="19.2.3" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-57"><i class="fa fa-check"></i><b>19.2.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="quasiquotation.html"><a href="quasiquotation.html#quotation"><i class="fa fa-check"></i><b>19.3</b> Quotation</a><ul>
<li class="chapter" data-level="19.3.1" data-path="quasiquotation.html"><a href="quasiquotation.html#with-rlang"><i class="fa fa-check"></i><b>19.3.1</b> With rlang</a></li>
<li class="chapter" data-level="19.3.2" data-path="quasiquotation.html"><a href="quasiquotation.html#with-base-r"><i class="fa fa-check"></i><b>19.3.2</b> With base R</a></li>
<li class="chapter" data-level="19.3.3" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-58"><i class="fa fa-check"></i><b>19.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="quasiquotation.html"><a href="quasiquotation.html#eval-basics"><i class="fa fa-check"></i><b>19.4</b> Evaluation</a></li>
<li class="chapter" data-level="19.5" data-path="quasiquotation.html"><a href="quasiquotation.html#unquotation"><i class="fa fa-check"></i><b>19.5</b> Unquotation</a><ul>
<li class="chapter" data-level="19.5.1" data-path="quasiquotation.html"><a href="quasiquotation.html#with-rlang-1"><i class="fa fa-check"></i><b>19.5.1</b> With rlang</a></li>
<li class="chapter" data-level="19.5.2" data-path="quasiquotation.html"><a href="quasiquotation.html#the-polite-fiction-of"><i class="fa fa-check"></i><b>19.5.2</b> The polite fiction of <code>!!</code></a></li>
<li class="chapter" data-level="19.5.3" data-path="quasiquotation.html"><a href="quasiquotation.html#unquote-base"><i class="fa fa-check"></i><b>19.5.3</b> With base R</a></li>
<li class="chapter" data-level="19.5.4" data-path="quasiquotation.html"><a href="quasiquotation.html#non-standard-asts"><i class="fa fa-check"></i><b>19.5.4</b> Non-standard ASTs</a></li>
<li class="chapter" data-level="19.5.5" data-path="quasiquotation.html"><a href="quasiquotation.html#missing-arguments-1"><i class="fa fa-check"></i><b>19.5.5</b> Missing arguments</a></li>
<li class="chapter" data-level="19.5.6" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-59"><i class="fa fa-check"></i><b>19.5.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.6" data-path="quasiquotation.html"><a href="quasiquotation.html#quasi-case-studies"><i class="fa fa-check"></i><b>19.6</b> Case studies</a><ul>
<li class="chapter" data-level="19.6.1" data-path="quasiquotation.html"><a href="quasiquotation.html#map-reduce-to-generate-code"><i class="fa fa-check"></i><b>19.6.1</b> Map-reduce to generate code</a></li>
<li class="chapter" data-level="19.6.2" data-path="quasiquotation.html"><a href="quasiquotation.html#partition"><i class="fa fa-check"></i><b>19.6.2</b> Partition</a></li>
<li class="chapter" data-level="19.6.3" data-path="quasiquotation.html"><a href="quasiquotation.html#slicing-an-array"><i class="fa fa-check"></i><b>19.6.3</b> Slicing an array</a></li>
<li class="chapter" data-level="19.6.4" data-path="quasiquotation.html"><a href="quasiquotation.html#quasi-function"><i class="fa fa-check"></i><b>19.6.4</b> Creating functions</a></li>
<li class="chapter" data-level="19.6.5" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-60"><i class="fa fa-check"></i><b>19.6.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.7" data-path="quasiquotation.html"><a href="quasiquotation.html#dot-dot-dot-..."><i class="fa fa-check"></i><b>19.7</b> Dot-dot-dot (<code>...</code>)</a><ul>
<li class="chapter" data-level="19.7.1" data-path="quasiquotation.html"><a href="quasiquotation.html#do.call"><i class="fa fa-check"></i><b>19.7.1</b> <code>do.call()</code></a></li>
<li class="chapter" data-level="19.7.2" data-path="quasiquotation.html"><a href="quasiquotation.html#the-tidyverse-approach"><i class="fa fa-check"></i><b>19.7.2</b> The tidyverse approach</a></li>
<li class="chapter" data-level="19.7.3" data-path="quasiquotation.html"><a href="quasiquotation.html#list2"><i class="fa fa-check"></i><b>19.7.3</b> <code>list2()</code></a></li>
<li class="chapter" data-level="19.7.4" data-path="quasiquotation.html"><a href="quasiquotation.html#application-invoke-and-lang"><i class="fa fa-check"></i><b>19.7.4</b> Application: <code>invoke()</code> and <code>lang()</code></a></li>
<li class="chapter" data-level="19.7.5" data-path="quasiquotation.html"><a href="quasiquotation.html#other-approaches"><i class="fa fa-check"></i><b>19.7.5</b> Other approaches</a></li>
<li class="chapter" data-level="19.7.6" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-61"><i class="fa fa-check"></i><b>19.7.6</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="evaluation.html"><a href="evaluation.html"><i class="fa fa-check"></i><b>20</b> Evaluation</a><ul>
<li class="chapter" data-level="20.1" data-path="evaluation.html"><a href="evaluation.html#introduction-17"><i class="fa fa-check"></i><b>20.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="evaluation.html"><a href="evaluation.html#outline-15"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="evaluation.html"><a href="evaluation.html#prerequisites-10"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="20.2" data-path="evaluation.html"><a href="evaluation.html#evaluation-basics"><i class="fa fa-check"></i><b>20.2</b> Evaluation basics</a><ul>
<li class="chapter" data-level="20.2.1" data-path="evaluation.html"><a href="evaluation.html#application-local"><i class="fa fa-check"></i><b>20.2.1</b> Application: <code>local()</code></a></li>
<li class="chapter" data-level="20.2.2" data-path="evaluation.html"><a href="evaluation.html#application-source"><i class="fa fa-check"></i><b>20.2.2</b> Application: <code>source()</code></a></li>
<li class="chapter" data-level="20.2.3" data-path="evaluation.html"><a href="evaluation.html#gotcha-function"><i class="fa fa-check"></i><b>20.2.3</b> Gotcha: <code>function()</code></a></li>
<li class="chapter" data-level="20.2.4" data-path="evaluation.html"><a href="evaluation.html#eval-frame"><i class="fa fa-check"></i><b>20.2.4</b> Advanced: environments vs. frames</a></li>
<li class="chapter" data-level="20.2.5" data-path="evaluation.html"><a href="evaluation.html#base-r"><i class="fa fa-check"></i><b>20.2.5</b> Base R</a></li>
<li class="chapter" data-level="20.2.6" data-path="evaluation.html"><a href="evaluation.html#exercises-62"><i class="fa fa-check"></i><b>20.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="evaluation.html"><a href="evaluation.html#quosures"><i class="fa fa-check"></i><b>20.3</b> Quosures</a><ul>
<li class="chapter" data-level="20.3.1" data-path="evaluation.html"><a href="evaluation.html#motivation-2"><i class="fa fa-check"></i><b>20.3.1</b> Motivation</a></li>
<li class="chapter" data-level="20.3.2" data-path="evaluation.html"><a href="evaluation.html#creating-and-manipulating"><i class="fa fa-check"></i><b>20.3.2</b> Creating and manipulating</a></li>
<li class="chapter" data-level="20.3.3" data-path="evaluation.html"><a href="evaluation.html#evaluating"><i class="fa fa-check"></i><b>20.3.3</b> Evaluating</a></li>
<li class="chapter" data-level="20.3.4" data-path="evaluation.html"><a href="evaluation.html#implementation"><i class="fa fa-check"></i><b>20.3.4</b> Implementation</a></li>
<li class="chapter" data-level="20.3.5" data-path="evaluation.html"><a href="evaluation.html#when-not-to-use-quosures"><i class="fa fa-check"></i><b>20.3.5</b> When not to use quosures</a></li>
<li class="chapter" data-level="20.3.6" data-path="evaluation.html"><a href="evaluation.html#exercises-63"><i class="fa fa-check"></i><b>20.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="evaluation.html"><a href="evaluation.html#tidy-evaluation"><i class="fa fa-check"></i><b>20.4</b> Tidy evaluation</a><ul>
<li class="chapter" data-level="20.4.1" data-path="evaluation.html"><a href="evaluation.html#data-masks"><i class="fa fa-check"></i><b>20.4.1</b> Data masks</a></li>
<li class="chapter" data-level="20.4.2" data-path="evaluation.html"><a href="evaluation.html#subset"><i class="fa fa-check"></i><b>20.4.2</b> Application: <code>subset()</code></a></li>
<li class="chapter" data-level="20.4.3" data-path="evaluation.html"><a href="evaluation.html#application-arrange"><i class="fa fa-check"></i><b>20.4.3</b> Application: <code>arrange()</code></a></li>
<li class="chapter" data-level="20.4.4" data-path="evaluation.html"><a href="evaluation.html#ambiguity-and-pronouns"><i class="fa fa-check"></i><b>20.4.4</b> Ambiguity and pronouns</a></li>
<li class="chapter" data-level="20.4.5" data-path="evaluation.html"><a href="evaluation.html#base-subset"><i class="fa fa-check"></i><b>20.4.5</b> Base <code>subset()</code></a></li>
<li class="chapter" data-level="20.4.6" data-path="evaluation.html"><a href="evaluation.html#tidy-eval-performance"><i class="fa fa-check"></i><b>20.4.6</b> Performance</a></li>
<li class="chapter" data-level="20.4.7" data-path="evaluation.html"><a href="evaluation.html#exercises-64"><i class="fa fa-check"></i><b>20.4.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.5" data-path="evaluation.html"><a href="evaluation.html#wrapping-quoting-functions"><i class="fa fa-check"></i><b>20.5</b> Wrapping quoting functions</a><ul>
<li class="chapter" data-level="20.5.1" data-path="evaluation.html"><a href="evaluation.html#tidy-evaluation-1"><i class="fa fa-check"></i><b>20.5.1</b> Tidy evaluation</a></li>
<li class="chapter" data-level="20.5.2" data-path="evaluation.html"><a href="evaluation.html#base-r-1"><i class="fa fa-check"></i><b>20.5.2</b> Base R</a></li>
<li class="chapter" data-level="20.5.3" data-path="evaluation.html"><a href="evaluation.html#the-evaluation-environment"><i class="fa fa-check"></i><b>20.5.3</b> The evaluation environment</a></li>
<li class="chapter" data-level="20.5.4" data-path="evaluation.html"><a href="evaluation.html#making-formulas"><i class="fa fa-check"></i><b>20.5.4</b> Making formulas</a></li>
<li class="chapter" data-level="20.5.5" data-path="evaluation.html"><a href="evaluation.html#exercises-65"><i class="fa fa-check"></i><b>20.5.5</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="21" data-path="translation.html"><a href="translation.html"><i class="fa fa-check"></i><b>21</b> Translating R code</a><ul>
<li class="chapter" data-level="21.1" data-path="translation.html"><a href="translation.html#introduction-18"><i class="fa fa-check"></i><b>21.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="translation.html"><a href="translation.html#outline-16"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="translation.html"><a href="translation.html#prequisites-1"><i class="fa fa-check"></i>Prequisites</a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="translation.html"><a href="translation.html#html"><i class="fa fa-check"></i><b>21.2</b> HTML</a><ul>
<li class="chapter" data-level="21.2.1" data-path="translation.html"><a href="translation.html#goal"><i class="fa fa-check"></i><b>21.2.1</b> Goal</a></li>
<li class="chapter" data-level="21.2.2" data-path="translation.html"><a href="translation.html#escaping"><i class="fa fa-check"></i><b>21.2.2</b> Escaping</a></li>
<li class="chapter" data-level="21.2.3" data-path="translation.html"><a href="translation.html#basic-tag-functions"><i class="fa fa-check"></i><b>21.2.3</b> Basic tag functions</a></li>
<li class="chapter" data-level="21.2.4" data-path="translation.html"><a href="translation.html#tag-functions"><i class="fa fa-check"></i><b>21.2.4</b> Tag functions</a></li>
<li class="chapter" data-level="21.2.5" data-path="translation.html"><a href="translation.html#processing-all-tags"><i class="fa fa-check"></i><b>21.2.5</b> Processing all tags</a></li>
<li class="chapter" data-level="21.2.6" data-path="translation.html"><a href="translation.html#exercises-66"><i class="fa fa-check"></i><b>21.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="21.3" data-path="translation.html"><a href="translation.html#latex"><i class="fa fa-check"></i><b>21.3</b> LaTeX</a><ul>
<li class="chapter" data-level="21.3.1" data-path="translation.html"><a href="translation.html#latex-mathematics"><i class="fa fa-check"></i><b>21.3.1</b> LaTeX mathematics</a></li>
<li class="chapter" data-level="21.3.2" data-path="translation.html"><a href="translation.html#goal-1"><i class="fa fa-check"></i><b>21.3.2</b> Goal</a></li>
<li class="chapter" data-level="21.3.3" data-path="translation.html"><a href="translation.html#to_math"><i class="fa fa-check"></i><b>21.3.3</b> <code>to_math</code></a></li>
<li class="chapter" data-level="21.3.4" data-path="translation.html"><a href="translation.html#known-symbols"><i class="fa fa-check"></i><b>21.3.4</b> Known symbols</a></li>
<li class="chapter" data-level="21.3.5" data-path="translation.html"><a href="translation.html#unknown-symbols"><i class="fa fa-check"></i><b>21.3.5</b> Unknown symbols</a></li>
<li class="chapter" data-level="21.3.6" data-path="translation.html"><a href="translation.html#known-functions"><i class="fa fa-check"></i><b>21.3.6</b> Known functions</a></li>
<li class="chapter" data-level="21.3.7" data-path="translation.html"><a href="translation.html#unknown-functions"><i class="fa fa-check"></i><b>21.3.7</b> Unknown functions</a></li>
<li class="chapter" data-level="21.3.8" data-path="translation.html"><a href="translation.html#exercises-67"><i class="fa fa-check"></i><b>21.3.8</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Techniques</b></span></li>
<li class="chapter" data-level="22" data-path="debugging.html"><a href="debugging.html"><i class="fa fa-check"></i><b>22</b> Debugging</a><ul>
<li class="chapter" data-level="22.1" data-path="debugging.html"><a href="debugging.html#introduction-19"><i class="fa fa-check"></i><b>22.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="debugging.html"><a href="debugging.html#outline-17"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="22.2" data-path="debugging.html"><a href="debugging.html#debugging-techniques"><i class="fa fa-check"></i><b>22.2</b> Techniques</a></li>
<li class="chapter" data-level="22.3" data-path="debugging.html"><a href="debugging.html#debugging-tools"><i class="fa fa-check"></i><b>22.3</b> Tools</a><ul>
<li class="chapter" data-level="22.3.1" data-path="debugging.html"><a href="debugging.html#determining-the-sequence-of-calls"><i class="fa fa-check"></i><b>22.3.1</b> Determining the sequence of calls</a></li>
<li class="chapter" data-level="22.3.2" data-path="debugging.html"><a href="debugging.html#browsing-on-error"><i class="fa fa-check"></i><b>22.3.2</b> Browsing on error</a></li>
<li class="chapter" data-level="22.3.3" data-path="debugging.html"><a href="debugging.html#browsing-arbitrary-code"><i class="fa fa-check"></i><b>22.3.3</b> Browsing arbitrary code</a></li>
<li class="chapter" data-level="22.3.4" data-path="debugging.html"><a href="debugging.html#the-call-stack-traceback-where-and-recover"><i class="fa fa-check"></i><b>22.3.4</b> The call stack: <code>traceback()</code>, <code>where</code>, and <code>recover()</code></a></li>
<li class="chapter" data-level="22.3.5" data-path="debugging.html"><a href="debugging.html#other-types-of-failure"><i class="fa fa-check"></i><b>22.3.5</b> Other types of failure</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="23" data-path="performance.html"><a href="performance.html"><i class="fa fa-check"></i><b>23</b> Performance</a><ul>
<li class="chapter" data-level="23.1" data-path="performance.html"><a href="performance.html#why-is-r-slow"><i class="fa fa-check"></i><b>23.1</b> Why is R slow?</a></li>
<li class="chapter" data-level="23.2" data-path="performance.html"><a href="performance.html#microbenchmarking"><i class="fa fa-check"></i><b>23.2</b> Microbenchmarking</a><ul>
<li class="chapter" data-level="23.2.1" data-path="performance.html"><a href="performance.html#exercises-68"><i class="fa fa-check"></i><b>23.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="23.3" data-path="performance.html"><a href="performance.html#language-performance"><i class="fa fa-check"></i><b>23.3</b> Language performance</a><ul>
<li class="chapter" data-level="23.3.1" data-path="performance.html"><a href="performance.html#extreme-dynamism"><i class="fa fa-check"></i><b>23.3.1</b> Extreme dynamism</a></li>
<li class="chapter" data-level="23.3.2" data-path="performance.html"><a href="performance.html#name-lookup-with-mutable-environments"><i class="fa fa-check"></i><b>23.3.2</b> Name lookup with mutable environments</a></li>
<li class="chapter" data-level="23.3.3" data-path="performance.html"><a href="performance.html#lazy-evaluation-overhead"><i class="fa fa-check"></i><b>23.3.3</b> Lazy evaluation overhead</a></li>
<li class="chapter" data-level="23.3.4" data-path="performance.html"><a href="performance.html#exercises-69"><i class="fa fa-check"></i><b>23.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="23.4" data-path="performance.html"><a href="performance.html#implementation-performance"><i class="fa fa-check"></i><b>23.4</b> Implementation performance</a><ul>
<li class="chapter" data-level="23.4.1" data-path="performance.html"><a href="performance.html#extracting-a-single-value-from-a-data-frame"><i class="fa fa-check"></i><b>23.4.1</b> Extracting a single value from a data frame</a></li>
<li class="chapter" data-level="23.4.2" data-path="performance.html"><a href="performance.html#ifelse-pmin-and-pmax"><i class="fa fa-check"></i><b>23.4.2</b> <code>ifelse()</code>, <code>pmin()</code>, and <code>pmax()</code></a></li>
<li class="chapter" data-level="23.4.3" data-path="performance.html"><a href="performance.html#exercises-70"><i class="fa fa-check"></i><b>23.4.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="23.5" data-path="performance.html"><a href="performance.html#faster-r"><i class="fa fa-check"></i><b>23.5</b> Alternative R implementations</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="profiling.html"><a href="profiling.html"><i class="fa fa-check"></i><b>24</b> Optimising code</a><ul>
<li class="chapter" data-level="24.1" data-path="profiling.html"><a href="profiling.html#introduction-20"><i class="fa fa-check"></i><b>24.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="profiling.html"><a href="profiling.html#outline-18"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="profiling.html"><a href="profiling.html#prerequisites-11"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="24.2" data-path="profiling.html"><a href="profiling.html#measure-perf"><i class="fa fa-check"></i><b>24.2</b> Measuring performance</a><ul>
<li class="chapter" data-level="24.2.1" data-path="profiling.html"><a href="profiling.html#limitations"><i class="fa fa-check"></i><b>24.2.1</b> Limitations</a></li>
</ul></li>
<li class="chapter" data-level="24.3" data-path="profiling.html"><a href="profiling.html#memory-profiling"><i class="fa fa-check"></i><b>24.3</b> Memory profiling with lineprof</a><ul>
<li class="chapter" data-level="24.3.1" data-path="profiling.html"><a href="profiling.html#exercises-71"><i class="fa fa-check"></i><b>24.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.4" data-path="profiling.html"><a href="profiling.html#improve-perf"><i class="fa fa-check"></i><b>24.4</b> Improving performance</a></li>
<li class="chapter" data-level="24.5" data-path="profiling.html"><a href="profiling.html#code-organisation"><i class="fa fa-check"></i><b>24.5</b> Code organisation</a></li>
<li class="chapter" data-level="24.6" data-path="profiling.html"><a href="profiling.html#already-solved"><i class="fa fa-check"></i><b>24.6</b> Has someone already solved the problem?</a><ul>
<li class="chapter" data-level="24.6.1" data-path="profiling.html"><a href="profiling.html#exercises-72"><i class="fa fa-check"></i><b>24.6.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.7" data-path="profiling.html"><a href="profiling.html#be-lazy"><i class="fa fa-check"></i><b>24.7</b> Do as little as possible</a><ul>
<li class="chapter" data-level="24.7.1" data-path="profiling.html"><a href="profiling.html#exercises-73"><i class="fa fa-check"></i><b>24.7.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.8" data-path="profiling.html"><a href="profiling.html#vectorise"><i class="fa fa-check"></i><b>24.8</b> Vectorise</a><ul>
<li class="chapter" data-level="24.8.1" data-path="profiling.html"><a href="profiling.html#exercises-74"><i class="fa fa-check"></i><b>24.8.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.9" data-path="profiling.html"><a href="profiling.html#avoid-copies"><i class="fa fa-check"></i><b>24.9</b> Avoid copies</a></li>
<li class="chapter" data-level="24.10" data-path="profiling.html"><a href="profiling.html#byte-code"><i class="fa fa-check"></i><b>24.10</b> Byte code compilation</a></li>
<li class="chapter" data-level="24.11" data-path="profiling.html"><a href="profiling.html#t-test"><i class="fa fa-check"></i><b>24.11</b> Case study: t-test</a></li>
<li class="chapter" data-level="24.12" data-path="profiling.html"><a href="profiling.html#parallelise"><i class="fa fa-check"></i><b>24.12</b> Parallelise</a></li>
<li class="chapter" data-level="24.13" data-path="profiling.html"><a href="profiling.html#more-techniques"><i class="fa fa-check"></i><b>24.13</b> Other techniques</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="rcpp.html"><a href="rcpp.html"><i class="fa fa-check"></i><b>25</b> Rewriting R code in C++</a><ul>
<li class="chapter" data-level="25.1" data-path="rcpp.html"><a href="rcpp.html#introduction-21"><i class="fa fa-check"></i><b>25.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="rcpp.html"><a href="rcpp.html#outline-19"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="rcpp.html"><a href="rcpp.html#prerequistes"><i class="fa fa-check"></i>Prerequistes</a></li>
</ul></li>
<li class="chapter" data-level="25.2" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro"><i class="fa fa-check"></i><b>25.2</b> Getting started with C++</a><ul>
<li class="chapter" data-level="25.2.1" data-path="rcpp.html"><a href="rcpp.html#no-inputs-scalar-output"><i class="fa fa-check"></i><b>25.2.1</b> No inputs, scalar output</a></li>
<li class="chapter" data-level="25.2.2" data-path="rcpp.html"><a href="rcpp.html#scalar-input-scalar-output"><i class="fa fa-check"></i><b>25.2.2</b> Scalar input, scalar output</a></li>
<li class="chapter" data-level="25.2.3" data-path="rcpp.html"><a href="rcpp.html#vector-input-scalar-output"><i class="fa fa-check"></i><b>25.2.3</b> Vector input, scalar output</a></li>
<li class="chapter" data-level="25.2.4" data-path="rcpp.html"><a href="rcpp.html#vector-input-vector-output"><i class="fa fa-check"></i><b>25.2.4</b> Vector input, vector output</a></li>
<li class="chapter" data-level="25.2.5" data-path="rcpp.html"><a href="rcpp.html#matrix-input-vector-output"><i class="fa fa-check"></i><b>25.2.5</b> Matrix input, vector output</a></li>
<li class="chapter" data-level="25.2.6" data-path="rcpp.html"><a href="rcpp.html#sourceCpp"><i class="fa fa-check"></i><b>25.2.6</b> Using sourceCpp</a></li>
<li class="chapter" data-level="25.2.7" data-path="rcpp.html"><a href="rcpp.html#exercises-75"><i class="fa fa-check"></i><b>25.2.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.3" data-path="rcpp.html"><a href="rcpp.html#rcpp-classes"><i class="fa fa-check"></i><b>25.3</b> Attributes and other classes</a><ul>
<li class="chapter" data-level="25.3.1" data-path="rcpp.html"><a href="rcpp.html#lists-and-data-frames"><i class="fa fa-check"></i><b>25.3.1</b> Lists and data frames</a></li>
<li class="chapter" data-level="25.3.2" data-path="rcpp.html"><a href="rcpp.html#functions-rcpp"><i class="fa fa-check"></i><b>25.3.2</b> Functions</a></li>
<li class="chapter" data-level="25.3.3" data-path="rcpp.html"><a href="rcpp.html#other-types"><i class="fa fa-check"></i><b>25.3.3</b> Other types</a></li>
</ul></li>
<li class="chapter" data-level="25.4" data-path="rcpp.html"><a href="rcpp.html#rcpp-na"><i class="fa fa-check"></i><b>25.4</b> Missing values</a><ul>
<li class="chapter" data-level="25.4.1" data-path="rcpp.html"><a href="rcpp.html#scalars-1"><i class="fa fa-check"></i><b>25.4.1</b> Scalars</a></li>
<li class="chapter" data-level="25.4.2" data-path="rcpp.html"><a href="rcpp.html#strings"><i class="fa fa-check"></i><b>25.4.2</b> Strings</a></li>
<li class="chapter" data-level="25.4.3" data-path="rcpp.html"><a href="rcpp.html#boolean"><i class="fa fa-check"></i><b>25.4.3</b> Boolean</a></li>
<li class="chapter" data-level="25.4.4" data-path="rcpp.html"><a href="rcpp.html#vectors-rcpp"><i class="fa fa-check"></i><b>25.4.4</b> Vectors</a></li>
<li class="chapter" data-level="25.4.5" data-path="rcpp.html"><a href="rcpp.html#exercises-76"><i class="fa fa-check"></i><b>25.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.5" data-path="rcpp.html"><a href="rcpp.html#rcpp-sugar"><i class="fa fa-check"></i><b>25.5</b> Rcpp sugar</a><ul>
<li class="chapter" data-level="25.5.1" data-path="rcpp.html"><a href="rcpp.html#arithmetic-and-logical-operators"><i class="fa fa-check"></i><b>25.5.1</b> Arithmetic and logical operators</a></li>
<li class="chapter" data-level="25.5.2" data-path="rcpp.html"><a href="rcpp.html#logical-summary-functions"><i class="fa fa-check"></i><b>25.5.2</b> Logical summary functions</a></li>
<li class="chapter" data-level="25.5.3" data-path="rcpp.html"><a href="rcpp.html#vector-views"><i class="fa fa-check"></i><b>25.5.3</b> Vector views</a></li>
<li class="chapter" data-level="25.5.4" data-path="rcpp.html"><a href="rcpp.html#other-useful-functions"><i class="fa fa-check"></i><b>25.5.4</b> Other useful functions</a></li>
</ul></li>
<li class="chapter" data-level="25.6" data-path="rcpp.html"><a href="rcpp.html#stl"><i class="fa fa-check"></i><b>25.6</b> The STL</a><ul>
<li class="chapter" data-level="25.6.1" data-path="rcpp.html"><a href="rcpp.html#using-iterators"><i class="fa fa-check"></i><b>25.6.1</b> Using iterators</a></li>
<li class="chapter" data-level="25.6.2" data-path="rcpp.html"><a href="rcpp.html#algorithms"><i class="fa fa-check"></i><b>25.6.2</b> Algorithms</a></li>
<li class="chapter" data-level="25.6.3" data-path="rcpp.html"><a href="rcpp.html#data-structures-rcpp"><i class="fa fa-check"></i><b>25.6.3</b> Data structures</a></li>
<li class="chapter" data-level="25.6.4" data-path="rcpp.html"><a href="rcpp.html#vectors-stl"><i class="fa fa-check"></i><b>25.6.4</b> Vectors</a></li>
<li class="chapter" data-level="25.6.5" data-path="rcpp.html"><a href="rcpp.html#sets"><i class="fa fa-check"></i><b>25.6.5</b> Sets</a></li>
<li class="chapter" data-level="25.6.6" data-path="rcpp.html"><a href="rcpp.html#map-1"><i class="fa fa-check"></i><b>25.6.6</b> Map</a></li>
<li class="chapter" data-level="25.6.7" data-path="rcpp.html"><a href="rcpp.html#exercises-77"><i class="fa fa-check"></i><b>25.6.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.7" data-path="rcpp.html"><a href="rcpp.html#rcpp-case-studies"><i class="fa fa-check"></i><b>25.7</b> Case studies</a><ul>
<li class="chapter" data-level="25.7.1" data-path="rcpp.html"><a href="rcpp.html#gibbs-sampler"><i class="fa fa-check"></i><b>25.7.1</b> Gibbs sampler</a></li>
<li class="chapter" data-level="25.7.2" data-path="rcpp.html"><a href="rcpp.html#r-vectorisation-vs.c-vectorisation"><i class="fa fa-check"></i><b>25.7.2</b> R vectorisation vs. C++ vectorisation</a></li>
</ul></li>
<li class="chapter" data-level="25.8" data-path="rcpp.html"><a href="rcpp.html#rcpp-package"><i class="fa fa-check"></i><b>25.8</b> Using Rcpp in a package</a></li>
<li class="chapter" data-level="25.9" data-path="rcpp.html"><a href="rcpp.html#rcpp-more"><i class="fa fa-check"></i><b>25.9</b> Learning more</a></li>
<li class="chapter" data-level="25.10" data-path="rcpp.html"><a href="rcpp.html#acknowledgments"><i class="fa fa-check"></i><b>25.10</b> Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functionals" class="section level1">
<h1><span class="header-section-number">10</span> Functionals</h1>
<div id="introduction-7" class="section level2">
<h2><span class="header-section-number">10.1</span> Introduction</h2>
<p>
</p>
<blockquote>
<p>“To become significantly more reliable, code must become more transparent.
In particular, nested conditions and loops must be viewed with great
suspicion. Complicated control flows confuse programmers. Messy code often
hides bugs.”</p>
<p>— Bjarne Stroustrup</p>
</blockquote>
<p>A <strong>functional</strong> is a function that takes a function as an input and returns a vector as output. Here’s a simple functional: it calls the function provided as input with 1000 random uniform numbers.</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb349-1" data-line-number="1">randomise &lt;-<span class="st"> </span><span class="cf">function</span>(f) <span class="kw">f</span>(<span class="kw">runif</span>(<span class="fl">1e3</span>))</a>
<a class="sourceLine" id="cb349-2" data-line-number="2"><span class="kw">randomise</span>(mean)</a>
<a class="sourceLine" id="cb349-3" data-line-number="3"><span class="co">#&gt; [1] 0.506</span></a>
<a class="sourceLine" id="cb349-4" data-line-number="4"><span class="kw">randomise</span>(mean)</a>
<a class="sourceLine" id="cb349-5" data-line-number="5"><span class="co">#&gt; [1] 0.501</span></a>
<a class="sourceLine" id="cb349-6" data-line-number="6"><span class="kw">randomise</span>(sum)</a>
<a class="sourceLine" id="cb349-7" data-line-number="7"><span class="co">#&gt; [1] 489</span></a></code></pre></div>
<p>The chances are that you’ve already used a functional. You might have used for-loop replacement like base R’s <code>lapply()</code>, <code>apply()</code>, or <code>tapply()</code>, or maybe purrr’s <code>map()</code> or variant; or maybe you’ve used a mathemetical functional like <code>integrate()</code> or <code>optim()</code>. All functionals take a function as input (among other things) and return a vector as output.</p>
<p>A common use of functionals is as an alternative to for loops. For loops have a bad rap in R. They have a reputation for being slow (although that reputation is only partly true, see Section <a href="names-values.html#single-binding">3.5.1</a> for more details). But the real downside of for loops is that they’re not very expressive. A for loop conveys that it’s iterating over something, but doesn’t clearly convey a high level goal. Instead of using a for loop, it’s better to use a functional. Each functional is tailored for a specific task, so when you recognise the functional you immediately know why it’s being used. Functionals play other roles as well as replacements for for-loops. They are useful for encapsulating common data manipulation tasks like split-apply-combine, for thinking “functionally”, and for working with mathematical functions.</p>
<p>Functionals reduce bugs in your code by better communicating intent. Functionals implemented in base R and purrr are well tested (i.e., bug-free) and efficient, because they’re used by so many people. Many are written in C, and use special tricks to enhance performance. That said, using functionals will not always produce the fastest code. Instead, it helps you clearly communicate and build tools that solve a wide range of problems. It’s a mistake to focus on speed until you know it’ll be a problem. Once you have clear, correct code you can make it fast using the techniques you’ll learn in Section <a href="profiling.html#profiling">24</a>.</p>
<p>Using functionals is a pattern matching exercise. You look at the for loop, and find a functional that matches the basic form. If one doesn’t exist, don’t try and torture an existing functional to fit the form you need. Instead, just leave it as a for loop!</p>
<p>It’s not about eliminating for loops. It’s about having someone else write them for you!</p>
<div id="outline-5" class="section level3 unnumbered">
<h3>Outline</h3>
<!--
* [My first functional: lapply()](#lapply) introduces your first functional:
  `lapply()`.

* [For loop functionals](#functionals-loop) shows you variants of `lapply()` 
  that produce different outputs, take different inputs, and distribute
  computation in different ways.

* [Data structure functionals](#functionals-ds) discusses functionals that 
  work with more complex data structures like matrices and arrays.

* [Functional programming](#functionals-fp) teaches you about the powerful
  `Reduce()` and `Filter()` functions which are useful for working with 
  lists.

* [Lists of functions](#lists-of-functions) shows how to put functions in a 
  list, and explains why you might care.

* [Mathematical functionals](#functionals-math) discusses functionals that you 
  might be familiar with from mathematics, like root finding, integration, and 
  optimisation.

* [Loops that shouldn't be converted to functions](#functionals-not) provides
  some important caveats about when you shouldn't attempt to convert a loop into
  a functional.

* [A family of functions](#function-family) finishes off the chapter by 
  showing you how functionals can take a simple building block and use it to
  create a set of powerful and consistent tools.
-->
</div>
<div id="prerequisites-3" class="section level3 unnumbered">
<h3>Prerequisites</h3>
<p>This chapter will focus on functionals provided by the purrr package. These functions have a consistent interface that makes it easier to understand the key ideas than their base equivalents, which have grown organically over many years. I’ll compare and contrast base R functions as we go, and then wrap up the chapter with a discussion of base functionals that don’t have purrr equivalents.</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb350-1" data-line-number="1"><span class="kw">library</span>(purrr)</a></code></pre></div>
<p>Many R users feel guilty about using for loops instead of apply functions. It’s natural to blame yourself for failing to understand and internalise the apply family of functions. However, I think this is like blaming yourself when embarass yourself by failing to pull open a door when it’s supposed to be pushed open<a href="#fn31" class="footnote-ref" id="fnref31"><sup>31</sup></a>. It’s not actually your fault, because many people suffer the same problem; it’s a failing of design. Similarly, I think the reason why the apply functions are so hard for so many people is because their design is suboptimal.</p>
</div>
</div>
<div id="map" class="section level2">
<h2><span class="header-section-number">10.2</span> My first functional: <code>map()</code></h2>

<p>The most fundamental functional is <code>purrr::map()</code><a href="#fn32" class="footnote-ref" id="fnref32"><sup>32</sup></a>. It takes a vector and a function, calls the function once for each element of the vector, and returns the results in a list. In other words, <code>map(1:3, f)</code> yields <code>list(f(x[[1]]), f(x[[2]]), f(x[[3]]))</code>.</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb351-1" data-line-number="1">triple &lt;-<span class="st"> </span><span class="cf">function</span>(x) x <span class="op">*</span><span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb351-2" data-line-number="2"><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, triple)</a>
<a class="sourceLine" id="cb351-3" data-line-number="3"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb351-4" data-line-number="4"><span class="co">#&gt; [1] 3</span></a>
<a class="sourceLine" id="cb351-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb351-6" data-line-number="6"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb351-7" data-line-number="7"><span class="co">#&gt; [1] 6</span></a>
<a class="sourceLine" id="cb351-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb351-9" data-line-number="9"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb351-10" data-line-number="10"><span class="co">#&gt; [1] 9</span></a></code></pre></div>
<p>Or, graphically:</p>
<p><img src="diagrams/functionals/map.png" style="display: block; margin: auto;" /></p>
<div class="sidebar">
<p>You might wonder why this function is called <code>map()</code>. What does it have to do with depicting physical features of land or sea 🗺? In fact, the meaning comes from mathematics where map refers to “an operation that associates each element of a given set with one or more elements of a second set”. This makes sense here because <code>map()</code> defines a mapping from one vector to another. (“Map” also has the nice property of being short, which useful for such a fundamental building block.)</p>
</div>
<p>The implementation of <code>map()</code> is quite simple. We allocate a list the same length as the input, and then fill in the list with a for loop. The basic implementation is only a handful of lines of code:</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb352-1" data-line-number="1">simple_map &lt;-<span class="st"> </span><span class="cf">function</span>(x, f, ...) {</a>
<a class="sourceLine" id="cb352-2" data-line-number="2">  out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="kw">length</span>(x))</a>
<a class="sourceLine" id="cb352-3" data-line-number="3">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(x)) {</a>
<a class="sourceLine" id="cb352-4" data-line-number="4">    out[[i]] &lt;-<span class="st"> </span><span class="kw">f</span>(x[[i]], ...)</a>
<a class="sourceLine" id="cb352-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb352-6" data-line-number="6">  out</a>
<a class="sourceLine" id="cb352-7" data-line-number="7">}</a></code></pre></div>
<p>The real <code>purrr::map()</code> function has a few differences: it is written in C to eke out every last iota of performance, preserves names, and supports a few shortcuts that you’ll learn about shortly.</p>
<div class="base">
<p>The base equivalent to <code>map()</code> is <code>lapply()</code>. The only difference is that <code>lappy()</code> does not support the helpers that you’ll learn about below, so if you’re only using <code>map()</code> from purrr, you can skip the additional package and use <code>base::lapply()</code> directly.</p>
</div>
<div id="producing-atomic-vectors" class="section level3">
<h3><span class="header-section-number">10.2.1</span> Producing atomic vectors</h3>
<p><code>map()</code> returns a list. This makes <code>map()</code> the most general of the “map” family because you can put anything in a list. There are four more specific variants, <code>map_lgl()</code>, <code>map_int()</code>, <code>map_dbl()</code> and <code>map_chr()</code>, that return atomic vectors:</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb353-1" data-line-number="1"><span class="kw">map_chr</span>(mtcars, typeof)</a>
<a class="sourceLine" id="cb353-2" data-line-number="2"><span class="co">#&gt;      mpg      cyl     disp       hp     drat       wt     qsec       vs </span></a>
<a class="sourceLine" id="cb353-3" data-line-number="3"><span class="co">#&gt; &quot;double&quot; &quot;double&quot; &quot;double&quot; &quot;double&quot; &quot;double&quot; &quot;double&quot; &quot;double&quot; &quot;double&quot; </span></a>
<a class="sourceLine" id="cb353-4" data-line-number="4"><span class="co">#&gt;       am     gear     carb </span></a>
<a class="sourceLine" id="cb353-5" data-line-number="5"><span class="co">#&gt; &quot;double&quot; &quot;double&quot; &quot;double&quot;</span></a>
<a class="sourceLine" id="cb353-6" data-line-number="6"></a>
<a class="sourceLine" id="cb353-7" data-line-number="7"><span class="kw">map_lgl</span>(mtcars, is.double)</a>
<a class="sourceLine" id="cb353-8" data-line-number="8"><span class="co">#&gt;  mpg  cyl disp   hp drat   wt qsec   vs   am gear carb </span></a>
<a class="sourceLine" id="cb353-9" data-line-number="9"><span class="co">#&gt; TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE</span></a>
<a class="sourceLine" id="cb353-10" data-line-number="10"></a>
<a class="sourceLine" id="cb353-11" data-line-number="11"><span class="kw">map_dbl</span>(mtcars, mean)</a>
<a class="sourceLine" id="cb353-12" data-line-number="12"><span class="co">#&gt;     mpg     cyl    disp      hp    drat      wt    qsec      vs      am </span></a>
<a class="sourceLine" id="cb353-13" data-line-number="13"><span class="co">#&gt;  20.091   6.188 230.722 146.688   3.597   3.217  17.849   0.438   0.406 </span></a>
<a class="sourceLine" id="cb353-14" data-line-number="14"><span class="co">#&gt;    gear    carb </span></a>
<a class="sourceLine" id="cb353-15" data-line-number="15"><span class="co">#&gt;   3.688   2.812</span></a>
<a class="sourceLine" id="cb353-16" data-line-number="16"></a>
<a class="sourceLine" id="cb353-17" data-line-number="17">n_unique &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">length</span>(<span class="kw">unique</span>(x))</a>
<a class="sourceLine" id="cb353-18" data-line-number="18"><span class="kw">map_int</span>(mtcars, n_unique)</a>
<a class="sourceLine" id="cb353-19" data-line-number="19"><span class="co">#&gt;  mpg  cyl disp   hp drat   wt qsec   vs   am gear carb </span></a>
<a class="sourceLine" id="cb353-20" data-line-number="20"><span class="co">#&gt;   25    3   27   22   22   29   30    2    2    3    6</span></a></code></pre></div>
<p>These examples rely on the fact that data frames are lists containing vectors of the same length:</p>
<p><img src="diagrams/functionals/map-list.png" style="display: block; margin: auto;" /></p>
<p>Like <code>map()</code>, the input and the output must be the same length, so you can not return multiple values. When debugging problems like this, it’s often useful to switch back to <code>map()</code> so you can see what the problematic output is.</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb354-1" data-line-number="1">pair &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">c</span>(x, x)</a>
<a class="sourceLine" id="cb354-2" data-line-number="2"><span class="kw">map_dbl</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, pair)</a>
<a class="sourceLine" id="cb354-3" data-line-number="3"><span class="co">#&gt; Error: Result 1 is not a length 1 atomic vector</span></a>
<a class="sourceLine" id="cb354-4" data-line-number="4"></a>
<a class="sourceLine" id="cb354-5" data-line-number="5"><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, pair)</a>
<a class="sourceLine" id="cb354-6" data-line-number="6"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb354-7" data-line-number="7"><span class="co">#&gt; [1] 1 1</span></a>
<a class="sourceLine" id="cb354-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb354-9" data-line-number="9"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb354-10" data-line-number="10"><span class="co">#&gt; [1] 2 2</span></a>
<a class="sourceLine" id="cb354-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb354-12" data-line-number="12"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb354-13" data-line-number="13"><span class="co">#&gt; [1] 3 3</span></a></code></pre></div>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb355-1" data-line-number="1">simple_map_dbl &lt;-<span class="st"> </span><span class="cf">function</span>(x, f, ...) {</a>
<a class="sourceLine" id="cb355-2" data-line-number="2">  out &lt;-<span class="st"> </span><span class="kw">double</span>(<span class="kw">length</span>(x))</a>
<a class="sourceLine" id="cb355-3" data-line-number="3">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(x)) {</a>
<a class="sourceLine" id="cb355-4" data-line-number="4">    val &lt;-<span class="st"> </span><span class="kw">f</span>(x[[i]], ...)</a>
<a class="sourceLine" id="cb355-5" data-line-number="5">    <span class="cf">if</span> (<span class="kw">length</span>(val) <span class="op">!=</span><span class="st"> </span><span class="dv">1</span> <span class="op">||</span><span class="st"> </span><span class="op">!</span><span class="kw">is.numeric</span>(out)) {</a>
<a class="sourceLine" id="cb355-6" data-line-number="6">      <span class="kw">stop</span>(<span class="st">&quot;Result &quot;</span>, i, <span class="st">&quot; is not a length 1 atomic vector&quot;</span>, <span class="dt">call. =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb355-7" data-line-number="7">    }</a>
<a class="sourceLine" id="cb355-8" data-line-number="8">    out[[i]] &lt;-<span class="st"> </span>val</a>
<a class="sourceLine" id="cb355-9" data-line-number="9">  }</a>
<a class="sourceLine" id="cb355-10" data-line-number="10">  out</a>
<a class="sourceLine" id="cb355-11" data-line-number="11">}</a></code></pre></div>
<div class="base">
<p>Base R has two similar functions: <code>sapply()</code> and <code>vapply()</code>.</p>
<p><code>sapply()</code> tries to simplify the result to an atomic vector, whereever possible. But this simplifiation depends on the input, so sometimes you’ll get a list, sometimes a vector, and sometimes a matrix. This makes it difficult to program with.</p>
<p><code>vapply()</code> allows you to provide a template that describes the output shape. If you want to stick to with base R code you should always use <code>vapply()</code> in your functions, not <code>sapply()</code>. The primary downside of <code>vapply()</code> is its vebosity: the equivalent to <code>map_dbl(x, mean, na.rm = TRUE)</code> is <code>vapply(x, mean, na.rm = TRUE, FUN.VALUE = double())</code>.</p>
</div>
</div>
<div id="anonymous-functions-and-helpers" class="section level3">
<h3><span class="header-section-number">10.2.2</span> Anonymous functions and helpers</h3>
<p>Instead of using <code>map()</code> with an existing function, you can create an inline anonymous function (as mentioned in Section (first-class-functions)):</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb356-1" data-line-number="1"><span class="kw">map_dbl</span>(mtcars, <span class="cf">function</span>(x) <span class="kw">length</span>(<span class="kw">unique</span>(x)))</a>
<a class="sourceLine" id="cb356-2" data-line-number="2"><span class="co">#&gt;  mpg  cyl disp   hp drat   wt qsec   vs   am gear carb </span></a>
<a class="sourceLine" id="cb356-3" data-line-number="3"><span class="co">#&gt;   25    3   27   22   22   29   30    2    2    3    6</span></a></code></pre></div>
<p>Anonymous functions are very useful, but the syntax is verbose. So purrr offers a shorthand:</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb357-1" data-line-number="1"><span class="kw">map_dbl</span>(mtcars, <span class="op">~</span><span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(.x)))</a>
<a class="sourceLine" id="cb357-2" data-line-number="2"><span class="co">#&gt;  mpg  cyl disp   hp drat   wt qsec   vs   am gear carb </span></a>
<a class="sourceLine" id="cb357-3" data-line-number="3"><span class="co">#&gt;   25    3   27   22   22   29   30    2    2    3    6</span></a></code></pre></div>
<p>That also makes for a handy way of generating random data:</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb358-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="op">~</span><span class="st"> </span><span class="kw">runif</span>(<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb358-2" data-line-number="2"><span class="kw">str</span>(x)</a>
<a class="sourceLine" id="cb358-3" data-line-number="3"><span class="co">#&gt; List of 3</span></a>
<a class="sourceLine" id="cb358-4" data-line-number="4"><span class="co">#&gt;  $ : num [1:2] 0.281 0.53</span></a>
<a class="sourceLine" id="cb358-5" data-line-number="5"><span class="co">#&gt;  $ : num [1:2] 0.433 0.917</span></a>
<a class="sourceLine" id="cb358-6" data-line-number="6"><span class="co">#&gt;  $ : num [1:2] 0.0275 0.8249</span></a></code></pre></div>
<p>Reserve this syntax for short and simple functions. A good rule of thumb is that if your function involves spans lines or uses <code>{}</code>, it’s time to name your function.</p>
<p>Inside all purrr functions you can create an anonymous function using a <code>~</code> (the usual formula operator, pronouned “twiddle”). You can see what happens by calling <code>as_mapper()</code>: the map functions normally do that for you, but it’s useful to do it “by hand” to see what’s going on:</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb359-1" data-line-number="1"><span class="kw">as_mapper</span>(<span class="op">~</span><span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(.x)))</a>
<a class="sourceLine" id="cb359-2" data-line-number="2"><span class="co">#&gt; function (..., .x = ..1, .y = ..2, . = ..1) </span></a>
<a class="sourceLine" id="cb359-3" data-line-number="3"><span class="co">#&gt; length(unique(.x))</span></a></code></pre></div>
<p>The function arguments look a little quirky but allow you to refer to <code>.</code> for one argument functions, <code>.x</code> and <code>.y.</code> for two argument functions, and <code>..1</code>, <code>..2</code>, <code>..3</code>, etc, for functions with an arbitrary number of arguments.</p>
<p>purrr also provides helpers for extracting elements from a vector, powered by <code>purrr::pluck()</code>. You can use a character vector to select elements by name, an integer vector to select by position, or a list to select by both name and position. These are very useful for working with deeply nested lists, which often arise when working with JSON.</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb360-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb360-2" data-line-number="2">  <span class="kw">list</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">2</span>), <span class="dt">z =</span> <span class="st">&quot;a&quot;</span>),</a>
<a class="sourceLine" id="cb360-3" data-line-number="3">  <span class="kw">list</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dt">x =</span> <span class="dv">4</span>, <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">6</span>), <span class="dt">z =</span> <span class="st">&quot;b&quot;</span>),</a>
<a class="sourceLine" id="cb360-4" data-line-number="4">  <span class="kw">list</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dt">x =</span> <span class="dv">8</span>, <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>))</a>
<a class="sourceLine" id="cb360-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb360-6" data-line-number="6"></a>
<a class="sourceLine" id="cb360-7" data-line-number="7"><span class="co"># Select by name</span></a>
<a class="sourceLine" id="cb360-8" data-line-number="8"><span class="kw">map_dbl</span>(x, <span class="st">&quot;x&quot;</span>)</a>
<a class="sourceLine" id="cb360-9" data-line-number="9"><span class="co">#&gt; [1] 1 4 8</span></a>
<a class="sourceLine" id="cb360-10" data-line-number="10"></a>
<a class="sourceLine" id="cb360-11" data-line-number="11"><span class="co"># Or by position</span></a>
<a class="sourceLine" id="cb360-12" data-line-number="12"><span class="kw">map_dbl</span>(x, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb360-13" data-line-number="13"><span class="co">#&gt; [1] -1 -2 -3</span></a>
<a class="sourceLine" id="cb360-14" data-line-number="14"></a>
<a class="sourceLine" id="cb360-15" data-line-number="15"><span class="co"># Or by both</span></a>
<a class="sourceLine" id="cb360-16" data-line-number="16"><span class="kw">map_dbl</span>(x, <span class="kw">list</span>(<span class="st">&quot;y&quot;</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb360-17" data-line-number="17"><span class="co">#&gt; [1] 2 5 9</span></a>
<a class="sourceLine" id="cb360-18" data-line-number="18"></a>
<a class="sourceLine" id="cb360-19" data-line-number="19"><span class="co"># You&#39;ll get an error if a component doesn&#39;t exist:</span></a>
<a class="sourceLine" id="cb360-20" data-line-number="20"><span class="kw">map_chr</span>(x, <span class="st">&quot;z&quot;</span>)</a>
<a class="sourceLine" id="cb360-21" data-line-number="21"><span class="co">#&gt; Error: Result 3 is not a length 1 atomic vector</span></a>
<a class="sourceLine" id="cb360-22" data-line-number="22"><span class="co"># Unless you supply a .default value</span></a>
<a class="sourceLine" id="cb360-23" data-line-number="23"><span class="kw">map_chr</span>(x, <span class="st">&quot;z&quot;</span>, <span class="dt">.default =</span> <span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb360-24" data-line-number="24"><span class="co">#&gt; [1] &quot;a&quot; &quot;b&quot; NA</span></a></code></pre></div>
<div class="base">
<p>In base R functions, like <code>lapply()</code>, you can provide the name of the function as a string. This isn’t tremendously useful as most of the time <code>lapply(x, &quot;f&quot;)</code> is exactly equivalent to <code>lapply(x, f)</code>, just more typing.</p>
</div>
</div>
<div id="passing-arguments" class="section level3">
<h3><span class="header-section-number">10.2.3</span> Passing arguments with <code>...</code></h3>
<p>It’s often convenient to pass on along additional arguments to the function that you’re calling. For example, you might want to pass <code>na.rm = TRUE</code> along to <code>mean()</code>. One way to do that is with an anonymous function:</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb361-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="ot">NA</span>))</a>
<a class="sourceLine" id="cb361-2" data-line-number="2"><span class="kw">map_dbl</span>(x, <span class="op">~</span><span class="st"> </span><span class="kw">mean</span>(.x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb361-3" data-line-number="3"><span class="co">#&gt; [1] 3.0 5.5</span></a></code></pre></div>
<p>But because the map functions pass <code>...</code> along, there’s a simpler form available:</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb362-1" data-line-number="1"><span class="kw">map_dbl</span>(x, mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb362-2" data-line-number="2"><span class="co">#&gt; [1] 3.0 5.5</span></a></code></pre></div>
<p>This is easiest to understand with a picture: any arguments that come after <code>f</code> in the call to <code>map()</code> are inserted <em>after</em> the data in individual calls to <code>f()</code>:</p>
<p><img src="diagrams/functionals/map-arg.png" style="display: block; margin: auto;" /></p>
<p>It’s important to note that these arguments are not decomposed; or said another way, <code>map()</code> is only vectorised over its first argument. If an argument after <code>f</code> is a vector, it will be passed along as is, not decomposed like the first argument:</p>
<p><img src="diagrams/functionals/map-arg-recycle.png" style="display: block; margin: auto;" /></p>
<p>Note there’s a subtle difference between placing extra arguments inside an anonymous function compared with passing them to <code>map()</code>. Putting them in anonymous function means that they will be evaluated every time <code>f()</code> is executed, not just once when you call <code>map()</code>. This is easiest to see if we make the additional argument random:</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb363-1" data-line-number="1">plus &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) x <span class="op">+</span><span class="st"> </span>y</a>
<a class="sourceLine" id="cb363-2" data-line-number="2"></a>
<a class="sourceLine" id="cb363-3" data-line-number="3">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb363-4" data-line-number="4"><span class="kw">map_dbl</span>(x, plus, <span class="kw">runif</span>(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb363-5" data-line-number="5"><span class="co">#&gt; [1] 0.0625 0.0625 0.0625 0.0625</span></a>
<a class="sourceLine" id="cb363-6" data-line-number="6"><span class="kw">map_dbl</span>(x, <span class="op">~</span><span class="st"> </span><span class="kw">plus</span>(.x, <span class="kw">runif</span>(<span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb363-7" data-line-number="7"><span class="co">#&gt; [1] 0.903 0.132 0.629 0.945</span></a></code></pre></div>
</div>
<div id="argument-names" class="section level3">
<h3><span class="header-section-number">10.2.4</span> Argument names</h3>
<p>In the diagrams, I’ve omitted argument names to focus on the overall structure. But I recommend writing out the full names in your code, as it makes it easier to read. <code>map(x, mean, 0.1)</code> is perfectly valid code, but it generates <code>mean(x[[1]], 0.1)</code> so it relies on the reader remembering that the second argument to <code>mean()</code> is <code>trim</code>. To avoid unnecesary burden on the brain of the reader<a href="#fn33" class="footnote-ref" id="fnref33"><sup>33</sup></a>, be kind, and write <code>map(x, mean, trim = 0.1)</code>.</p>
<p>This is the reason why the arguments to <code>map()</code> are a little odd: instead of being <code>x</code> and <code>f</code>, they are <code>.x</code> and <code>.f</code>. It’s easiest to the problem that leads to these names using <code>simple_map()</code> defined above. <code>simple_map()</code> has arguments <code>x</code> and <code>f</code> so you’ll have problems whenever the function you are calling has arguments <code>x</code> or <code>f</code>:</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb364-1" data-line-number="1">boostrap_summary &lt;-<span class="st"> </span><span class="cf">function</span>(x, f) {</a>
<a class="sourceLine" id="cb364-2" data-line-number="2">  <span class="kw">f</span>(<span class="kw">sample</span>(x, <span class="dt">replace =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb364-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb364-4" data-line-number="4"></a>
<a class="sourceLine" id="cb364-5" data-line-number="5"><span class="kw">simple_map</span>(mtcars, boostrap_summary, <span class="dt">f =</span> mean)</a>
<a class="sourceLine" id="cb364-6" data-line-number="6"><span class="co">#&gt; Error in mean.default(x[[i]], ...):</span></a>
<a class="sourceLine" id="cb364-7" data-line-number="7"><span class="co">#&gt;   &#39;trim&#39; must be numeric of length one</span></a></code></pre></div>
<p>The error is a little bewildering until you remember that the call to <code>simple_map()</code> is equivalent to <code>simple_map(x = mtcars, f = mean, bootstrap_summary)</code> because named matching beats positional matching.</p>
<p>purrr functions reduce the likelihood of such a clash by using <code>.f</code> and <code>.x</code> instead of the more common <code>f</code> and <code>x</code>. Of course this technique isn’t perfect (because the function you are calling might still use <code>.f</code> and <code>.x</code>), but it avoids 99% of issues. The remaining 1% of the time, use an anonymous function.</p>
<div class="base">
<p>Base functions that pass along <code>...</code> use a variety of naming conventions to prevent undesired argument matching:</p>
<ul>
<li><p>The apply family mostly uses capital letters (e.g <code>X</code> and <code>FUN</code>).</p></li>
<li><p><code>transform()</code> uses more exotic prefix <code>_</code>: this makes the name non-syntactic
so it must always be surrounded in <code>`</code>, as described in
Section <a href="names-values.html#non-syntactic">3.2.1</a>. This makes undesired matches extremely
unlikely.</p></li>
<li>Other functional like <code>uniroot()</code> and <code>optim()</code> make no effort to avoid
clashes; but they tend to be used with specially created funtions so
clashes are less likely.</li>
</ul>
</div>
</div>
<div id="change-argument" class="section level3">
<h3><span class="header-section-number">10.2.5</span> Varying another argument</h3>
<p>So far the first argument to <code>map()</code> has always become the first argument to the function. But what happens if the first argument should be constant, and you want to vary a different argument? How do you get the result in this picture?</p>
<p><img src="diagrams/functionals/map-arg-flipped.png" style="display: block; margin: auto;" /></p>
<p>It turns out that there’s no way to do it directly, but there are two tricks you can use. To illustrate them, imagine I have a vector that contains a few unusual values, and I want to explore the effective of different amounts of trimming when computing the mean. In this case, the first argument to <code>mean()</code> will be constant, and I want to vary the second argument, <code>trim</code>.</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb365-1" data-line-number="1">trims &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb365-2" data-line-number="2">x &lt;-<span class="st"> </span><span class="kw">rcauchy</span>(<span class="dv">1000</span>)</a></code></pre></div>
<ul>
<li><p>The simplest technique is to use an anonymous function to rearrange the
argument order:</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb366-1" data-line-number="1"><span class="kw">map_dbl</span>(trims, <span class="op">~</span><span class="st"> </span><span class="kw">mean</span>(x, <span class="dt">trim =</span> .x))</a>
<a class="sourceLine" id="cb366-2" data-line-number="2"><span class="co">#&gt; [1] -0.3500  0.0434  0.0354  0.0502</span></a></code></pre></div></li>
<li><p>Sometimes, if you want to be (too) clever, you can take advantage of R’s
flexible argument matching rules (as described in Section
<a href="#prefix-form"><strong>??</strong></a>). For example, in this example you can rewrite
<code>mean(x, trim = 0.1)</code> as <code>mean(0.1, x = x)</code>, so you could write the
call to <code>map_dbl()</code> as:</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb367-1" data-line-number="1"><span class="kw">map_dbl</span>(trims, mean, <span class="dt">x =</span> x)</a>
<a class="sourceLine" id="cb367-2" data-line-number="2"><span class="co">#&gt; [1] -0.3500  0.0434  0.0354  0.0502</span></a></code></pre></div>
<p>I don’t recommend this technique as it relies on the reader
being very familiar with both the argument order to <code>.f</code>, and R’s
argument matching rules.</p></li>
</ul>
<p>You’ll see one more approach to this problem that in Section <a href="functionals.html#pmap">10.3.5</a>.</p>
</div>
<div id="exercises-27" class="section level3">
<h3><span class="header-section-number">10.2.6</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Use <code>as_mapper()</code> to explore how purrr generates anonymous functions for
the integer, character, and list helpers. What helper allows you to
extract attributes? Read the documentation to find out.</p></li>
<li><p><code>map(1:3, ~ runif(2))</code> is a useful pattern for generating random
numbers, but <code>map(1:3, runif(2))</code> is not. Why not? Can you explain why
it returns the result that it does?</p></li>
<li><p>Use the appropriate <code>map()</code> function to:</p>
<ol style="list-style-type: lower-alpha">
<li><p>Compute the standard deviation of every column in a numeric data frame.</p></li>
<li><p>Compute the standard deviation of every numeric column in a mixed data
frame. (Hint: you’ll need to do it in two steps.)</p></li>
<li><p>Compute the number of levels for in every factor in a data frame.</p></li>
</ol></li>
<li><p>The following code simulates the performance of a t-test for non-normal
data. Extract the p-value from each test, then visualise.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb368-1" data-line-number="1">trials &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, <span class="op">~</span><span class="st"> </span><span class="kw">t.test</span>(<span class="kw">rpois</span>(<span class="dv">10</span>, <span class="dv">10</span>), <span class="kw">rpois</span>(<span class="dv">7</span>, <span class="dv">10</span>)))</a></code></pre></div></li>
<li><p>The following code uses a map nested inside another map to apply a
function to every element of a nested list. Why does it fail, and
what do you need to do to make it work?</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb369-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb369-2" data-line-number="2">  <span class="kw">list</span>(<span class="dv">1</span>, <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">9</span>)),</a>
<a class="sourceLine" id="cb369-3" data-line-number="3">  <span class="kw">list</span>(<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">6</span>), <span class="dv">7</span>, <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">6</span>))</a>
<a class="sourceLine" id="cb369-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb369-5" data-line-number="5"></a>
<a class="sourceLine" id="cb369-6" data-line-number="6">triple &lt;-<span class="st"> </span><span class="cf">function</span>(x) x <span class="op">*</span><span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb369-7" data-line-number="7"><span class="kw">map</span>(x, map, <span class="dt">.f =</span> triple)</a>
<a class="sourceLine" id="cb369-8" data-line-number="8"><span class="co">#&gt; Error in .f(.x[[i]], ...):</span></a>
<a class="sourceLine" id="cb369-9" data-line-number="9"><span class="co">#&gt;   unused argument (map)</span></a></code></pre></div></li>
<li><p>Use <code>map()</code> to fit linear models to the <code>mtcars</code> using the formulas stored
in this list:</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb370-1" data-line-number="1">formulas &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb370-2" data-line-number="2">  mpg <span class="op">~</span><span class="st"> </span>disp,</a>
<a class="sourceLine" id="cb370-3" data-line-number="3">  mpg <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>disp),</a>
<a class="sourceLine" id="cb370-4" data-line-number="4">  mpg <span class="op">~</span><span class="st"> </span>disp <span class="op">+</span><span class="st"> </span>wt,</a>
<a class="sourceLine" id="cb370-5" data-line-number="5">  mpg <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>disp) <span class="op">+</span><span class="st"> </span>wt</a>
<a class="sourceLine" id="cb370-6" data-line-number="6">)</a></code></pre></div></li>
<li><p>Fit the model <code>mpg ~ disp</code> to each of the bootstrap replicates of <code>mtcars</code>
in the list below, then extract the <span class="math inline">\(R^2\)</span> of the model fit (Hint: you can
compute the <span class="math inline">\(R^2\)</span> with <code>summary()</code>)</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb371-1" data-line-number="1">bootstrap &lt;-<span class="st"> </span><span class="cf">function</span>(df) {</a>
<a class="sourceLine" id="cb371-2" data-line-number="2">  df[<span class="kw">sample</span>(<span class="kw">nrow</span>(df), <span class="dt">replace =</span> <span class="ot">TRUE</span>), , drop =<span class="st"> </span><span class="ot">FALSE</span>]</a>
<a class="sourceLine" id="cb371-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb371-4" data-line-number="4"></a>
<a class="sourceLine" id="cb371-5" data-line-number="5">bootstraps &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="op">~</span><span class="st"> </span><span class="kw">bootstrap</span>(mtcars))</a></code></pre></div></li>
</ol>
</div>
</div>
<div id="functionals-loop" class="section level2">
<h2><span class="header-section-number">10.3</span> Map variants</h2>
<p>There are 23 primary variants of <code>map()</code>. So far, you’ve learned about five (<code>map()</code>, <code>map_lgl()</code>, <code>map_int()</code>, <code>map_dbl()</code> and <code>map_chr()</code>). That means that you’ve got 18 (!!) more to learn. That sounds like a lot, but fortunately the design of purrr means that you only need to learn five new ideas:</p>
<ul>
<li>Output same type as input with <code>modify()</code></li>
<li>Iterate over two inputs with <code>map2()</code>.</li>
<li>Iterate with an index using <code>imap()</code></li>
<li>Return nothing with <code>walk()</code>.</li>
<li>Iterate over any number of inputs with <code>pmap()</code>.</li>
</ul>
<p>The map family of functions has orthogonal input and outputs, meaning that we can organise all the family into a matrix, with inputs in the rows and outputs in the columns. Once you’ve mastered the idea in a row, you can combine it with any column; once you’ve mastered the idea in column, you can combine it with any row.</p>
<table>
<thead>
<tr class="header">
<th></th>
<th>List</th>
<th>Atomic</th>
<th>Same type</th>
<th>Nothing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>One argument</td>
<td><code>map()</code></td>
<td><code>map_lgl()</code>, …</td>
<td><code>modify()</code></td>
<td><code>walk()</code></td>
</tr>
<tr class="even">
<td>Two arguments</td>
<td><code>map2()</code></td>
<td><code>map2_lgl()</code>, …</td>
<td><code>modify2()</code></td>
<td><code>walk2()</code></td>
</tr>
<tr class="odd">
<td>One argument + index</td>
<td><code>imap()</code></td>
<td><code>imap_lgl()</code>, …</td>
<td><code>imodify()</code></td>
<td><code>iwalk()</code></td>
</tr>
<tr class="even">
<td>N arguments</td>
<td><code>pmap()</code></td>
<td><code>pmap_lgl()</code>, …</td>
<td>—</td>
<td><code>pwalk()</code></td>
</tr>
</tbody>
</table>
<div id="modify" class="section level3">
<h3><span class="header-section-number">10.3.1</span> Same type of output as input: <code>modify()</code></h3>

<p>Imagine you wanted to double every column in a data frame. You might first try using <code>map()</code>, but <code>map()</code> always returns a list:</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb372-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb372-2" data-line-number="2">  <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb372-3" data-line-number="3">  <span class="dt">y =</span> <span class="dv">6</span><span class="op">:</span><span class="dv">4</span></a>
<a class="sourceLine" id="cb372-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb372-5" data-line-number="5"></a>
<a class="sourceLine" id="cb372-6" data-line-number="6"><span class="kw">map</span>(df, <span class="op">~</span><span class="st"> </span>.x <span class="op">*</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb372-7" data-line-number="7"><span class="co">#&gt; $x</span></a>
<a class="sourceLine" id="cb372-8" data-line-number="8"><span class="co">#&gt; [1] 2 4 6</span></a>
<a class="sourceLine" id="cb372-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb372-10" data-line-number="10"><span class="co">#&gt; $y</span></a>
<a class="sourceLine" id="cb372-11" data-line-number="11"><span class="co">#&gt; [1] 12 10  8</span></a></code></pre></div>
<p>If you want to keep the output as a data frame, you can use <code>modify()</code>, which always returns the same type of output as the input:</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb373-1" data-line-number="1"><span class="kw">modify</span>(df, <span class="op">~</span><span class="st"> </span>.x <span class="op">*</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb373-2" data-line-number="2"><span class="co">#&gt;   x  y</span></a>
<a class="sourceLine" id="cb373-3" data-line-number="3"><span class="co">#&gt; 1 2 12</span></a>
<a class="sourceLine" id="cb373-4" data-line-number="4"><span class="co">#&gt; 2 4 10</span></a>
<a class="sourceLine" id="cb373-5" data-line-number="5"><span class="co">#&gt; 3 6  8</span></a></code></pre></div>
<p>Despite the name, <code>modify()</code> doesn’t modify in place, it returns a modified copy, so if you wanted to permanently modify <code>df</code>, you’d need to assign it:</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb374-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">modify</span>(df, <span class="op">~</span><span class="st"> </span>.x <span class="op">*</span><span class="st"> </span><span class="dv">2</span>)</a></code></pre></div>
<p>As usual, the basic implementation of <code>modify()</code> is simple, and in fact it’s even simpler than <code>map()</code> because we don’t need to create a new output vector; we can just progressively replace the input. The real code is a little complex to handle edge cases more gracefully.</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb375-1" data-line-number="1">simple_modify &lt;-<span class="st"> </span><span class="cf">function</span>(x, f, ...) {</a>
<a class="sourceLine" id="cb375-2" data-line-number="2">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(x)) {</a>
<a class="sourceLine" id="cb375-3" data-line-number="3">    x[[i]] &lt;-<span class="st"> </span><span class="kw">f</span>(x[[i]], ...)</a>
<a class="sourceLine" id="cb375-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb375-5" data-line-number="5">  x</a>
<a class="sourceLine" id="cb375-6" data-line-number="6">}</a></code></pre></div>
<p>In Section @(predicate-map) you’ll learn about a very useful variant of <code>modify()</code>, called <code>modify_if()</code>. This allows you to (e.g.) only double <em>numeric</em> columns of a data frame with <code>modify_if(df, is.numeric, ~ .x * 2)</code>.</p>
</div>
<div id="map2" class="section level3">
<h3><span class="header-section-number">10.3.2</span> Two inputs: <code>map2()</code> and friends</h3>

<p><code>map()</code> is vectorised over a single argument, <code>.x</code>. This means it only varies <code>.x</code> when calling <code>.f</code>, all other arguments are passed along unchanged. This makes it poorly suited for some problems. For example, how would you find a weighted mean when you have a list of observations and a list of weights? Imagine we have the following data:</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb376-1" data-line-number="1">xs &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">8</span>, <span class="op">~</span><span class="st"> </span><span class="kw">runif</span>(<span class="dv">10</span>))</a>
<a class="sourceLine" id="cb376-2" data-line-number="2">xs[[<span class="dv">1</span>]][[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb376-3" data-line-number="3">ws &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">8</span>, <span class="op">~</span><span class="st"> </span><span class="kw">rpois</span>(<span class="dv">10</span>, <span class="dv">5</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<p>You can use <code>map_dbl()</code> to compute the unweighted means:</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb377-1" data-line-number="1"><span class="kw">map_dbl</span>(xs, mean)</a>
<a class="sourceLine" id="cb377-2" data-line-number="2"><span class="co">#&gt; [1]    NA 0.463 0.551 0.453 0.564 0.501 0.371 0.443</span></a></code></pre></div>
<p>But passing <code>ws</code> as an additional argument doesn’t work because arguments after <code>.f</code> are not transformed:</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb378-1" data-line-number="1"><span class="kw">map_dbl</span>(xs, weighted.mean, <span class="dt">w =</span> ws)</a>
<a class="sourceLine" id="cb378-2" data-line-number="2"><span class="co">#&gt; Error in weighted.mean.default(.x[[i]], ...):</span></a>
<a class="sourceLine" id="cb378-3" data-line-number="3"><span class="co">#&gt;   &#39;x&#39; and &#39;w&#39; must have the same length</span></a></code></pre></div>
<p><img src="diagrams/functionals/map-arg-recycle.png" style="display: block; margin: auto;" /></p>
<p>We need a new tool: a <code>map2()</code>, which is vectorised over two arguments. This means both <code>.x</code> and <code>.y</code> are varied in each call to <code>.f</code>:</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb379-1" data-line-number="1"><span class="kw">map2_dbl</span>(xs, ws, weighted.mean)</a>
<a class="sourceLine" id="cb379-2" data-line-number="2"><span class="co">#&gt; [1]    NA 0.451 0.603 0.452 0.563 0.510 0.342 0.464</span></a></code></pre></div>
<p><img src="diagrams/functionals/map2.png" style="display: block; margin: auto;" /></p>
<p>The arguments to <code>map2()</code> are slightly different to the arguments to <code>map()</code> as two vectors come before the function, rather than one. Additional arguments still go afterwards:</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb380-1" data-line-number="1"><span class="kw">map2_dbl</span>(xs, ws, weighted.mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb380-2" data-line-number="2"><span class="co">#&gt; [1] 0.504 0.451 0.603 0.452 0.563 0.510 0.342 0.464</span></a></code></pre></div>
<p><img src="diagrams/functionals/map2-arg.png" style="display: block; margin: auto;" /></p>
<p>The basic implementation of <code>map2()</code> is simple, and quite similar to that of <code>map()</code>. Instead of iterating over one vector, we iterate over two in parallel:</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb381-1" data-line-number="1">simple_map2 &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, f, ...) {</a>
<a class="sourceLine" id="cb381-2" data-line-number="2">  out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="kw">length</span>(xs))</a>
<a class="sourceLine" id="cb381-3" data-line-number="3">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(x)) {</a>
<a class="sourceLine" id="cb381-4" data-line-number="4">    out[[i]] &lt;-<span class="st"> </span><span class="kw">f</span>(x[[i]], y[[i]], ...)</a>
<a class="sourceLine" id="cb381-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb381-6" data-line-number="6">  out</a>
<a class="sourceLine" id="cb381-7" data-line-number="7">}</a></code></pre></div>
<p>One of the big differences between <code>map2()</code> and the simple function above is that <code>map2()</code> recycles its inputs to make sure that they’re the same length:</p>
<p><img src="diagrams/functionals/map2-recycle.png" style="display: block; margin: auto;" /></p>
<p>In other words, <code>map2(x, y, f)</code> will automatically behave like <code>map(x, f, y)</code> when needed. This is helpful when writing functions; in scripts you’d generally just use the simpler form directly.</p>
<div class="base">
<p>The closest no base equivalent to <code>map2()</code> is <code>Map()</code>, which is discussed in Section <a href="functionals.html#pmap">10.3.5</a>.</p>
</div>
</div>
<div id="no-outputs-walk-and-friends" class="section level3">
<h3><span class="header-section-number">10.3.3</span> No outputs: <code>walk()</code> and friends</h3>

<p>Most functions are called for value that they return, so it makes sense to capture and store it with a <code>map()</code> function. But some functions are called primarily for their side-effects (e.g. <code>cat()</code>, <code>write.csv()</code>, or <code>ggsave()</code>) and it doesn’t make sense to capture their results. Take this simple example that displays a welcome message using <code>cat()</code>. <code>cat()</code> returns <code>NULL</code>, so while map works (in the sense that it generates the desired welcomes), it also returns <code>list(NULL, NULL)</code>.</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb382-1" data-line-number="1">welcome &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb382-2" data-line-number="2">  <span class="kw">cat</span>(<span class="st">&quot;Welcome &quot;</span>, x, <span class="st">&quot;!</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb382-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb382-4" data-line-number="4">names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Hadley&quot;</span>, <span class="st">&quot;Jenny&quot;</span>)</a>
<a class="sourceLine" id="cb382-5" data-line-number="5"></a>
<a class="sourceLine" id="cb382-6" data-line-number="6"><span class="co"># As well as generate the welcomes, it also shows </span></a>
<a class="sourceLine" id="cb382-7" data-line-number="7"><span class="co"># the return value of cat()</span></a>
<a class="sourceLine" id="cb382-8" data-line-number="8"><span class="kw">map</span>(names, welcome)</a>
<a class="sourceLine" id="cb382-9" data-line-number="9"><span class="co">#&gt; Welcome Hadley!</span></a>
<a class="sourceLine" id="cb382-10" data-line-number="10"><span class="co">#&gt; Welcome Jenny!</span></a>
<a class="sourceLine" id="cb382-11" data-line-number="11"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb382-12" data-line-number="12"><span class="co">#&gt; NULL</span></a>
<a class="sourceLine" id="cb382-13" data-line-number="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb382-14" data-line-number="14"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb382-15" data-line-number="15"><span class="co">#&gt; NULL</span></a></code></pre></div>
<p>You could avoid this problem by assigning the results of <code>map()</code> to a variable that you never use, but that would muddy the intent of the code. Instead, purrr provides the walk family of functions that ignore the return values of the <code>.f</code> and instead return <code>.x</code> invisibly<a href="#fn34" class="footnote-ref" id="fnref34"><sup>34</sup></a>.</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb383-1" data-line-number="1"><span class="kw">walk</span>(names, welcome)</a>
<a class="sourceLine" id="cb383-2" data-line-number="2"><span class="co">#&gt; Welcome Hadley!</span></a>
<a class="sourceLine" id="cb383-3" data-line-number="3"><span class="co">#&gt; Welcome Jenny!</span></a></code></pre></div>
<p>My visual depiction of walk attempts to capture the importance different from <code>map()</code>: the outputs are ephemeral, and the input is returned invisibly.</p>
<p><img src="diagrams/functionals/walk.png" style="display: block; margin: auto;" /></p>
<p>One of the most useful <code>walk()</code> variants is <code>walk2()</code> because a very common side-effect is saving something to disk, and when saving something to disk you always have a pair of values: the object and the path that you want to save it to.</p>
<p><img src="diagrams/functionals/walk2.png" style="display: block; margin: auto;" /></p>
<p>For example, imagine you have a list of data frames (which I’ve created here using split), and you’d like to save each one to a separate csv file. That’s easy with <code>walk2()</code>:</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb384-1" data-line-number="1">temp &lt;-<span class="st"> </span><span class="kw">tempfile</span>()</a>
<a class="sourceLine" id="cb384-2" data-line-number="2"><span class="kw">dir.create</span>(temp)</a>
<a class="sourceLine" id="cb384-3" data-line-number="3"></a>
<a class="sourceLine" id="cb384-4" data-line-number="4">cyls &lt;-<span class="st"> </span><span class="kw">split</span>(mtcars, mtcars<span class="op">$</span>cyl)</a>
<a class="sourceLine" id="cb384-5" data-line-number="5">paths &lt;-<span class="st"> </span><span class="kw">file.path</span>(temp, <span class="kw">paste0</span>(<span class="st">&quot;cyl-&quot;</span>, <span class="kw">names</span>(cyls), <span class="st">&quot;.csv&quot;</span>))</a>
<a class="sourceLine" id="cb384-6" data-line-number="6"><span class="kw">walk2</span>(cyls, paths, write.csv)</a>
<a class="sourceLine" id="cb384-7" data-line-number="7"></a>
<a class="sourceLine" id="cb384-8" data-line-number="8"><span class="kw">dir</span>(temp)</a>
<a class="sourceLine" id="cb384-9" data-line-number="9"><span class="co">#&gt; [1] &quot;cyl-4.csv&quot; &quot;cyl-6.csv&quot; &quot;cyl-8.csv&quot;</span></a></code></pre></div>
<p>Here the <code>walk2()</code> is equivalent to <code>write.csv(cyls[[1]], paths[[1]])</code>, <code>write.csv(cyls[[2]], paths[[2]])</code>, <code>write.csv(cyls[[3]], paths[[3]])</code>.</p>
<div class="base">
<p>There is no base equivalent to <code>walk()</code>; you can either wrap the result of <code>lapply()</code> in <code>invisible()</code> or save it to a variable that is never used.</p>
</div>
</div>
<div id="iterating-over-values-and-indices" class="section level3">
<h3><span class="header-section-number">10.3.4</span> Iterating over values and indices</h3>

<p></p>
<p>There are three basic ways to loop over a vector with a for loop:</p>
<ul>
<li>Loop over the elements: <code>for (x in xs)</code></li>
<li>Loop over the numeric indices: <code>for (i in seq_along(xs))</code></li>
<li>Loop over the names: <code>for (nm in names(xs))</code></li>
</ul>
<p>The first form is analogous to the <code>map()</code> family. The second and third forms are equivalent to the <code>imap()</code> family which allows you to iterate over the values and the indices of a vector in parallel.</p>
<p><code>imap()</code> is like <code>map2()</code> in the sense that your <code>.f</code> gets called with two arguments, but here both are derived from the vector. <code>imap(x, f)</code> is equivalent to <code>map2(x, names(x), f)</code> if x has names, and <code>map2(x, seq_along(x), f)</code> if it does not.</p>
<p><code>imap()</code> is often useful for constructing labels:</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb385-1" data-line-number="1"><span class="kw">imap_chr</span>(iris, <span class="op">~</span><span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;The first value of &quot;</span>, .y, <span class="st">&quot; is &quot;</span>, .x[[<span class="dv">1</span>]]))</a>
<a class="sourceLine" id="cb385-2" data-line-number="2"><span class="co">#&gt;                             Sepal.Length </span></a>
<a class="sourceLine" id="cb385-3" data-line-number="3"><span class="co">#&gt; &quot;The first value of Sepal.Length is 5.1&quot; </span></a>
<a class="sourceLine" id="cb385-4" data-line-number="4"><span class="co">#&gt;                              Sepal.Width </span></a>
<a class="sourceLine" id="cb385-5" data-line-number="5"><span class="co">#&gt;  &quot;The first value of Sepal.Width is 3.5&quot; </span></a>
<a class="sourceLine" id="cb385-6" data-line-number="6"><span class="co">#&gt;                             Petal.Length </span></a>
<a class="sourceLine" id="cb385-7" data-line-number="7"><span class="co">#&gt; &quot;The first value of Petal.Length is 1.4&quot; </span></a>
<a class="sourceLine" id="cb385-8" data-line-number="8"><span class="co">#&gt;                              Petal.Width </span></a>
<a class="sourceLine" id="cb385-9" data-line-number="9"><span class="co">#&gt;  &quot;The first value of Petal.Width is 0.2&quot; </span></a>
<a class="sourceLine" id="cb385-10" data-line-number="10"><span class="co">#&gt;                                  Species </span></a>
<a class="sourceLine" id="cb385-11" data-line-number="11"><span class="co">#&gt;   &quot;The first value of Species is setosa&quot;</span></a></code></pre></div>
<p>If the vector is unnamed, the second argument will be the index:</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb386-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="op">~</span><span class="st"> </span><span class="kw">sample</span>(<span class="dv">1000</span>, <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb386-2" data-line-number="2"><span class="kw">imap_chr</span>(x, <span class="op">~</span><span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;The highest value at position &quot;</span>, .y, <span class="st">&quot; is &quot;</span>, <span class="kw">max</span>(.x)))</a>
<a class="sourceLine" id="cb386-3" data-line-number="3"><span class="co">#&gt; [1] &quot;The highest value at position 1 is 885&quot;</span></a>
<a class="sourceLine" id="cb386-4" data-line-number="4"><span class="co">#&gt; [2] &quot;The highest value at position 2 is 808&quot;</span></a>
<a class="sourceLine" id="cb386-5" data-line-number="5"><span class="co">#&gt; [3] &quot;The highest value at position 3 is 942&quot;</span></a>
<a class="sourceLine" id="cb386-6" data-line-number="6"><span class="co">#&gt; [4] &quot;The highest value at position 4 is 966&quot;</span></a>
<a class="sourceLine" id="cb386-7" data-line-number="7"><span class="co">#&gt; [5] &quot;The highest value at position 5 is 857&quot;</span></a>
<a class="sourceLine" id="cb386-8" data-line-number="8"><span class="co">#&gt; [6] &quot;The highest value at position 6 is 671&quot;</span></a></code></pre></div>
<p><code>imap()</code> is a useful helper if you want to work the values in a vector along with their positions.</p>
</div>
<div id="pmap" class="section level3">
<h3><span class="header-section-number">10.3.5</span> Any number of inputs: <code>pmap()</code> and friends</h3>

<p>Since we have <code>map()</code> and <code>map2()</code>, you might expect <code>map3()</code>, <code>map4()</code>, <code>map5()</code>, and so on. But where would you stop? Instead of generalisating to an arbitrary number of arguments, purrr takes a slightly different tack with <code>pmap()</code>: you supply it a single list, which contains any number of arguments. In most cases, that will be a list of equal-length vectors, i.e. something very similar to a data frame. In diagrams, I’ll emphasise that relationship by drawing the input similar to a data frame.</p>
<p><img src="diagrams/functionals/pmap.png" style="display: block; margin: auto;" /></p>
<p>There’s a simple equivalence between <code>map2()</code> and <code>pmap()</code>: <code>map2(x, y, f)</code> becomes <code>pmap(list(x, y), f)</code>. The <code>pmap()</code> equivalent to the <code>map2_dbl(xs, ws, weighted.mean)</code> used above is:</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb387-1" data-line-number="1"><span class="kw">pmap_dbl</span>(<span class="kw">list</span>(xs, ws), weighted.mean)</a>
<a class="sourceLine" id="cb387-2" data-line-number="2"><span class="co">#&gt; [1]    NA 0.451 0.603 0.452 0.563 0.510 0.342 0.464</span></a></code></pre></div>
<p>As before, the varying arguments come before <code>.f</code> (although now they must be wrapped in a list), and and the constant arguments come afterwards.</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb388-1" data-line-number="1"><span class="kw">pmap_dbl</span>(<span class="kw">list</span>(xs, ws), weighted.mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb388-2" data-line-number="2"><span class="co">#&gt; [1] 0.504 0.451 0.603 0.452 0.563 0.510 0.342 0.464</span></a></code></pre></div>
<p><img src="diagrams/functionals/pmap-arg.png" style="display: block; margin: auto;" /></p>
<p>A big difference between <code>pmap()</code> and the other map functions is that <code>pmap()</code> gives you much finer control over argument matching because you can name the components of the list. Returning to our example from Section <a href="#varying-argument"><strong>??</strong></a>, where we wanted to vary the <code>trim</code> argument to <code>x</code>, we could instead use <code>pmap()</code>:</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb389-1" data-line-number="1">trims &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb389-2" data-line-number="2">x &lt;-<span class="st"> </span><span class="kw">rcauchy</span>(<span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb389-3" data-line-number="3"></a>
<a class="sourceLine" id="cb389-4" data-line-number="4"><span class="kw">pmap_dbl</span>(<span class="kw">list</span>(<span class="dt">trim =</span> trims), mean, <span class="dt">x =</span> x)</a>
<a class="sourceLine" id="cb389-5" data-line-number="5"><span class="co">#&gt; [1] -6.6754  0.0192  0.0228  0.0151</span></a></code></pre></div>
<p>I think it’s good practice to name the list to make it very clear how the function will be called.</p>
<p>It’s often convenient to call <code>pmap()</code> with a data frame. A handy way to create that data frame is with <code>tibble::tribble()</code>, which allows you to describe a data frame row-by-row (rather than column-by-column, as usual): thinking about the parameters to a function as a data, is a very powerful pattern. The following example shows how you might draw random uniform numbers with varying parameters:</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb390-1" data-line-number="1">params &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb390-2" data-line-number="2">  <span class="op">~</span><span class="st"> </span>n, <span class="op">~</span><span class="st"> </span>min, <span class="op">~</span><span class="st"> </span>max,</a>
<a class="sourceLine" id="cb390-3" data-line-number="3">   1L,     <span class="dv">0</span>,     <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb390-4" data-line-number="4">   2L,    <span class="dv">10</span>,   <span class="dv">100</span>,</a>
<a class="sourceLine" id="cb390-5" data-line-number="5">   3L,   <span class="dv">100</span>,  <span class="dv">1000</span></a>
<a class="sourceLine" id="cb390-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb390-7" data-line-number="7"></a>
<a class="sourceLine" id="cb390-8" data-line-number="8"><span class="kw">pmap</span>(params, runif)</a>
<a class="sourceLine" id="cb390-9" data-line-number="9"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb390-10" data-line-number="10"><span class="co">#&gt; [1] 0.718</span></a>
<a class="sourceLine" id="cb390-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb390-12" data-line-number="12"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb390-13" data-line-number="13"><span class="co">#&gt; [1] 19.5 39.9</span></a>
<a class="sourceLine" id="cb390-14" data-line-number="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb390-15" data-line-number="15"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb390-16" data-line-number="16"><span class="co">#&gt; [1] 535 476 231</span></a></code></pre></div>
<p>Here, the column names are critical: I’ve carefully chosen to match them to the arguments to <code>runif()</code>, so the <code>pmap(params, runif)</code> is equivalent to <code>runif(n = 1L, min = 0, max = 1)</code>, <code>runif(n = 2, min = 10, max = 100)</code>, <code>runif(n = 3L, min = 100, max = 1000)</code>.</p>
<p><img src="diagrams/functionals/pmap-3.png" style="display: block; margin: auto;" /></p>
<div class="base">
<p>There are two base equivalents to the <code>pmap()</code> family: <code>Map()</code> and <code>mapply()</code>. Both have significant drawbacks:</p>
<ul>
<li><p><code>Map()</code> vectorises over all arguments so you can not supply arguments that
do not very.</p></li>
<li><p><code>mapply()</code> is the multidimensional version of <code>sapply()</code>; concetually it
takes the output of <code>Map()</code> and simplifies it if possible. This gives it
similar issues to <code>sapply()</code>, and there’s no multi-input equivalent of
<code>vapply()</code>.</p></li>
</ul>
</div>
</div>
<div id="exercises-28" class="section level3">
<h3><span class="header-section-number">10.3.6</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Explain the results of <code>modify(mtcars, 1)</code>.</p></li>
<li><p>Rewrite the following code to use <code>iwalk()</code> instead of <code>walk2()</code>. What
are the advantages and disadvantages?</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb391-1" data-line-number="1">cyls &lt;-<span class="st"> </span><span class="kw">split</span>(mtcars, mtcars<span class="op">$</span>cyl)</a>
<a class="sourceLine" id="cb391-2" data-line-number="2">paths &lt;-<span class="st"> </span><span class="kw">file.path</span>(temp, <span class="kw">paste0</span>(<span class="st">&quot;cyl-&quot;</span>, <span class="kw">names</span>(cyls), <span class="st">&quot;.csv&quot;</span>))</a>
<a class="sourceLine" id="cb391-3" data-line-number="3"><span class="kw">walk2</span>(cyls, paths, write.csv)</a></code></pre></div></li>
<li><p>Explain how the following code transforms a data frame using functions
stored in a list.</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb392-1" data-line-number="1">trans &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb392-2" data-line-number="2">  <span class="dt">disp =</span> <span class="cf">function</span>(x) x <span class="op">*</span><span class="st"> </span><span class="fl">0.0163871</span>,</a>
<a class="sourceLine" id="cb392-3" data-line-number="3">  <span class="dt">am =</span> <span class="cf">function</span>(x) <span class="kw">factor</span>(x, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;auto&quot;</span>, <span class="st">&quot;manual&quot;</span>))</a>
<a class="sourceLine" id="cb392-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb392-5" data-line-number="5"></a>
<a class="sourceLine" id="cb392-6" data-line-number="6">vars &lt;-<span class="st"> </span><span class="kw">names</span>(trans)</a>
<a class="sourceLine" id="cb392-7" data-line-number="7">mtcars[vars] &lt;-<span class="st"> </span><span class="kw">map2</span>(trans, mtcars[vars], <span class="cf">function</span>(f, var) <span class="kw">f</span>(var))</a></code></pre></div>
<p>Compare and constrast the <code>map2()</code> approach to this <code>map()</code> approach:</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb393-1" data-line-number="1">mtcars[vars] &lt;-<span class="st"> </span><span class="kw">map</span>(vars, <span class="op">~</span><span class="st"> </span>trans[[.x]](mtcars[[.x]]))</a></code></pre></div></li>
<li><p>What does <code>write.csv()</code> return? i.e. what happens if you use it with
<code>map2()</code> instead of <code>walk2()</code>?</p></li>
</ol>
</div>
</div>
<div id="reduce" class="section level2">
<h2><span class="header-section-number">10.4</span> Reduce</h2>
<p>There are three other particularly families of functionals provided by purrr. You will use them less regularly than the map family and its variants, but they are handy to have in your backpocket.</p>
<div id="basics-2" class="section level3">
<h3><span class="header-section-number">10.4.1</span> Basics</h3>

<p></p>
<p><code>reduce()</code> reduces a vector, <code>x</code>, to a single value by iteratively calling a function, <code>f</code>, two arguments at a time. <code>reduce(1:3, f)</code> is equivalent to <code>f(f(1, 2), 3)</code>.</p>
<p>It’s a little harder to capture reduce in a diagram:</p>
<p><img src="diagrams/functionals/reduce.png" style="display: block; margin: auto;" /></p>
<p>As usual, the essence of <code>reduce()</code> can reduced to a simple wrapper around a for loop:</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb394-1" data-line-number="1">simple_reduce &lt;-<span class="st"> </span><span class="cf">function</span>(x, f) {</a>
<a class="sourceLine" id="cb394-2" data-line-number="2">  out &lt;-<span class="st"> </span>x[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb394-3" data-line-number="3">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">2</span>, <span class="kw">length</span>(x))) {</a>
<a class="sourceLine" id="cb394-4" data-line-number="4">    out &lt;-<span class="st"> </span><span class="kw">f</span>(out, x[[i]])</a>
<a class="sourceLine" id="cb394-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb394-6" data-line-number="6">  out</a>
<a class="sourceLine" id="cb394-7" data-line-number="7">}</a></code></pre></div>
<p><code>reduce()</code> is a useful way to generalise a function that works with two inputs (a <strong>binary</strong> function) to work with any number of inputs. Imagine you have a list of numeric vectors, and you want to find the values that occur in every element:</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb395-1" data-line-number="1">l &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="op">~</span><span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">15</span>, <span class="dt">replace =</span> T))</a>
<a class="sourceLine" id="cb395-2" data-line-number="2"><span class="kw">str</span>(l)</a>
<a class="sourceLine" id="cb395-3" data-line-number="3"><span class="co">#&gt; List of 5</span></a>
<a class="sourceLine" id="cb395-4" data-line-number="4"><span class="co">#&gt;  $ : int [1:15] 7 5 9 7 9 9 5 10 5 5 ...</span></a>
<a class="sourceLine" id="cb395-5" data-line-number="5"><span class="co">#&gt;  $ : int [1:15] 6 3 6 10 3 4 4 2 9 9 ...</span></a>
<a class="sourceLine" id="cb395-6" data-line-number="6"><span class="co">#&gt;  $ : int [1:15] 5 3 4 6 1 1 9 9 6 8 ...</span></a>
<a class="sourceLine" id="cb395-7" data-line-number="7"><span class="co">#&gt;  $ : int [1:15] 4 2 6 6 8 5 10 6 7 1 ...</span></a>
<a class="sourceLine" id="cb395-8" data-line-number="8"><span class="co">#&gt;  $ : int [1:15] 3 10 5 8 7 6 8 5 8 7 ...</span></a></code></pre></div>
<p>You could do that by intersecting each element in turn:</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb396-1" data-line-number="1"><span class="kw">intersect</span>(</a>
<a class="sourceLine" id="cb396-2" data-line-number="2">  <span class="kw">intersect</span>(</a>
<a class="sourceLine" id="cb396-3" data-line-number="3">    <span class="kw">intersect</span>(</a>
<a class="sourceLine" id="cb396-4" data-line-number="4">      <span class="kw">intersect</span>(</a>
<a class="sourceLine" id="cb396-5" data-line-number="5">        l[[<span class="dv">1</span>]], </a>
<a class="sourceLine" id="cb396-6" data-line-number="6">        l[[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb396-7" data-line-number="7">      ),</a>
<a class="sourceLine" id="cb396-8" data-line-number="8">      l[[<span class="dv">3</span>]]</a>
<a class="sourceLine" id="cb396-9" data-line-number="9">    ), </a>
<a class="sourceLine" id="cb396-10" data-line-number="10">    l[[<span class="dv">4</span>]]</a>
<a class="sourceLine" id="cb396-11" data-line-number="11">  ), </a>
<a class="sourceLine" id="cb396-12" data-line-number="12">  l[[<span class="dv">5</span>]]</a>
<a class="sourceLine" id="cb396-13" data-line-number="13">)</a>
<a class="sourceLine" id="cb396-14" data-line-number="14"><span class="co">#&gt; [1] 5</span></a></code></pre></div>
<p>But that’s hard to read, and doesn’t generalise well if the list grows in size. But the problem is easy to solve with <code>reduce()</code>:</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb397-1" data-line-number="1"><span class="kw">reduce</span>(l, intersect)</a>
<a class="sourceLine" id="cb397-2" data-line-number="2"><span class="co">#&gt; [1] 5</span></a></code></pre></div>
<div class="base">
<p>The base equivalent is <code>Reduce()</code>. It takes the function as the first argument and the vector as second; there is no way to supply additional constant arguments.</p>
</div>
<p><img src="diagrams/functionals/reduce-arg.png" style="display: block; margin: auto;" /></p>
</div>
<div id="algebra" class="section level3">
<h3><span class="header-section-number">10.4.2</span> Algebra</h3>
<p>Associative, commutative, identity element.</p>
<ul>
<li><code>x * y</code>: 1</li>
<li><code>x + y</code>: 0</li>
<li><code>min(x, y)</code>: Inf</li>
<li><code>max(x, y)</code>: -Inf</li>
<li><code>c()</code>, <code>union(x, y)</code>: NULL</li>
<li><code>intersect(x, y)</code>: no way to express</li>
</ul>
<p><code>mean()</code> -&gt; <code>sum()</code> + <code>length()</code>
<code>sd()</code> -&gt; <code>sum(x ^2)</code> + <code>sum(x)</code> + <code>length()</code>
<code>median()</code> -&gt; not possible (although can approximate)</p>
<p>Linear models.</p>
</div>
<div id="initialise" class="section level3">
<h3><span class="header-section-number">10.4.3</span> Initialise</h3>
<p>What happens if <code>reduce()</code> is called with zero arguments or one arguments?</p>
<p><img src="diagrams/functionals/reduce-init.png" style="display: block; margin: auto;" /></p>
</div>
<div id="reduce2" class="section level3">
<h3><span class="header-section-number">10.4.4</span> reduce2</h3>
<p><img src="diagrams/functionals/reduce2.png" style="display: block; margin: auto;" /></p>
</div>
<div id="accumulate" class="section level3">
<h3><span class="header-section-number">10.4.5</span> Accumulate</h3>
<p>To see how <code>reduce()</code> works, it’s useful to use a variant: <code>accumulate()</code>. As well as returning the final result, <code>accumulate()</code> also returns all intermediate results.</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb398-1" data-line-number="1"><span class="kw">accumulate</span>(l, intersect)</a>
<a class="sourceLine" id="cb398-2" data-line-number="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb398-3" data-line-number="3"><span class="co">#&gt;  [1]  7  5  9  7  9  9  5 10  5  5  5 10  9  9  1</span></a>
<a class="sourceLine" id="cb398-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb398-5" data-line-number="5"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb398-6" data-line-number="6"><span class="co">#&gt; [1]  5  9 10  1</span></a>
<a class="sourceLine" id="cb398-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb398-8" data-line-number="8"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb398-9" data-line-number="9"><span class="co">#&gt; [1] 5 9 1</span></a>
<a class="sourceLine" id="cb398-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb398-11" data-line-number="11"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb398-12" data-line-number="12"><span class="co">#&gt; [1] 5 1</span></a>
<a class="sourceLine" id="cb398-13" data-line-number="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb398-14" data-line-number="14"><span class="co">#&gt; [[5]]</span></a>
<a class="sourceLine" id="cb398-15" data-line-number="15"><span class="co">#&gt; [1] 5</span></a></code></pre></div>
</div>
<div id="map-reduce" class="section level3">
<h3><span class="header-section-number">10.4.6</span> Map-reduce</h3>
<p>You might have heard of map-reduce, the idea that powers technology like Hadoop. Now you can see how simple and powerful the underlying idea is: all map-reduce is a map combined with a reduce. The special idea for large data is that the data is spread over multiple computers. Each computer performs the map on the data that it has, then it sends the result to back to a coordinator which <em>reduces</em> the individual results back to a single result.</p>
</div>
</div>
<div id="predicate-functionals" class="section level2">
<h2><span class="header-section-number">10.5</span> Predicate functionals</h2>
<p>
</p>
<p>A <strong>predicate</strong> is a function that returns a single <code>TRUE</code> or <code>FALSE</code>, like <code>is.character()</code>, <code>is.null()</code>, or <code>all()</code>, and we say a predicate <strong>matches</strong> a vector if it returns <code>TRUE</code>.</p>
<div id="basics-3" class="section level3">
<h3><span class="header-section-number">10.5.1</span> Basics</h3>
<p>A <strong>predicate functional</strong> applies a predicate to each element of a vector. purrr proivdes six useful functions which come in three pairs:</p>
<ul>
<li><p><code>some(.x, .p)</code> returns <code>TRUE</code> if <em>any</em> element matches;
<code>every(.x,, .p)</code> returns <code>TRUE</code> if <em>all</em> elements match.</p></li>
<li><p><code>detect(.x, .p)</code> returns the <em>value</em> of the first match;
<code>detect_index(.x, .p)</code> returns the <em>location</em> of the first match.</p></li>
<li><p><code>keep(.x, .p)</code> <em>keeps</em> all matching elements;
<code>discard(.x, .p)</code> <em>drops</em> all matching elements.</p></li>
</ul>
<p>The following example shows how you might use these functionals with a data frame:</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb399-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">y =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>))</a>
<a class="sourceLine" id="cb399-2" data-line-number="2"><span class="kw">detect</span>(df, is.factor)</a>
<a class="sourceLine" id="cb399-3" data-line-number="3"><span class="co">#&gt; [1] a b c</span></a>
<a class="sourceLine" id="cb399-4" data-line-number="4"><span class="co">#&gt; Levels: a b c</span></a>
<a class="sourceLine" id="cb399-5" data-line-number="5"><span class="kw">detect_index</span>(df, is.factor)</a>
<a class="sourceLine" id="cb399-6" data-line-number="6"><span class="co">#&gt; [1] 2</span></a>
<a class="sourceLine" id="cb399-7" data-line-number="7"></a>
<a class="sourceLine" id="cb399-8" data-line-number="8"><span class="kw">str</span>(<span class="kw">keep</span>(df, is.factor))</a>
<a class="sourceLine" id="cb399-9" data-line-number="9"><span class="co">#&gt; &#39;data.frame&#39;:    3 obs. of  1 variable:</span></a>
<a class="sourceLine" id="cb399-10" data-line-number="10"><span class="co">#&gt;  $ y: Factor w/ 3 levels &quot;a&quot;,&quot;b&quot;,&quot;c&quot;: 1 2 3</span></a>
<a class="sourceLine" id="cb399-11" data-line-number="11"><span class="kw">str</span>(<span class="kw">discard</span>(df, is.factor))</a>
<a class="sourceLine" id="cb399-12" data-line-number="12"><span class="co">#&gt; &#39;data.frame&#39;:    3 obs. of  1 variable:</span></a>
<a class="sourceLine" id="cb399-13" data-line-number="13"><span class="co">#&gt;  $ x: int  1 2 3</span></a></code></pre></div>
<p>All of these functions could be implemented by first computing a logical vector, e.g. <code>map_lgl(.x, .p)</code>, and then computing on that. However, that is a little inefficient because you can often exit early. For example, in</p>
</div>
<div id="predicate-map" class="section level3">
<h3><span class="header-section-number">10.5.2</span> Map variants</h3>
<p><code>map()</code> and <code>modify()</code> come in variants that also take predicate functions, transforming only the elements of <code>.x</code> with <code>.p</code> is <code>TRUE</code>.</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb400-1" data-line-number="1"><span class="kw">str</span>(<span class="kw">map_if</span>(iris, is.numeric, mean))</a>
<a class="sourceLine" id="cb400-2" data-line-number="2"><span class="co">#&gt; List of 5</span></a>
<a class="sourceLine" id="cb400-3" data-line-number="3"><span class="co">#&gt;  $ Sepal.Length: num 5.84</span></a>
<a class="sourceLine" id="cb400-4" data-line-number="4"><span class="co">#&gt;  $ Sepal.Width : num 3.06</span></a>
<a class="sourceLine" id="cb400-5" data-line-number="5"><span class="co">#&gt;  $ Petal.Length: num 3.76</span></a>
<a class="sourceLine" id="cb400-6" data-line-number="6"><span class="co">#&gt;  $ Petal.Width : num 1.2</span></a>
<a class="sourceLine" id="cb400-7" data-line-number="7"><span class="co">#&gt;  $ Species     : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</span></a>
<a class="sourceLine" id="cb400-8" data-line-number="8"><span class="kw">str</span>(<span class="kw">modify_if</span>(iris, is.numeric, mean))</a>
<a class="sourceLine" id="cb400-9" data-line-number="9"><span class="co">#&gt; &#39;data.frame&#39;:    150 obs. of  5 variables:</span></a>
<a class="sourceLine" id="cb400-10" data-line-number="10"><span class="co">#&gt;  $ Sepal.Length: num  5.84 5.84 5.84 5.84 5.84 ...</span></a>
<a class="sourceLine" id="cb400-11" data-line-number="11"><span class="co">#&gt;  $ Sepal.Width : num  3.06 3.06 3.06 3.06 3.06 ...</span></a>
<a class="sourceLine" id="cb400-12" data-line-number="12"><span class="co">#&gt;  $ Petal.Length: num  3.76 3.76 3.76 3.76 3.76 ...</span></a>
<a class="sourceLine" id="cb400-13" data-line-number="13"><span class="co">#&gt;  $ Petal.Width : num  1.2 1.2 1.2 1.2 1.2 ...</span></a>
<a class="sourceLine" id="cb400-14" data-line-number="14"><span class="co">#&gt;  $ Species     : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</span></a>
<a class="sourceLine" id="cb400-15" data-line-number="15"><span class="kw">str</span>(<span class="kw">map</span>(<span class="kw">keep</span>(iris, is.numeric), mean))</a>
<a class="sourceLine" id="cb400-16" data-line-number="16"><span class="co">#&gt; List of 4</span></a>
<a class="sourceLine" id="cb400-17" data-line-number="17"><span class="co">#&gt;  $ Sepal.Length: num 5.84</span></a>
<a class="sourceLine" id="cb400-18" data-line-number="18"><span class="co">#&gt;  $ Sepal.Width : num 3.06</span></a>
<a class="sourceLine" id="cb400-19" data-line-number="19"><span class="co">#&gt;  $ Petal.Length: num 3.76</span></a>
<a class="sourceLine" id="cb400-20" data-line-number="20"><span class="co">#&gt;  $ Petal.Width : num 1.2</span></a></code></pre></div>
</div>
<div id="exercises-29" class="section level3">
<h3><span class="header-section-number">10.5.3</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Why isn’t <code>is.na()</code> a predicate function? What base R function is closest
to being a predicate version of <code>is.na()</code>?</p></li>
<li><p>What’s the relationship between <code>which()</code> and <code>Position()</code>? What’s
the relationship between <code>where()</code> and <code>Filter()</code>?</p></li>
<li><p><code>simple_reduce()</code> has a problem when <code>x</code> is length 0 or length 1. Describe
the source of the problem and how you might go about fixing it.</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb401-1" data-line-number="1">simple_reduce &lt;-<span class="st"> </span><span class="cf">function</span>(x, f) {</a>
<a class="sourceLine" id="cb401-2" data-line-number="2">  out &lt;-<span class="st"> </span>x[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb401-3" data-line-number="3">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">2</span>, <span class="kw">length</span>(x))) {</a>
<a class="sourceLine" id="cb401-4" data-line-number="4">    out &lt;-<span class="st"> </span><span class="kw">f</span>(out, x[[i]])</a>
<a class="sourceLine" id="cb401-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb401-6" data-line-number="6">  out</a>
<a class="sourceLine" id="cb401-7" data-line-number="7">}</a></code></pre></div></li>
<li><p>Implement the <code>span()</code> function from Haskell: given a list <code>x</code> and a
predicate function <code>f</code>, <code>span()</code> returns the location of the longest
sequential run of elements where the predicate is true. (Hint: you
might find <code>rle()</code> helpful.)</p></li>
<li><p>Implement <code>arg_max()</code>. It should take a function and a vector of inputs,
and return the elements of the input where the function returns the highest
value. For example, <code>arg_max(-10:5, function(x) x ^ 2)</code> should return -10.
<code>arg_max(-5:5, function(x) x ^ 2)</code> should return <code>c(-5, 5)</code>.
Also implement the matching <code>arg_min()</code> function.</p></li>
<li><p>The function below scales a vector so it falls in the range [0, 1]. How
would you apply it to every column of a data frame? How would you apply it
to every numeric column in a data frame?</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb402-1" data-line-number="1">scale01 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb402-2" data-line-number="2">  rng &lt;-<span class="st"> </span><span class="kw">range</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb402-3" data-line-number="3">  (x <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>]) <span class="op">/</span><span class="st"> </span>(rng[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb402-4" data-line-number="4">}</a></code></pre></div></li>
</ol>
</div>
</div>
<div id="functionals-math" class="section level2">
<h2><span class="header-section-number">10.6</span> Base functionals</h2>
<p>Base R functionals have more of a mathematical/statistical flavour.</p>
<div id="matrices-and-array-operations" class="section level3">
<h3><span class="header-section-number">10.6.1</span> Matrices and array operations</h3>
<p>So far, all the functionals we’ve seen work with 1d input structures. The three functionals in this section provide useful tools for working with higher-dimensional data structures. <code>apply()</code> is a variant of <code>sapply()</code> that works with matrices and arrays. You can think of it as an operation that summarises a matrix or array by collapsing each row or column to a single number. It has four arguments: </p>
<ul>
<li><code>X</code>, the matrix or array to summarise</li>
<li><code>MARGIN</code>, an integer vector giving the dimensions to summarise over,
1 = rows, 2 = columns, etc.</li>
<li><code>FUN</code>, a summary function</li>
<li><code>...</code> other arguments passed on to <code>FUN</code></li>
</ul>
<p>A typical example of <code>apply()</code> looks like this</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb403-1" data-line-number="1">a &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="dt">nrow =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb403-2" data-line-number="2"><span class="kw">apply</span>(a, <span class="dv">1</span>, mean)</a>
<a class="sourceLine" id="cb403-3" data-line-number="3"><span class="co">#&gt; [1]  8.5  9.5 10.5 11.5 12.5</span></a>
<a class="sourceLine" id="cb403-4" data-line-number="4"><span class="kw">apply</span>(a, <span class="dv">2</span>, mean)</a>
<a class="sourceLine" id="cb403-5" data-line-number="5"><span class="co">#&gt; [1]  3  8 13 18</span></a></code></pre></div>
<p>There are a few caveats to using <code>apply()</code>. It doesn’t have a simplify argument, so you can never be completely sure what type of output you’ll get. This means that <code>apply()</code> is not safe to use inside a function unless you carefully check the inputs. <code>apply()</code> is also not idempotent in the sense that if the summary function is the identity operator, the output is not always the same as the input:</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb404-1" data-line-number="1">a1 &lt;-<span class="st"> </span><span class="kw">apply</span>(a, <span class="dv">1</span>, identity)</a>
<a class="sourceLine" id="cb404-2" data-line-number="2"><span class="kw">identical</span>(a, a1)</a>
<a class="sourceLine" id="cb404-3" data-line-number="3"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb404-4" data-line-number="4"><span class="kw">identical</span>(a, <span class="kw">t</span>(a1))</a>
<a class="sourceLine" id="cb404-5" data-line-number="5"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb404-6" data-line-number="6">a2 &lt;-<span class="st"> </span><span class="kw">apply</span>(a, <span class="dv">2</span>, identity)</a>
<a class="sourceLine" id="cb404-7" data-line-number="7"><span class="kw">identical</span>(a, a2)</a>
<a class="sourceLine" id="cb404-8" data-line-number="8"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
<p>(You can put high-dimensional arrays back in the right order using <code>aperm()</code>, or use <code>plyr::aaply()</code>, which is idempotent.)</p>
<p><code>sweep()</code> allows you to “sweep” out the values of a summary statistic. It is often used with <code>apply()</code> to standardise arrays. The following example scales the rows of a matrix so that all values lie between 0 and 1. </p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb405-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">20</span>, <span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">nrow =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb405-2" data-line-number="2">x1 &lt;-<span class="st"> </span><span class="kw">sweep</span>(x, <span class="dv">1</span>, <span class="kw">apply</span>(x, <span class="dv">1</span>, min), <span class="st">`</span><span class="dt">-</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb405-3" data-line-number="3">x2 &lt;-<span class="st"> </span><span class="kw">sweep</span>(x1, <span class="dv">1</span>, <span class="kw">apply</span>(x1, <span class="dv">1</span>, max), <span class="st">`</span><span class="dt">/</span><span class="st">`</span>)</a></code></pre></div>
<p>The final matrix functional is <code>outer()</code>. It’s a little different in that it takes multiple vector inputs and creates a matrix or array output where the input function is run over every combination of the inputs: </p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb406-1" data-line-number="1"><span class="co"># Create a times table</span></a>
<a class="sourceLine" id="cb406-2" data-line-number="2"><span class="kw">outer</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="st">&quot;*&quot;</span>)</a>
<a class="sourceLine" id="cb406-3" data-line-number="3"><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]</span></a>
<a class="sourceLine" id="cb406-4" data-line-number="4"><span class="co">#&gt; [1,]    1    2    3    4    5    6    7    8    9    10</span></a>
<a class="sourceLine" id="cb406-5" data-line-number="5"><span class="co">#&gt; [2,]    2    4    6    8   10   12   14   16   18    20</span></a>
<a class="sourceLine" id="cb406-6" data-line-number="6"><span class="co">#&gt; [3,]    3    6    9   12   15   18   21   24   27    30</span></a></code></pre></div>
<p>Good places to learn more about <code>apply()</code> and friends are:</p>
<ul>
<li><p><a href="http://petewerner.blogspot.com/2012/12/using-apply-sapply-lapply-in-r.html">“Using apply, sapply, lapply in R”</a> by Peter Werner.</p></li>
<li><p><a href="http://rforpublichealth.blogspot.no/2012/09/the-infamous-apply-function.html">“The infamous apply function”</a> by Slawa Rokicki.</p></li>
<li><p><a href="http://forgetfulfunctor.blogspot.com/2011/07/r-apply-function-tutorial-with-examples.html">“The R apply function - a tutorial with examples”</a> by axiomOfChoice.</p></li>
<li><p>The stackoverflow question <a href="http://stackoverflow.com/questions/3505701">“R Grouping functions: <code>sapply</code> vs. <code>lapply</code> vs. <code>apply</code> vs. <code>tapply</code> vs. <code>by</code> vs. <code>aggregate</code>”</a>.</p></li>
</ul>
</div>
<div id="tapply" class="section level3">
<h3><span class="header-section-number">10.6.2</span> <code>tapply()</code></h3>

<p>You can think about <code>tapply()</code> as a generalisation to <code>apply()</code> that allows for “ragged” arrays, arrays where each row can have a different number of columns. This is often needed when you’re trying to summarise a data set. For example, imagine you’ve collected pulse rate data from a medical trial, and you want to compare the two groups: </p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb407-1" data-line-number="1">pulse &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">rnorm</span>(<span class="dv">22</span>, <span class="dv">70</span>, <span class="dv">10</span> <span class="op">/</span><span class="st"> </span><span class="dv">3</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">12</span>))</a>
<a class="sourceLine" id="cb407-2" data-line-number="2">group &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>), <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">12</span>))</a>
<a class="sourceLine" id="cb407-3" data-line-number="3"></a>
<a class="sourceLine" id="cb407-4" data-line-number="4"><span class="kw">tapply</span>(pulse, group, length)</a>
<a class="sourceLine" id="cb407-5" data-line-number="5"><span class="co">#&gt;  A  B </span></a>
<a class="sourceLine" id="cb407-6" data-line-number="6"><span class="co">#&gt; 10 12</span></a>
<a class="sourceLine" id="cb407-7" data-line-number="7"><span class="kw">tapply</span>(pulse, group, mean)</a>
<a class="sourceLine" id="cb407-8" data-line-number="8"><span class="co">#&gt;    A    B </span></a>
<a class="sourceLine" id="cb407-9" data-line-number="9"><span class="co">#&gt; 71.1 75.1</span></a></code></pre></div>
<p><code>tapply()</code> works by creating a “ragged” data structure from a set of inputs, and then applying a function to the individual elements of that structure. The first task is actually what the <code>split()</code> function does. It takes two inputs and returns a list which groups elements together from the first vector according to elements, or categories, from the second vector:</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb408-1" data-line-number="1"><span class="kw">split</span>(pulse, group)</a>
<a class="sourceLine" id="cb408-2" data-line-number="2"><span class="co">#&gt; $A</span></a>
<a class="sourceLine" id="cb408-3" data-line-number="3"><span class="co">#&gt;  [1] 67 71 70 73 74 69 70 71 77 69</span></a>
<a class="sourceLine" id="cb408-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb408-5" data-line-number="5"><span class="co">#&gt; $B</span></a>
<a class="sourceLine" id="cb408-6" data-line-number="6"><span class="co">#&gt;  [1] 78 72 77 72 71 80 77 72 71 80 80 71</span></a></code></pre></div>
<p>Then <code>tapply()</code> is just the combination of <code>split()</code> and <code>sapply()</code>:</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb409-1" data-line-number="1">tapply2 &lt;-<span class="st"> </span><span class="cf">function</span>(x, group, f, ..., <span class="dt">simplify =</span> <span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb409-2" data-line-number="2">  pieces &lt;-<span class="st"> </span><span class="kw">split</span>(x, group)</a>
<a class="sourceLine" id="cb409-3" data-line-number="3">  <span class="kw">sapply</span>(pieces, f, <span class="dt">simplify =</span> simplify)</a>
<a class="sourceLine" id="cb409-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb409-5" data-line-number="5"><span class="kw">tapply2</span>(pulse, group, length)</a>
<a class="sourceLine" id="cb409-6" data-line-number="6"><span class="co">#&gt;  A  B </span></a>
<a class="sourceLine" id="cb409-7" data-line-number="7"><span class="co">#&gt; 10 12</span></a>
<a class="sourceLine" id="cb409-8" data-line-number="8"><span class="kw">tapply2</span>(pulse, group, mean)</a>
<a class="sourceLine" id="cb409-9" data-line-number="9"><span class="co">#&gt;    A    B </span></a>
<a class="sourceLine" id="cb409-10" data-line-number="10"><span class="co">#&gt; 71.1 75.1</span></a></code></pre></div>
<p>Being able to rewrite <code>tapply()</code> as a combination of <code>split()</code> and <code>sapply()</code> is a good indication that we’ve identified some useful building blocks.</p>
</div>
<div id="mathmatical" class="section level3">
<h3><span class="header-section-number">10.6.3</span> Mathmatical</h3>
<p>Functionals are very common in mathematics. The limit, the maximum, the roots (the set of points where <code>f(x) = 0</code>), and the definite integral are all functionals: given a function, they return a single number (or vector of numbers). At first glance, these functions don’t seem to fit in with the theme of eliminating loops, but if you dig deeper you’ll find out that they are all implemented using an algorithm that involves iteration.</p>
<p>In this section we’ll use some of R’s built-in mathematical functionals. There are three functionals that work with functions to return single numeric values:   </p>
<ul>
<li><code>integrate()</code> finds the area under the curve defined by <code>f()</code></li>
<li><code>uniroot()</code> finds where <code>f()</code> hits zero</li>
<li><code>optimise()</code> finds the location of lowest (or highest) value of <code>f()</code></li>
</ul>
<p>Let’s explore how these are used with a simple function, <code>sin()</code>:</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb410-1" data-line-number="1"><span class="kw">integrate</span>(sin, <span class="dv">0</span>, pi)</a>
<a class="sourceLine" id="cb410-2" data-line-number="2"><span class="co">#&gt; 2 with absolute error &lt; 2.2e-14</span></a>
<a class="sourceLine" id="cb410-3" data-line-number="3"><span class="kw">str</span>(<span class="kw">uniroot</span>(sin, pi <span class="op">*</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, <span class="dv">3</span> <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb410-4" data-line-number="4"><span class="co">#&gt; List of 5</span></a>
<a class="sourceLine" id="cb410-5" data-line-number="5"><span class="co">#&gt;  $ root      : num 3.14</span></a>
<a class="sourceLine" id="cb410-6" data-line-number="6"><span class="co">#&gt;  $ f.root    : num 1.22e-16</span></a>
<a class="sourceLine" id="cb410-7" data-line-number="7"><span class="co">#&gt;  $ iter      : int 2</span></a>
<a class="sourceLine" id="cb410-8" data-line-number="8"><span class="co">#&gt;  $ init.it   : int NA</span></a>
<a class="sourceLine" id="cb410-9" data-line-number="9"><span class="co">#&gt;  $ estim.prec: num 6.1e-05</span></a>
<a class="sourceLine" id="cb410-10" data-line-number="10"><span class="kw">str</span>(<span class="kw">optimise</span>(sin, <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pi)))</a>
<a class="sourceLine" id="cb410-11" data-line-number="11"><span class="co">#&gt; List of 2</span></a>
<a class="sourceLine" id="cb410-12" data-line-number="12"><span class="co">#&gt;  $ minimum  : num 4.71</span></a>
<a class="sourceLine" id="cb410-13" data-line-number="13"><span class="co">#&gt;  $ objective: num -1</span></a>
<a class="sourceLine" id="cb410-14" data-line-number="14"><span class="kw">str</span>(<span class="kw">optimise</span>(sin, <span class="kw">c</span>(<span class="dv">0</span>, pi), <span class="dt">maximum =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb410-15" data-line-number="15"><span class="co">#&gt; List of 2</span></a>
<a class="sourceLine" id="cb410-16" data-line-number="16"><span class="co">#&gt;  $ maximum  : num 1.57</span></a>
<a class="sourceLine" id="cb410-17" data-line-number="17"><span class="co">#&gt;  $ objective: num 1</span></a></code></pre></div>
</div>
<div id="exercises-30" class="section level3">
<h3><span class="header-section-number">10.6.4</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>How does <code>apply()</code> arrange the output? Read the documentation and perform
some experiments.</p></li>
<li><p>There’s no equivalent to <code>split()</code> + <code>vapply()</code>. Should there be? When
would it be useful? Implement one yourself.</p></li>
<li><p>Implement a pure R version of <code>split()</code>. (Hint: use <code>unique()</code> and
subsetting.) Can you do it without a for loop?</p></li>
<li><p>Challenge: read about the
<a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-12.html#%_sec_1.3">fixed point algorithm</a>.
Complete the exercises using R.</p></li>
</ol>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="31">
<li id="fn31"><p>These are sometimes called Norman doors after Don Norman who described them in his book, “The Design of Everyday Things”. There’s a nice video about them at <a href="https://99percentinvisible.org/article/norman-doors/" class="uri">https://99percentinvisible.org/article/norman-doors/</a>.<a href="functionals.html#fnref31" class="footnote-back">↩</a></p></li>
<li id="fn32"><p>Not to be confused with <code>base::Map()</code>, which is considerably more complex, and we’ll come back to in Section <a href="functionals.html#pmap">10.3.5</a>.<a href="functionals.html#fnref32" class="footnote-back">↩</a></p></li>
<li id="fn33"><p>Who is highly likely to be future you!<a href="functionals.html#fnref33" class="footnote-back">↩</a></p></li>
<li id="fn34"><p>In brief, invisible values are only printed if you explicitly request it. This makes them well suited for functions called primarily for their side-effects, as it allows their output to be ignored by default, while still from an option to capture it. See Section <a href="functions.html#invisible-values">6.6.2</a> for more details.<a href="functionals.html#fnref34" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="fp.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="function-factories.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/hadley/adv-r/edit/master/Functionals.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
