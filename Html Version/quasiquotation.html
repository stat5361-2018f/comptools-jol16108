<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Advanced R</title>
  <meta name="description" content="The book is designed primarily for R users who want to improve their programming skills and understanding of the language. It should also be useful for programmers coming to R from other languages, as it explains some of R’s quirks and shows how some parts that seem horrible do have a positive side.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Advanced R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://adv-r.hadley.nz/" />
  <meta property="og:image" content="https://adv-r.hadley.nz/cover.png" />
  <meta property="og:description" content="The book is designed primarily for R users who want to improve their programming skills and understanding of the language. It should also be useful for programmers coming to R from other languages, as it explains some of R’s quirks and shows how some parts that seem horrible do have a positive side." />
  <meta name="github-repo" content="hadley/adv-r" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Advanced R" />
  <meta name="twitter:site" content="@hadley" />
  <meta name="twitter:description" content="The book is designed primarily for R users who want to improve their programming skills and understanding of the language. It should also be useful for programmers coming to R from other languages, as it explains some of R’s quirks and shows how some parts that seem horrible do have a positive side." />
  <meta name="twitter:image" content="https://adv-r.hadley.nz/cover.png" />

<meta name="author" content="Hadley Wickham">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="expressions.html">
<link rel="next" href="evaluation.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="adv-r.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Advanced R</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#other-books"><i class="fa fa-check"></i>Other books</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i><b>1</b> Preface</a><ul>
<li class="chapter" data-level="1.1" data-path="preface.html"><a href="preface.html#rlang"><i class="fa fa-check"></i><b>1.1</b> rlang</a></li>
<li class="chapter" data-level="1.2" data-path="preface.html"><a href="preface.html#foundations"><i class="fa fa-check"></i><b>1.2</b> Foundations</a></li>
<li class="chapter" data-level="1.3" data-path="preface.html"><a href="preface.html#programming-paradigms"><i class="fa fa-check"></i><b>1.3</b> Programming paradigms</a></li>
<li class="chapter" data-level="1.4" data-path="preface.html"><a href="preface.html#techniques"><i class="fa fa-check"></i><b>1.4</b> Techniques</a></li>
<li class="chapter" data-level="1.5" data-path="preface.html"><a href="preface.html#removals"><i class="fa fa-check"></i><b>1.5</b> Removals</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#who-should-read"><i class="fa fa-check"></i><b>2.1</b> Who should read this book</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#related-work"><i class="fa fa-check"></i><b>2.2</b> Related work</a></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#what-you-will-get"><i class="fa fa-check"></i><b>2.3</b> What you will get out of this book</a></li>
<li class="chapter" data-level="2.4" data-path="introduction.html"><a href="introduction.html#meta-techniques"><i class="fa fa-check"></i><b>2.4</b> Meta-techniques</a></li>
<li class="chapter" data-level="2.5" data-path="introduction.html"><a href="introduction.html#recommended-reading"><i class="fa fa-check"></i><b>2.5</b> Recommended reading</a></li>
<li class="chapter" data-level="2.6" data-path="introduction.html"><a href="introduction.html#getting-help"><i class="fa fa-check"></i><b>2.6</b> Getting help</a></li>
<li class="chapter" data-level="2.7" data-path="introduction.html"><a href="introduction.html#intro-ack"><i class="fa fa-check"></i><b>2.7</b> Acknowledgments</a></li>
<li class="chapter" data-level="2.8" data-path="introduction.html"><a href="introduction.html#conventions"><i class="fa fa-check"></i><b>2.8</b> Conventions</a></li>
<li class="chapter" data-level="2.9" data-path="introduction.html"><a href="introduction.html#colophon"><i class="fa fa-check"></i><b>2.9</b> Colophon</a></li>
</ul></li>
<li class="part"><span><b>I Foundations</b></span></li>
<li class="chapter" data-level="" data-path="foundations-intro.html"><a href="foundations-intro.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="3" data-path="names-values.html"><a href="names-values.html"><i class="fa fa-check"></i><b>3</b> Names and values</a><ul>
<li class="chapter" data-level="3.1" data-path="names-values.html"><a href="names-values.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#quiz"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#sources"><i class="fa fa-check"></i>Sources</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="names-values.html"><a href="names-values.html#binding-basics"><i class="fa fa-check"></i><b>3.2</b> Binding basics</a><ul>
<li class="chapter" data-level="3.2.1" data-path="names-values.html"><a href="names-values.html#non-syntactic"><i class="fa fa-check"></i><b>3.2.1</b> Non-syntactic names</a></li>
<li class="chapter" data-level="3.2.2" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>3.2.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="names-values.html"><a href="names-values.html#copy-on-modify"><i class="fa fa-check"></i><b>3.3</b> Copy-on-modify</a><ul>
<li class="chapter" data-level="3.3.1" data-path="names-values.html"><a href="names-values.html#tracemem"><i class="fa fa-check"></i><b>3.3.1</b> <code>tracemem()</code></a></li>
<li class="chapter" data-level="3.3.2" data-path="names-values.html"><a href="names-values.html#function-calls"><i class="fa fa-check"></i><b>3.3.2</b> Function calls</a></li>
<li class="chapter" data-level="3.3.3" data-path="names-values.html"><a href="names-values.html#list-references"><i class="fa fa-check"></i><b>3.3.3</b> Lists</a></li>
<li class="chapter" data-level="3.3.4" data-path="names-values.html"><a href="names-values.html#df-modify"><i class="fa fa-check"></i><b>3.3.4</b> Data frames</a></li>
<li class="chapter" data-level="3.3.5" data-path="names-values.html"><a href="names-values.html#character-vectors"><i class="fa fa-check"></i><b>3.3.5</b> Character vectors</a></li>
<li class="chapter" data-level="3.3.6" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>3.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="names-values.html"><a href="names-values.html#object-size"><i class="fa fa-check"></i><b>3.4</b> Object size</a><ul>
<li class="chapter" data-level="3.4.1" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>3.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="names-values.html"><a href="names-values.html#modify-in-place"><i class="fa fa-check"></i><b>3.5</b> Modify-in-place</a><ul>
<li class="chapter" data-level="3.5.1" data-path="names-values.html"><a href="names-values.html#single-binding"><i class="fa fa-check"></i><b>3.5.1</b> Objects with a single binding</a></li>
<li class="chapter" data-level="3.5.2" data-path="names-values.html"><a href="names-values.html#env-modify"><i class="fa fa-check"></i><b>3.5.2</b> Environments</a></li>
<li class="chapter" data-level="3.5.3" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>3.5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="names-values.html"><a href="names-values.html#gc"><i class="fa fa-check"></i><b>3.6</b> Unbinding and the garbage collector</a></li>
<li class="chapter" data-level="3.7" data-path="names-values.html"><a href="names-values.html#names-values-answers"><i class="fa fa-check"></i><b>3.7</b> Answers</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="vectors-chap.html"><a href="vectors-chap.html"><i class="fa fa-check"></i><b>4</b> Vectors</a><ul>
<li class="chapter" data-level="4.1" data-path="vectors-chap.html"><a href="vectors-chap.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="vectors-chap.html"><a href="vectors-chap.html#quiz-1"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="vectors-chap.html"><a href="vectors-chap.html#outline-1"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="vectors-chap.html"><a href="vectors-chap.html#atomic-vectors"><i class="fa fa-check"></i><b>4.2</b> Atomic vectors</a><ul>
<li class="chapter" data-level="4.2.1" data-path="vectors-chap.html"><a href="vectors-chap.html#scalars"><i class="fa fa-check"></i><b>4.2.1</b> Scalars</a></li>
<li class="chapter" data-level="4.2.2" data-path="vectors-chap.html"><a href="vectors-chap.html#atomic-constructing"><i class="fa fa-check"></i><b>4.2.2</b> Making longer vectors with <code>c()</code></a></li>
<li class="chapter" data-level="4.2.3" data-path="vectors-chap.html"><a href="vectors-chap.html#testing-and-coercing"><i class="fa fa-check"></i><b>4.2.3</b> Testing and coercing</a></li>
<li class="chapter" data-level="4.2.4" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-4"><i class="fa fa-check"></i><b>4.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="vectors-chap.html"><a href="vectors-chap.html#attributes"><i class="fa fa-check"></i><b>4.3</b> Attributes</a><ul>
<li class="chapter" data-level="4.3.1" data-path="vectors-chap.html"><a href="vectors-chap.html#getting-and-setting"><i class="fa fa-check"></i><b>4.3.1</b> Getting and setting</a></li>
<li class="chapter" data-level="4.3.2" data-path="vectors-chap.html"><a href="vectors-chap.html#attr-names"><i class="fa fa-check"></i><b>4.3.2</b> Names</a></li>
<li class="chapter" data-level="4.3.3" data-path="vectors-chap.html"><a href="vectors-chap.html#attr-dims"><i class="fa fa-check"></i><b>4.3.3</b> Dimensions</a></li>
<li class="chapter" data-level="4.3.4" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-5"><i class="fa fa-check"></i><b>4.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="vectors-chap.html"><a href="vectors-chap.html#s3-atomic-vectors"><i class="fa fa-check"></i><b>4.4</b> S3 atomic vectors</a><ul>
<li class="chapter" data-level="4.4.1" data-path="vectors-chap.html"><a href="vectors-chap.html#factors"><i class="fa fa-check"></i><b>4.4.1</b> Factors</a></li>
<li class="chapter" data-level="4.4.2" data-path="vectors-chap.html"><a href="vectors-chap.html#dates"><i class="fa fa-check"></i><b>4.4.2</b> Dates</a></li>
<li class="chapter" data-level="4.4.3" data-path="vectors-chap.html"><a href="vectors-chap.html#date-times"><i class="fa fa-check"></i><b>4.4.3</b> Date-times</a></li>
<li class="chapter" data-level="4.4.4" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-6"><i class="fa fa-check"></i><b>4.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="vectors-chap.html"><a href="vectors-chap.html#lists"><i class="fa fa-check"></i><b>4.5</b> Lists</a><ul>
<li class="chapter" data-level="4.5.1" data-path="vectors-chap.html"><a href="vectors-chap.html#list-creating"><i class="fa fa-check"></i><b>4.5.1</b> Creating</a></li>
<li class="chapter" data-level="4.5.2" data-path="vectors-chap.html"><a href="vectors-chap.html#list-types"><i class="fa fa-check"></i><b>4.5.2</b> Testing and coercing</a></li>
<li class="chapter" data-level="4.5.3" data-path="vectors-chap.html"><a href="vectors-chap.html#list-array"><i class="fa fa-check"></i><b>4.5.3</b> Matrices and arrays</a></li>
<li class="chapter" data-level="4.5.4" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-7"><i class="fa fa-check"></i><b>4.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="vectors-chap.html"><a href="vectors-chap.html#tibble"><i class="fa fa-check"></i><b>4.6</b> Data frames and tibbles</a><ul>
<li class="chapter" data-level="4.6.1" data-path="vectors-chap.html"><a href="vectors-chap.html#df-create"><i class="fa fa-check"></i><b>4.6.1</b> Creating</a></li>
<li class="chapter" data-level="4.6.2" data-path="vectors-chap.html"><a href="vectors-chap.html#rownames"><i class="fa fa-check"></i><b>4.6.2</b> Row names</a></li>
<li class="chapter" data-level="4.6.3" data-path="vectors-chap.html"><a href="vectors-chap.html#printing"><i class="fa fa-check"></i><b>4.6.3</b> Printing</a></li>
<li class="chapter" data-level="4.6.4" data-path="vectors-chap.html"><a href="vectors-chap.html#safe-subsetting"><i class="fa fa-check"></i><b>4.6.4</b> Subsetting</a></li>
<li class="chapter" data-level="4.6.5" data-path="vectors-chap.html"><a href="vectors-chap.html#df-test-coerce"><i class="fa fa-check"></i><b>4.6.5</b> Testing and coercing</a></li>
<li class="chapter" data-level="4.6.6" data-path="vectors-chap.html"><a href="vectors-chap.html#list-columns"><i class="fa fa-check"></i><b>4.6.6</b> List columns</a></li>
<li class="chapter" data-level="4.6.7" data-path="vectors-chap.html"><a href="vectors-chap.html#matrix-and-data-frame-columns"><i class="fa fa-check"></i><b>4.6.7</b> Matrix and data frame columns</a></li>
<li class="chapter" data-level="4.6.8" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-8"><i class="fa fa-check"></i><b>4.6.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="vectors-chap.html"><a href="vectors-chap.html#null"><i class="fa fa-check"></i><b>4.7</b> <code>NULL</code></a></li>
<li class="chapter" data-level="4.8" data-path="vectors-chap.html"><a href="vectors-chap.html#data-structure-answers"><i class="fa fa-check"></i><b>4.8</b> Answers</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="subsetting.html"><a href="subsetting.html"><i class="fa fa-check"></i><b>5</b> Subsetting</a><ul>
<li class="chapter" data-level="5.1" data-path="subsetting.html"><a href="subsetting.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#quiz-2"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#outline-2"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="subsetting.html"><a href="subsetting.html#subset-multiple"><i class="fa fa-check"></i><b>5.2</b> Selecting multiple elements</a><ul>
<li class="chapter" data-level="5.2.1" data-path="subsetting.html"><a href="subsetting.html#atomic-vectors-1"><i class="fa fa-check"></i><b>5.2.1</b> Atomic vectors</a></li>
<li class="chapter" data-level="5.2.2" data-path="subsetting.html"><a href="subsetting.html#lists-1"><i class="fa fa-check"></i><b>5.2.2</b> Lists</a></li>
<li class="chapter" data-level="5.2.3" data-path="subsetting.html"><a href="subsetting.html#matrix-subsetting"><i class="fa fa-check"></i><b>5.2.3</b> Matrices and arrays</a></li>
<li class="chapter" data-level="5.2.4" data-path="subsetting.html"><a href="subsetting.html#df-subsetting"><i class="fa fa-check"></i><b>5.2.4</b> Data frames and tibbles</a></li>
<li class="chapter" data-level="5.2.5" data-path="subsetting.html"><a href="subsetting.html#simplify-preserve"><i class="fa fa-check"></i><b>5.2.5</b> Preserving dimensionality</a></li>
<li class="chapter" data-level="5.2.6" data-path="subsetting.html"><a href="subsetting.html#exercises-9"><i class="fa fa-check"></i><b>5.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="subsetting.html"><a href="subsetting.html#subset-single"><i class="fa fa-check"></i><b>5.3</b> Selecting a single element</a><ul>
<li class="chapter" data-level="5.3.1" data-path="subsetting.html"><a href="subsetting.html#section"><i class="fa fa-check"></i><b>5.3.1</b> <code>[[</code></a></li>
<li class="chapter" data-level="5.3.2" data-path="subsetting.html"><a href="subsetting.html#section-1"><i class="fa fa-check"></i><b>5.3.2</b> <code>$</code></a></li>
<li class="chapter" data-level="5.3.3" data-path="subsetting.html"><a href="subsetting.html#missingout-of-bounds-indices"><i class="fa fa-check"></i><b>5.3.3</b> Missing/out of bounds indices</a></li>
<li class="chapter" data-level="5.3.4" data-path="subsetting.html"><a href="subsetting.html#and-slot"><i class="fa fa-check"></i><b>5.3.4</b> <code>@</code> and <code>slot()</code></a></li>
<li class="chapter" data-level="5.3.5" data-path="subsetting.html"><a href="subsetting.html#exercises-10"><i class="fa fa-check"></i><b>5.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="subsetting.html"><a href="subsetting.html#subassignment"><i class="fa fa-check"></i><b>5.4</b> Subsetting and assignment</a></li>
<li class="chapter" data-level="5.5" data-path="subsetting.html"><a href="subsetting.html#applications"><i class="fa fa-check"></i><b>5.5</b> Applications</a><ul>
<li class="chapter" data-level="5.5.1" data-path="subsetting.html"><a href="subsetting.html#lookup-tables"><i class="fa fa-check"></i><b>5.5.1</b> Lookup tables (character subsetting)</a></li>
<li class="chapter" data-level="5.5.2" data-path="subsetting.html"><a href="subsetting.html#matching-merging"><i class="fa fa-check"></i><b>5.5.2</b> Matching and merging by hand (integer subsetting)</a></li>
<li class="chapter" data-level="5.5.3" data-path="subsetting.html"><a href="subsetting.html#random-samplesbootstraps-integer-subsetting"><i class="fa fa-check"></i><b>5.5.3</b> Random samples/bootstraps (integer subsetting)</a></li>
<li class="chapter" data-level="5.5.4" data-path="subsetting.html"><a href="subsetting.html#ordering-integer-subsetting"><i class="fa fa-check"></i><b>5.5.4</b> Ordering (integer subsetting)</a></li>
<li class="chapter" data-level="5.5.5" data-path="subsetting.html"><a href="subsetting.html#expanding-aggregated-counts-integer-subsetting"><i class="fa fa-check"></i><b>5.5.5</b> Expanding aggregated counts (integer subsetting)</a></li>
<li class="chapter" data-level="5.5.6" data-path="subsetting.html"><a href="subsetting.html#removing-columns-from-data-frames-character-subsetting"><i class="fa fa-check"></i><b>5.5.6</b> Removing columns from data frames (character subsetting)</a></li>
<li class="chapter" data-level="5.5.7" data-path="subsetting.html"><a href="subsetting.html#selecting-rows-based-on-a-condition-logical-subsetting"><i class="fa fa-check"></i><b>5.5.7</b> Selecting rows based on a condition (logical subsetting)</a></li>
<li class="chapter" data-level="5.5.8" data-path="subsetting.html"><a href="subsetting.html#boolean-algebra-vs.sets-logical-integer-subsetting"><i class="fa fa-check"></i><b>5.5.8</b> Boolean algebra vs. sets (logical &amp; integer subsetting)</a></li>
<li class="chapter" data-level="5.5.9" data-path="subsetting.html"><a href="subsetting.html#exercises-11"><i class="fa fa-check"></i><b>5.5.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="subsetting.html"><a href="subsetting.html#subsetting-answers"><i class="fa fa-check"></i><b>5.6</b> Answers</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>6</b> Functions</a><ul>
<li class="chapter" data-level="6.1" data-path="functions.html"><a href="functions.html#introduction-4"><i class="fa fa-check"></i><b>6.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#quiz-3"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#outline-3"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="functions.html"><a href="functions.html#function-fundamentals"><i class="fa fa-check"></i><b>6.2</b> Function fundamentals</a><ul>
<li class="chapter" data-level="6.2.1" data-path="functions.html"><a href="functions.html#first-class-functions"><i class="fa fa-check"></i><b>6.2.1</b> First-class functions</a></li>
<li class="chapter" data-level="6.2.2" data-path="functions.html"><a href="functions.html#function-components"><i class="fa fa-check"></i><b>6.2.2</b> Function components</a></li>
<li class="chapter" data-level="6.2.3" data-path="functions.html"><a href="functions.html#primitive-functions"><i class="fa fa-check"></i><b>6.2.3</b> Primitive functions</a></li>
<li class="chapter" data-level="6.2.4" data-path="functions.html"><a href="functions.html#exercises-12"><i class="fa fa-check"></i><b>6.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="functions.html"><a href="functions.html#lexical-scoping"><i class="fa fa-check"></i><b>6.3</b> Lexical scoping</a><ul>
<li class="chapter" data-level="6.3.1" data-path="functions.html"><a href="functions.html#name-masking"><i class="fa fa-check"></i><b>6.3.1</b> Name masking</a></li>
<li class="chapter" data-level="6.3.2" data-path="functions.html"><a href="functions.html#functions-vs.variables"><i class="fa fa-check"></i><b>6.3.2</b> Functions vs. variables</a></li>
<li class="chapter" data-level="6.3.3" data-path="functions.html"><a href="functions.html#fresh-start"><i class="fa fa-check"></i><b>6.3.3</b> A fresh start</a></li>
<li class="chapter" data-level="6.3.4" data-path="functions.html"><a href="functions.html#dynamic-lookup"><i class="fa fa-check"></i><b>6.3.4</b> Dynamic lookup</a></li>
<li class="chapter" data-level="6.3.5" data-path="functions.html"><a href="functions.html#exercises-13"><i class="fa fa-check"></i><b>6.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="functions.html"><a href="functions.html#lazy-evaluation"><i class="fa fa-check"></i><b>6.4</b> Lazy evaluation</a><ul>
<li class="chapter" data-level="6.4.1" data-path="functions.html"><a href="functions.html#forcing-evaluation"><i class="fa fa-check"></i><b>6.4.1</b> Forcing evaluation</a></li>
<li class="chapter" data-level="6.4.2" data-path="functions.html"><a href="functions.html#promises"><i class="fa fa-check"></i><b>6.4.2</b> Promises</a></li>
<li class="chapter" data-level="6.4.3" data-path="functions.html"><a href="functions.html#default-arguments"><i class="fa fa-check"></i><b>6.4.3</b> Default arguments</a></li>
<li class="chapter" data-level="6.4.4" data-path="functions.html"><a href="functions.html#missing-arguments"><i class="fa fa-check"></i><b>6.4.4</b> Missing arguments</a></li>
<li class="chapter" data-level="6.4.5" data-path="functions.html"><a href="functions.html#exercises-14"><i class="fa fa-check"></i><b>6.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="functions.html"><a href="functions.html#fun-dot-dot-dot"><i class="fa fa-check"></i><b>6.5</b> <code>...</code> (dot-dot-dot)</a><ul>
<li class="chapter" data-level="6.5.1" data-path="functions.html"><a href="functions.html#exercises-15"><i class="fa fa-check"></i><b>6.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="functions.html"><a href="functions.html#exiting-a-function"><i class="fa fa-check"></i><b>6.6</b> Exiting a function</a><ul>
<li class="chapter" data-level="6.6.1" data-path="functions.html"><a href="functions.html#implicit-vs.explict-returns"><i class="fa fa-check"></i><b>6.6.1</b> Implicit vs. explict returns</a></li>
<li class="chapter" data-level="6.6.2" data-path="functions.html"><a href="functions.html#invisible-values"><i class="fa fa-check"></i><b>6.6.2</b> Invisible values</a></li>
<li class="chapter" data-level="6.6.3" data-path="functions.html"><a href="functions.html#errors"><i class="fa fa-check"></i><b>6.6.3</b> Errors</a></li>
<li class="chapter" data-level="6.6.4" data-path="functions.html"><a href="functions.html#on-exit"><i class="fa fa-check"></i><b>6.6.4</b> Exit handlers</a></li>
<li class="chapter" data-level="6.6.5" data-path="functions.html"><a href="functions.html#exercises-16"><i class="fa fa-check"></i><b>6.6.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="functions.html"><a href="functions.html#function-forms"><i class="fa fa-check"></i><b>6.7</b> Function forms</a><ul>
<li class="chapter" data-level="6.7.1" data-path="functions.html"><a href="functions.html#rewriting-to-prefix-form"><i class="fa fa-check"></i><b>6.7.1</b> Rewriting to prefix form</a></li>
<li class="chapter" data-level="6.7.2" data-path="functions.html"><a href="functions.html#prefix-form-prefix-form"><i class="fa fa-check"></i><b>6.7.2</b> Prefix form {prefix-form}</a></li>
<li class="chapter" data-level="6.7.3" data-path="functions.html"><a href="functions.html#infix-functions"><i class="fa fa-check"></i><b>6.7.3</b> Infix functions</a></li>
<li class="chapter" data-level="6.7.4" data-path="functions.html"><a href="functions.html#replacement-functions"><i class="fa fa-check"></i><b>6.7.4</b> Replacement functions</a></li>
<li class="chapter" data-level="6.7.5" data-path="functions.html"><a href="functions.html#special-forms"><i class="fa fa-check"></i><b>6.7.5</b> Special forms</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="functions.html"><a href="functions.html#invoking-a-function"><i class="fa fa-check"></i><b>6.8</b> Invoking a function</a><ul>
<li class="chapter" data-level="6.8.1" data-path="functions.html"><a href="functions.html#exercises-17"><i class="fa fa-check"></i><b>6.8.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="functions.html"><a href="functions.html#function-answers"><i class="fa fa-check"></i><b>6.9</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="environments.html"><a href="environments.html"><i class="fa fa-check"></i><b>7</b> Environments</a><ul>
<li class="chapter" data-level="7.1" data-path="environments.html"><a href="environments.html#introduction-5"><i class="fa fa-check"></i><b>7.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#quiz-4"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#outline-4"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#prerequisites-1"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="environments.html"><a href="environments.html#env-basics"><i class="fa fa-check"></i><b>7.2</b> Environment basics</a><ul>
<li class="chapter" data-level="7.2.1" data-path="environments.html"><a href="environments.html#basics"><i class="fa fa-check"></i><b>7.2.1</b> Basics</a></li>
<li class="chapter" data-level="7.2.2" data-path="environments.html"><a href="environments.html#important-environments"><i class="fa fa-check"></i><b>7.2.2</b> Important environments</a></li>
<li class="chapter" data-level="7.2.3" data-path="environments.html"><a href="environments.html#parents"><i class="fa fa-check"></i><b>7.2.3</b> Parents</a></li>
<li class="chapter" data-level="7.2.4" data-path="environments.html"><a href="environments.html#getting-and-setting-1"><i class="fa fa-check"></i><b>7.2.4</b> Getting and setting</a></li>
<li class="chapter" data-level="7.2.5" data-path="environments.html"><a href="environments.html#finalisers"><i class="fa fa-check"></i><b>7.2.5</b> Finalisers</a></li>
<li class="chapter" data-level="7.2.6" data-path="environments.html"><a href="environments.html#advanced-bindings"><i class="fa fa-check"></i><b>7.2.6</b> Advanced bindings</a></li>
<li class="chapter" data-level="7.2.7" data-path="environments.html"><a href="environments.html#exercises-18"><i class="fa fa-check"></i><b>7.2.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="environments.html"><a href="environments.html#env-recursion"><i class="fa fa-check"></i><b>7.3</b> Recursing over environments</a><ul>
<li class="chapter" data-level="7.3.1" data-path="environments.html"><a href="environments.html#exercises-19"><i class="fa fa-check"></i><b>7.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="environments.html"><a href="environments.html#function-envs"><i class="fa fa-check"></i><b>7.4</b> Special environments</a><ul>
<li class="chapter" data-level="7.4.1" data-path="environments.html"><a href="environments.html#package-environments-and-the-search-path"><i class="fa fa-check"></i><b>7.4.1</b> Package environments and the search path</a></li>
<li class="chapter" data-level="7.4.2" data-path="environments.html"><a href="environments.html#the-function-environment"><i class="fa fa-check"></i><b>7.4.2</b> The function environment</a></li>
<li class="chapter" data-level="7.4.3" data-path="environments.html"><a href="environments.html#namespaces"><i class="fa fa-check"></i><b>7.4.3</b> Namespaces</a></li>
<li class="chapter" data-level="7.4.4" data-path="environments.html"><a href="environments.html#execution-environments"><i class="fa fa-check"></i><b>7.4.4</b> Execution environments</a></li>
<li class="chapter" data-level="7.4.5" data-path="environments.html"><a href="environments.html#exercises-20"><i class="fa fa-check"></i><b>7.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="environments.html"><a href="environments.html#the-call-stack"><i class="fa fa-check"></i><b>7.5</b> The call stack</a><ul>
<li class="chapter" data-level="7.5.1" data-path="environments.html"><a href="environments.html#simple-call-stacks"><i class="fa fa-check"></i><b>7.5.1</b> Simple call stacks</a></li>
<li class="chapter" data-level="7.5.2" data-path="environments.html"><a href="environments.html#lazy-evaluation-1"><i class="fa fa-check"></i><b>7.5.2</b> Lazy evaluation</a></li>
<li class="chapter" data-level="7.5.3" data-path="environments.html"><a href="environments.html#frames"><i class="fa fa-check"></i><b>7.5.3</b> Frames</a></li>
<li class="chapter" data-level="7.5.4" data-path="environments.html"><a href="environments.html#dynamic-scope"><i class="fa fa-check"></i><b>7.5.4</b> Dynamic scope</a></li>
<li class="chapter" data-level="7.5.5" data-path="environments.html"><a href="environments.html#exercises-21"><i class="fa fa-check"></i><b>7.5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="environments.html"><a href="environments.html#explicit-envs"><i class="fa fa-check"></i><b>7.6</b> As data structures</a></li>
<li class="chapter" data-level="7.7" data-path="environments.html"><a href="environments.html#section-2"><i class="fa fa-check"></i><b>7.7</b> <code>&lt;&lt;-</code></a><ul>
<li class="chapter" data-level="7.7.1" data-path="environments.html"><a href="environments.html#exercises-22"><i class="fa fa-check"></i><b>7.7.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="environments.html"><a href="environments.html#env-answers"><i class="fa fa-check"></i><b>7.8</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditions.html"><a href="conditions.html"><i class="fa fa-check"></i><b>8</b> Conditions</a><ul>
<li class="chapter" data-level="8.1" data-path="conditions.html"><a href="conditions.html#introduction-6"><i class="fa fa-check"></i><b>8.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#quiz-5"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#overview"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="8.1.1" data-path="conditions.html"><a href="conditions.html#prerequisites-2"><i class="fa fa-check"></i><b>8.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="conditions.html"><a href="conditions.html#signalling-conditions"><i class="fa fa-check"></i><b>8.2</b> Signalling conditions</a><ul>
<li class="chapter" data-level="8.2.1" data-path="conditions.html"><a href="conditions.html#errors-1"><i class="fa fa-check"></i><b>8.2.1</b> Errors</a></li>
<li class="chapter" data-level="8.2.2" data-path="conditions.html"><a href="conditions.html#warnings"><i class="fa fa-check"></i><b>8.2.2</b> Warnings</a></li>
<li class="chapter" data-level="8.2.3" data-path="conditions.html"><a href="conditions.html#messages"><i class="fa fa-check"></i><b>8.2.3</b> Messages</a></li>
<li class="chapter" data-level="8.2.4" data-path="conditions.html"><a href="conditions.html#exercises-23"><i class="fa fa-check"></i><b>8.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="conditions.html"><a href="conditions.html#ignoring-conditions"><i class="fa fa-check"></i><b>8.3</b> Ignoring conditions</a></li>
<li class="chapter" data-level="8.4" data-path="conditions.html"><a href="conditions.html#handling-conditions"><i class="fa fa-check"></i><b>8.4</b> Handling conditions</a><ul>
<li class="chapter" data-level="8.4.1" data-path="conditions.html"><a href="conditions.html#condition-objects"><i class="fa fa-check"></i><b>8.4.1</b> Condition objects</a></li>
<li class="chapter" data-level="8.4.2" data-path="conditions.html"><a href="conditions.html#exiting-handlers"><i class="fa fa-check"></i><b>8.4.2</b> Exiting handlers</a></li>
<li class="chapter" data-level="8.4.3" data-path="conditions.html"><a href="conditions.html#calling-handlers"><i class="fa fa-check"></i><b>8.4.3</b> Calling handlers</a></li>
<li class="chapter" data-level="8.4.4" data-path="conditions.html"><a href="conditions.html#call-stacks"><i class="fa fa-check"></i><b>8.4.4</b> Call stacks</a></li>
<li class="chapter" data-level="8.4.5" data-path="conditions.html"><a href="conditions.html#exercises-24"><i class="fa fa-check"></i><b>8.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="conditions.html"><a href="conditions.html#custom-conditions"><i class="fa fa-check"></i><b>8.5</b> Custom conditions</a><ul>
<li class="chapter" data-level="8.5.1" data-path="conditions.html"><a href="conditions.html#motivation"><i class="fa fa-check"></i><b>8.5.1</b> Motivation</a></li>
<li class="chapter" data-level="8.5.2" data-path="conditions.html"><a href="conditions.html#signalling"><i class="fa fa-check"></i><b>8.5.2</b> Signalling</a></li>
<li class="chapter" data-level="8.5.3" data-path="conditions.html"><a href="conditions.html#handling"><i class="fa fa-check"></i><b>8.5.3</b> Handling</a></li>
<li class="chapter" data-level="8.5.4" data-path="conditions.html"><a href="conditions.html#exercises-25"><i class="fa fa-check"></i><b>8.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="conditions.html"><a href="conditions.html#condition-applications"><i class="fa fa-check"></i><b>8.6</b> Applications</a><ul>
<li class="chapter" data-level="8.6.1" data-path="conditions.html"><a href="conditions.html#failure-value"><i class="fa fa-check"></i><b>8.6.1</b> Failure value</a></li>
<li class="chapter" data-level="8.6.2" data-path="conditions.html"><a href="conditions.html#success-and-failure-values"><i class="fa fa-check"></i><b>8.6.2</b> Success and failure values</a></li>
<li class="chapter" data-level="8.6.3" data-path="conditions.html"><a href="conditions.html#resignal"><i class="fa fa-check"></i><b>8.6.3</b> Resignal</a></li>
<li class="chapter" data-level="8.6.4" data-path="conditions.html"><a href="conditions.html#record"><i class="fa fa-check"></i><b>8.6.4</b> Record</a></li>
<li class="chapter" data-level="8.6.5" data-path="conditions.html"><a href="conditions.html#no-default-behaviour"><i class="fa fa-check"></i><b>8.6.5</b> No default behaviour</a></li>
<li class="chapter" data-level="8.6.6" data-path="conditions.html"><a href="conditions.html#exercises-26"><i class="fa fa-check"></i><b>8.6.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="conditions.html"><a href="conditions.html#conditions-answers"><i class="fa fa-check"></i><b>8.7</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="connections.html"><a href="connections.html"><i class="fa fa-check"></i><b>9</b> Connections</a><ul>
<li class="chapter" data-level="9.1" data-path="connections.html"><a href="connections.html#basics-1"><i class="fa fa-check"></i><b>9.1</b> Basics</a></li>
<li class="chapter" data-level="9.2" data-path="connections.html"><a href="connections.html#reading-and-writing-binary-data"><i class="fa fa-check"></i><b>9.2</b> Reading and writing binary data</a></li>
<li class="chapter" data-level="9.3" data-path="connections.html"><a href="connections.html#reading-and-writing-text-data"><i class="fa fa-check"></i><b>9.3</b> Reading and writing text data</a></li>
</ul></li>
<li class="part"><span><b>II Functional programming</b></span></li>
<li class="chapter" data-level="" data-path="fp.html"><a href="fp.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="10" data-path="functionals.html"><a href="functionals.html"><i class="fa fa-check"></i><b>10</b> Functionals</a><ul>
<li class="chapter" data-level="10.1" data-path="functionals.html"><a href="functionals.html#introduction-7"><i class="fa fa-check"></i><b>10.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#outline-5"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#prerequisites-3"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="functionals.html"><a href="functionals.html#map"><i class="fa fa-check"></i><b>10.2</b> My first functional: <code>map()</code></a><ul>
<li class="chapter" data-level="10.2.1" data-path="functionals.html"><a href="functionals.html#producing-atomic-vectors"><i class="fa fa-check"></i><b>10.2.1</b> Producing atomic vectors</a></li>
<li class="chapter" data-level="10.2.2" data-path="functionals.html"><a href="functionals.html#anonymous-functions-and-helpers"><i class="fa fa-check"></i><b>10.2.2</b> Anonymous functions and helpers</a></li>
<li class="chapter" data-level="10.2.3" data-path="functionals.html"><a href="functionals.html#passing-arguments"><i class="fa fa-check"></i><b>10.2.3</b> Passing arguments with <code>...</code></a></li>
<li class="chapter" data-level="10.2.4" data-path="functionals.html"><a href="functionals.html#argument-names"><i class="fa fa-check"></i><b>10.2.4</b> Argument names</a></li>
<li class="chapter" data-level="10.2.5" data-path="functionals.html"><a href="functionals.html#change-argument"><i class="fa fa-check"></i><b>10.2.5</b> Varying another argument</a></li>
<li class="chapter" data-level="10.2.6" data-path="functionals.html"><a href="functionals.html#exercises-27"><i class="fa fa-check"></i><b>10.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="functionals.html"><a href="functionals.html#functionals-loop"><i class="fa fa-check"></i><b>10.3</b> Map variants</a><ul>
<li class="chapter" data-level="10.3.1" data-path="functionals.html"><a href="functionals.html#modify"><i class="fa fa-check"></i><b>10.3.1</b> Same type of output as input: <code>modify()</code></a></li>
<li class="chapter" data-level="10.3.2" data-path="functionals.html"><a href="functionals.html#map2"><i class="fa fa-check"></i><b>10.3.2</b> Two inputs: <code>map2()</code> and friends</a></li>
<li class="chapter" data-level="10.3.3" data-path="functionals.html"><a href="functionals.html#no-outputs-walk-and-friends"><i class="fa fa-check"></i><b>10.3.3</b> No outputs: <code>walk()</code> and friends</a></li>
<li class="chapter" data-level="10.3.4" data-path="functionals.html"><a href="functionals.html#iterating-over-values-and-indices"><i class="fa fa-check"></i><b>10.3.4</b> Iterating over values and indices</a></li>
<li class="chapter" data-level="10.3.5" data-path="functionals.html"><a href="functionals.html#pmap"><i class="fa fa-check"></i><b>10.3.5</b> Any number of inputs: <code>pmap()</code> and friends</a></li>
<li class="chapter" data-level="10.3.6" data-path="functionals.html"><a href="functionals.html#exercises-28"><i class="fa fa-check"></i><b>10.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="functionals.html"><a href="functionals.html#reduce"><i class="fa fa-check"></i><b>10.4</b> Reduce</a><ul>
<li class="chapter" data-level="10.4.1" data-path="functionals.html"><a href="functionals.html#basics-2"><i class="fa fa-check"></i><b>10.4.1</b> Basics</a></li>
<li class="chapter" data-level="10.4.2" data-path="functionals.html"><a href="functionals.html#algebra"><i class="fa fa-check"></i><b>10.4.2</b> Algebra</a></li>
<li class="chapter" data-level="10.4.3" data-path="functionals.html"><a href="functionals.html#initialise"><i class="fa fa-check"></i><b>10.4.3</b> Initialise</a></li>
<li class="chapter" data-level="10.4.4" data-path="functionals.html"><a href="functionals.html#reduce2"><i class="fa fa-check"></i><b>10.4.4</b> reduce2</a></li>
<li class="chapter" data-level="10.4.5" data-path="functionals.html"><a href="functionals.html#accumulate"><i class="fa fa-check"></i><b>10.4.5</b> Accumulate</a></li>
<li class="chapter" data-level="10.4.6" data-path="functionals.html"><a href="functionals.html#map-reduce"><i class="fa fa-check"></i><b>10.4.6</b> Map-reduce</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="functionals.html"><a href="functionals.html#predicate-functionals"><i class="fa fa-check"></i><b>10.5</b> Predicate functionals</a><ul>
<li class="chapter" data-level="10.5.1" data-path="functionals.html"><a href="functionals.html#basics-3"><i class="fa fa-check"></i><b>10.5.1</b> Basics</a></li>
<li class="chapter" data-level="10.5.2" data-path="functionals.html"><a href="functionals.html#predicate-map"><i class="fa fa-check"></i><b>10.5.2</b> Map variants</a></li>
<li class="chapter" data-level="10.5.3" data-path="functionals.html"><a href="functionals.html#exercises-29"><i class="fa fa-check"></i><b>10.5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="functionals.html"><a href="functionals.html#functionals-math"><i class="fa fa-check"></i><b>10.6</b> Base functionals</a><ul>
<li class="chapter" data-level="10.6.1" data-path="functionals.html"><a href="functionals.html#matrices-and-array-operations"><i class="fa fa-check"></i><b>10.6.1</b> Matrices and array operations</a></li>
<li class="chapter" data-level="10.6.2" data-path="functionals.html"><a href="functionals.html#tapply"><i class="fa fa-check"></i><b>10.6.2</b> <code>tapply()</code></a></li>
<li class="chapter" data-level="10.6.3" data-path="functionals.html"><a href="functionals.html#mathmatical"><i class="fa fa-check"></i><b>10.6.3</b> Mathmatical</a></li>
<li class="chapter" data-level="10.6.4" data-path="functionals.html"><a href="functionals.html#exercises-30"><i class="fa fa-check"></i><b>10.6.4</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="function-factories.html"><a href="function-factories.html"><i class="fa fa-check"></i><b>11</b> Function factories</a><ul>
<li class="chapter" data-level="11.1" data-path="function-factories.html"><a href="function-factories.html#introduction-8"><i class="fa fa-check"></i><b>11.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#outline-6"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#prerequisites-4"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="function-factories.html"><a href="function-factories.html#factory-fundamentals"><i class="fa fa-check"></i><b>11.2</b> Factory fundamentals</a><ul>
<li class="chapter" data-level="11.2.1" data-path="function-factories.html"><a href="function-factories.html#environments-1"><i class="fa fa-check"></i><b>11.2.1</b> Environments</a></li>
<li class="chapter" data-level="11.2.2" data-path="function-factories.html"><a href="function-factories.html#diagram-conventions"><i class="fa fa-check"></i><b>11.2.2</b> Diagram conventions</a></li>
<li class="chapter" data-level="11.2.3" data-path="function-factories.html"><a href="function-factories.html#stateful-funs"><i class="fa fa-check"></i><b>11.2.3</b> Stateful functions</a></li>
<li class="chapter" data-level="11.2.4" data-path="function-factories.html"><a href="function-factories.html#potential-pitfalls"><i class="fa fa-check"></i><b>11.2.4</b> Potential pitfalls</a></li>
<li class="chapter" data-level="11.2.5" data-path="function-factories.html"><a href="function-factories.html#exercises-31"><i class="fa fa-check"></i><b>11.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="function-factories.html"><a href="function-factories.html#graph-fact"><i class="fa fa-check"></i><b>11.3</b> Graphical factories</a><ul>
<li class="chapter" data-level="11.3.1" data-path="function-factories.html"><a href="function-factories.html#labelling"><i class="fa fa-check"></i><b>11.3.1</b> Labelling</a></li>
<li class="chapter" data-level="11.3.2" data-path="function-factories.html"><a href="function-factories.html#histogram-bins"><i class="fa fa-check"></i><b>11.3.2</b> Histogram bins</a></li>
<li class="chapter" data-level="11.3.3" data-path="function-factories.html"><a href="function-factories.html#ggsave"><i class="fa fa-check"></i><b>11.3.3</b> ggsave</a></li>
<li class="chapter" data-level="11.3.4" data-path="function-factories.html"><a href="function-factories.html#exercises-32"><i class="fa fa-check"></i><b>11.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="function-factories.html"><a href="function-factories.html#stat-fact"><i class="fa fa-check"></i><b>11.4</b> Statistical factories</a><ul>
<li class="chapter" data-level="11.4.1" data-path="function-factories.html"><a href="function-factories.html#box-cox-transformation"><i class="fa fa-check"></i><b>11.4.1</b> Box-Cox transformation</a></li>
<li class="chapter" data-level="11.4.2" data-path="function-factories.html"><a href="function-factories.html#bootstrap-generators"><i class="fa fa-check"></i><b>11.4.2</b> Bootstrap generators</a></li>
<li class="chapter" data-level="11.4.3" data-path="function-factories.html"><a href="function-factories.html#MLE"><i class="fa fa-check"></i><b>11.4.3</b> Maximum likelihood estimation</a></li>
<li class="chapter" data-level="11.4.4" data-path="function-factories.html"><a href="function-factories.html#exercises-33"><i class="fa fa-check"></i><b>11.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="function-factories.html"><a href="function-factories.html#functional-factories"><i class="fa fa-check"></i><b>11.5</b> Function factories + functionals</a><ul>
<li class="chapter" data-level="11.5.1" data-path="function-factories.html"><a href="function-factories.html#moving-a-lists-to-the-global-environment"><i class="fa fa-check"></i><b>11.5.1</b> Moving a lists to the global environment</a></li>
<li class="chapter" data-level="11.5.2" data-path="function-factories.html"><a href="function-factories.html#another-approach"><i class="fa fa-check"></i><b>11.5.2</b> Another approach</a></li>
<li class="chapter" data-level="11.5.3" data-path="function-factories.html"><a href="function-factories.html#exercises-34"><i class="fa fa-check"></i><b>11.5.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="function-operators.html"><a href="function-operators.html"><i class="fa fa-check"></i><b>12</b> Function operators</a><ul>
<li class="chapter" data-level="12.1" data-path="function-operators.html"><a href="function-operators.html#introduction-9"><i class="fa fa-check"></i><b>12.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="function-operators.html"><a href="function-operators.html#outline-7"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="function-operators.html"><a href="function-operators.html#prerequisites-5"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="function-operators.html"><a href="function-operators.html#behavioural-fos"><i class="fa fa-check"></i><b>12.2</b> Behavioural FOs</a><ul>
<li class="chapter" data-level="12.2.1" data-path="function-operators.html"><a href="function-operators.html#memoisation"><i class="fa fa-check"></i><b>12.2.1</b> Memoisation</a></li>
<li class="chapter" data-level="12.2.2" data-path="function-operators.html"><a href="function-operators.html#tee"><i class="fa fa-check"></i><b>12.2.2</b> Capturing function invocations</a></li>
<li class="chapter" data-level="12.2.3" data-path="function-operators.html"><a href="function-operators.html#laziness"><i class="fa fa-check"></i><b>12.2.3</b> Laziness</a></li>
<li class="chapter" data-level="12.2.4" data-path="function-operators.html"><a href="function-operators.html#exercises-35"><i class="fa fa-check"></i><b>12.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="function-operators.html"><a href="function-operators.html#output-fos"><i class="fa fa-check"></i><b>12.3</b> Output FOs</a><ul>
<li class="chapter" data-level="12.3.1" data-path="function-operators.html"><a href="function-operators.html#minor-modifications"><i class="fa fa-check"></i><b>12.3.1</b> Minor modifications</a></li>
<li class="chapter" data-level="12.3.2" data-path="function-operators.html"><a href="function-operators.html#changing-what-a-function-does"><i class="fa fa-check"></i><b>12.3.2</b> Changing what a function does</a></li>
<li class="chapter" data-level="12.3.3" data-path="function-operators.html"><a href="function-operators.html#exercises-36"><i class="fa fa-check"></i><b>12.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="function-operators.html"><a href="function-operators.html#input-fos"><i class="fa fa-check"></i><b>12.4</b> Input FOs</a><ul>
<li class="chapter" data-level="12.4.1" data-path="function-operators.html"><a href="function-operators.html#prefilling-function-arguments-partial-function-application"><i class="fa fa-check"></i><b>12.4.1</b> Prefilling function arguments: partial function application</a></li>
<li class="chapter" data-level="12.4.2" data-path="function-operators.html"><a href="function-operators.html#changing-input-types"><i class="fa fa-check"></i><b>12.4.2</b> Changing input types</a></li>
<li class="chapter" data-level="12.4.3" data-path="function-operators.html"><a href="function-operators.html#exercises-37"><i class="fa fa-check"></i><b>12.4.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="function-operators.html"><a href="function-operators.html#combining-fos"><i class="fa fa-check"></i><b>12.5</b> Combining FOs</a><ul>
<li class="chapter" data-level="12.5.1" data-path="function-operators.html"><a href="function-operators.html#function-composition"><i class="fa fa-check"></i><b>12.5.1</b> Function composition</a></li>
<li class="chapter" data-level="12.5.2" data-path="function-operators.html"><a href="function-operators.html#logical-predicates-and-boolean-algebra"><i class="fa fa-check"></i><b>12.5.2</b> Logical predicates and boolean algebra</a></li>
<li class="chapter" data-level="12.5.3" data-path="function-operators.html"><a href="function-operators.html#exercises-38"><i class="fa fa-check"></i><b>12.5.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Object oriented programming</b></span></li>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="12.6" data-path="oo.html"><a href="oo.html#oop-systems"><i class="fa fa-check"></i><b>12.6</b> OOP Systems</a></li>
<li class="chapter" data-level="12.7" data-path="oo.html"><a href="oo.html#oop-in-r"><i class="fa fa-check"></i><b>12.7</b> OOP in R</a></li>
<li class="chapter" data-level="12.8" data-path="oo.html"><a href="oo.html#field-guide"><i class="fa fa-check"></i><b>12.8</b> Field guide</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="base-types.html"><a href="base-types.html"><i class="fa fa-check"></i><b>13</b> Base types</a><ul>
<li class="chapter" data-level="13.1" data-path="base-types.html"><a href="base-types.html#introduction-10"><i class="fa fa-check"></i><b>13.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="base-types.html"><a href="base-types.html#outline-8"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="base-types.html"><a href="base-types.html#base-objects-vs-oo-objects"><i class="fa fa-check"></i><b>13.2</b> Base objects vs OO objects</a></li>
<li class="chapter" data-level="13.3" data-path="base-types.html"><a href="base-types.html#base-types-2"><i class="fa fa-check"></i><b>13.3</b> Base types</a></li>
<li class="chapter" data-level="13.4" data-path="base-types.html"><a href="base-types.html#is-functions"><i class="fa fa-check"></i><b>13.4</b> The is functions</a><ul>
<li class="chapter" data-level="13.4.1" data-path="base-types.html"><a href="base-types.html#numeric-type"><i class="fa fa-check"></i><b>13.4.1</b> Numeric type</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="s3.html"><a href="s3.html"><i class="fa fa-check"></i><b>14</b> S3</a><ul>
<li class="chapter" data-level="14.1" data-path="s3.html"><a href="s3.html#introduction-11"><i class="fa fa-check"></i><b>14.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#outline-9"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#prerequisites-6"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="s3.html"><a href="s3.html#s3-basics"><i class="fa fa-check"></i><b>14.2</b> Basics</a><ul>
<li class="chapter" data-level="14.2.1" data-path="s3.html"><a href="s3.html#exercises-39"><i class="fa fa-check"></i><b>14.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="s3.html"><a href="s3.html#classes"><i class="fa fa-check"></i><b>14.3</b> Classes</a><ul>
<li class="chapter" data-level="14.3.1" data-path="s3.html"><a href="s3.html#constructors"><i class="fa fa-check"></i><b>14.3.1</b> Constructors</a></li>
<li class="chapter" data-level="14.3.2" data-path="s3.html"><a href="s3.html#validators"><i class="fa fa-check"></i><b>14.3.2</b> Validators</a></li>
<li class="chapter" data-level="14.3.3" data-path="s3.html"><a href="s3.html#helpers"><i class="fa fa-check"></i><b>14.3.3</b> Helpers</a></li>
<li class="chapter" data-level="14.3.4" data-path="s3.html"><a href="s3.html#object-styles"><i class="fa fa-check"></i><b>14.3.4</b> Object styles</a></li>
<li class="chapter" data-level="14.3.5" data-path="s3.html"><a href="s3.html#exercises-40"><i class="fa fa-check"></i><b>14.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="s3.html"><a href="s3.html#generics-and-methods"><i class="fa fa-check"></i><b>14.4</b> Generics and methods</a><ul>
<li class="chapter" data-level="14.4.1" data-path="s3.html"><a href="s3.html#coercion"><i class="fa fa-check"></i><b>14.4.1</b> Coercion</a></li>
<li class="chapter" data-level="14.4.2" data-path="s3.html"><a href="s3.html#s3-arguments"><i class="fa fa-check"></i><b>14.4.2</b> Arguments</a></li>
<li class="chapter" data-level="14.4.3" data-path="s3.html"><a href="s3.html#exercises-41"><i class="fa fa-check"></i><b>14.4.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="s3.html"><a href="s3.html#method-dispatch"><i class="fa fa-check"></i><b>14.5</b> Method dispatch</a><ul>
<li class="chapter" data-level="14.5.1" data-path="s3.html"><a href="s3.html#usemethod"><i class="fa fa-check"></i><b>14.5.1</b> <code>UseMethod()</code></a></li>
<li class="chapter" data-level="14.5.2" data-path="s3.html"><a href="s3.html#nextmethod"><i class="fa fa-check"></i><b>14.5.2</b> <code>NextMethod()</code></a></li>
<li class="chapter" data-level="14.5.3" data-path="s3.html"><a href="s3.html#exercises-42"><i class="fa fa-check"></i><b>14.5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="s3.html"><a href="s3.html#inheritance"><i class="fa fa-check"></i><b>14.6</b> Inheritance</a><ul>
<li class="chapter" data-level="14.6.1" data-path="s3.html"><a href="s3.html#constructors-1"><i class="fa fa-check"></i><b>14.6.1</b> Constructors</a></li>
<li class="chapter" data-level="14.6.2" data-path="s3.html"><a href="s3.html#coercion-1"><i class="fa fa-check"></i><b>14.6.2</b> Coercion</a></li>
<li class="chapter" data-level="14.6.3" data-path="s3.html"><a href="s3.html#methods"><i class="fa fa-check"></i><b>14.6.3</b> Methods</a></li>
<li class="chapter" data-level="14.6.4" data-path="s3.html"><a href="s3.html#exercises-43"><i class="fa fa-check"></i><b>14.6.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.7" data-path="s3.html"><a href="s3.html#dispatch-details"><i class="fa fa-check"></i><b>14.7</b> Dispatch details</a><ul>
<li class="chapter" data-level="14.7.1" data-path="s3.html"><a href="s3.html#environments-and-namespaces"><i class="fa fa-check"></i><b>14.7.1</b> Environments and namespaces</a></li>
<li class="chapter" data-level="14.7.2" data-path="s3.html"><a href="s3.html#s3-and-base-types"><i class="fa fa-check"></i><b>14.7.2</b> S3 and base types</a></li>
<li class="chapter" data-level="14.7.3" data-path="s3.html"><a href="s3.html#internal-generics"><i class="fa fa-check"></i><b>14.7.3</b> Internal generics</a></li>
<li class="chapter" data-level="14.7.4" data-path="s3.html"><a href="s3.html#group-generics"><i class="fa fa-check"></i><b>14.7.4</b> Group generics</a></li>
<li class="chapter" data-level="14.7.5" data-path="s3.html"><a href="s3.html#double-dispatch"><i class="fa fa-check"></i><b>14.7.5</b> Double dispatch</a></li>
<li class="chapter" data-level="14.7.6" data-path="s3.html"><a href="s3.html#exercises-44"><i class="fa fa-check"></i><b>14.7.6</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="s4.html"><a href="s4.html"><i class="fa fa-check"></i><b>15</b> S4</a><ul>
<li class="chapter" data-level="15.1" data-path="s4.html"><a href="s4.html#introduction-12"><i class="fa fa-check"></i><b>15.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#outline-10"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#prerequisites-7"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="s4.html"><a href="s4.html#classes-1"><i class="fa fa-check"></i><b>15.2</b> Classes</a><ul>
<li class="chapter" data-level="15.2.1" data-path="s4.html"><a href="s4.html#slots"><i class="fa fa-check"></i><b>15.2.1</b> Slots</a></li>
<li class="chapter" data-level="15.2.2" data-path="s4.html"><a href="s4.html#helper"><i class="fa fa-check"></i><b>15.2.2</b> Helper</a></li>
<li class="chapter" data-level="15.2.3" data-path="s4.html"><a href="s4.html#introspection"><i class="fa fa-check"></i><b>15.2.3</b> Introspection</a></li>
<li class="chapter" data-level="15.2.4" data-path="s4.html"><a href="s4.html#exercises-45"><i class="fa fa-check"></i><b>15.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="s4.html"><a href="s4.html#generics-and-methods-1"><i class="fa fa-check"></i><b>15.3</b> Generics and methods</a><ul>
<li class="chapter" data-level="15.3.1" data-path="s4.html"><a href="s4.html#show-method"><i class="fa fa-check"></i><b>15.3.1</b> Show method</a></li>
<li class="chapter" data-level="15.3.2" data-path="s4.html"><a href="s4.html#accessor-methods"><i class="fa fa-check"></i><b>15.3.2</b> Accessor methods</a></li>
<li class="chapter" data-level="15.3.3" data-path="s4.html"><a href="s4.html#coercion-methods"><i class="fa fa-check"></i><b>15.3.3</b> Coercion methods</a></li>
<li class="chapter" data-level="15.3.4" data-path="s4.html"><a href="s4.html#introspection-1"><i class="fa fa-check"></i><b>15.3.4</b> Introspection</a></li>
<li class="chapter" data-level="15.3.5" data-path="s4.html"><a href="s4.html#exercises-46"><i class="fa fa-check"></i><b>15.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="s4.html"><a href="s4.html#method-dispatch-1"><i class="fa fa-check"></i><b>15.4</b> Method dispatch</a><ul>
<li class="chapter" data-level="15.4.1" data-path="s4.html"><a href="s4.html#single-dispatch"><i class="fa fa-check"></i><b>15.4.1</b> Single dispatch</a></li>
<li class="chapter" data-level="15.4.2" data-path="s4.html"><a href="s4.html#multiple-inheritance"><i class="fa fa-check"></i><b>15.4.2</b> Multiple inheritance</a></li>
<li class="chapter" data-level="15.4.3" data-path="s4.html"><a href="s4.html#multiple-dispatch"><i class="fa fa-check"></i><b>15.4.3</b> Multiple dispatch</a></li>
<li class="chapter" data-level="15.4.4" data-path="s4.html"><a href="s4.html#multiple-dispatch-and-multiple-inheritance"><i class="fa fa-check"></i><b>15.4.4</b> Multiple dispatch and multiple inheritance</a></li>
<li class="chapter" data-level="15.4.5" data-path="s4.html"><a href="s4.html#exercises-47"><i class="fa fa-check"></i><b>15.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="s4.html"><a href="s4.html#s4-and-existing-code"><i class="fa fa-check"></i><b>15.5</b> S4 and existing code</a><ul>
<li class="chapter" data-level="15.5.1" data-path="s4.html"><a href="s4.html#classes-2"><i class="fa fa-check"></i><b>15.5.1</b> Classes</a></li>
<li class="chapter" data-level="15.5.2" data-path="s4.html"><a href="s4.html#generics"><i class="fa fa-check"></i><b>15.5.2</b> Generics</a></li>
<li class="chapter" data-level="15.5.3" data-path="s4.html"><a href="s4.html#exercises-48"><i class="fa fa-check"></i><b>15.5.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="R6.html"><a href="R6.html"><i class="fa fa-check"></i><b>16</b> R6</a><ul>
<li class="chapter" data-level="16.1" data-path="R6.html"><a href="R6.html#introduction-13"><i class="fa fa-check"></i><b>16.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="R6.html"><a href="R6.html#outline-11"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="R6.html"><a href="R6.html#prequisites"><i class="fa fa-check"></i>Prequisites</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="R6.html"><a href="R6.html#classes-and-methods"><i class="fa fa-check"></i><b>16.2</b> Classes and methods</a><ul>
<li class="chapter" data-level="16.2.1" data-path="R6.html"><a href="R6.html#method-chaining"><i class="fa fa-check"></i><b>16.2.1</b> Method chaining</a></li>
<li class="chapter" data-level="16.2.2" data-path="R6.html"><a href="R6.html#important-methods"><i class="fa fa-check"></i><b>16.2.2</b> Important methods</a></li>
<li class="chapter" data-level="16.2.3" data-path="R6.html"><a href="R6.html#adding-methods-after-creation"><i class="fa fa-check"></i><b>16.2.3</b> Adding methods after creation</a></li>
<li class="chapter" data-level="16.2.4" data-path="R6.html"><a href="R6.html#inheritance-1"><i class="fa fa-check"></i><b>16.2.4</b> Inheritance</a></li>
<li class="chapter" data-level="16.2.5" data-path="R6.html"><a href="R6.html#introspection-2"><i class="fa fa-check"></i><b>16.2.5</b> Introspection</a></li>
<li class="chapter" data-level="16.2.6" data-path="R6.html"><a href="R6.html#exercises-49"><i class="fa fa-check"></i><b>16.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="R6.html"><a href="R6.html#controlling-access"><i class="fa fa-check"></i><b>16.3</b> Controlling access</a><ul>
<li class="chapter" data-level="16.3.1" data-path="R6.html"><a href="R6.html#privacy"><i class="fa fa-check"></i><b>16.3.1</b> Privacy</a></li>
<li class="chapter" data-level="16.3.2" data-path="R6.html"><a href="R6.html#active-fields"><i class="fa fa-check"></i><b>16.3.2</b> Active fields</a></li>
<li class="chapter" data-level="16.3.3" data-path="R6.html"><a href="R6.html#exercises-50"><i class="fa fa-check"></i><b>16.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="R6.html"><a href="R6.html#reference-semantics"><i class="fa fa-check"></i><b>16.4</b> Reference semantics</a><ul>
<li class="chapter" data-level="16.4.1" data-path="R6.html"><a href="R6.html#reasoning"><i class="fa fa-check"></i><b>16.4.1</b> Reasoning</a></li>
<li class="chapter" data-level="16.4.2" data-path="R6.html"><a href="R6.html#finalizer"><i class="fa fa-check"></i><b>16.4.2</b> Finalizer</a></li>
<li class="chapter" data-level="16.4.3" data-path="R6.html"><a href="R6.html#r6-fields"><i class="fa fa-check"></i><b>16.4.3</b> R6 fields</a></li>
<li class="chapter" data-level="16.4.4" data-path="R6.html"><a href="R6.html#exercises-51"><i class="fa fa-check"></i><b>16.4.4</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html"><i class="fa fa-check"></i><b>17</b> Trade-offs</a><ul>
<li class="chapter" data-level="17.1" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#introduction-14"><i class="fa fa-check"></i><b>17.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#outline-12"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#s3-s4"><i class="fa fa-check"></i><b>17.2</b> S4 vs S3</a></li>
<li class="chapter" data-level="17.3" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#s3-r6"><i class="fa fa-check"></i><b>17.3</b> R6 vs S3</a><ul>
<li class="chapter" data-level="17.3.1" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#namespacing"><i class="fa fa-check"></i><b>17.3.1</b> Namespacing</a></li>
<li class="chapter" data-level="17.3.2" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#threading-state"><i class="fa fa-check"></i><b>17.3.2</b> Threading state</a></li>
<li class="chapter" data-level="17.3.3" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#tradeoffs-pipe"><i class="fa fa-check"></i><b>17.3.3</b> Method chaining</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Metaprogramming</b></span></li>
<li class="chapter" data-level="" data-path="meta.html"><a href="meta.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="17.3.4" data-path="meta.html"><a href="meta.html#trading-precision-for-concision"><i class="fa fa-check"></i><b>17.3.4</b> Trading precision for concision</a></li>
<li class="chapter" data-level="17.4" data-path="meta.html"><a href="meta.html#domain-specific-languages"><i class="fa fa-check"></i><b>17.4</b> Domain specific languages</a></li>
<li class="chapter" data-level="17.5" data-path="meta.html"><a href="meta.html#overview-1"><i class="fa fa-check"></i><b>17.5</b> Overview</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="expressions.html"><a href="expressions.html"><i class="fa fa-check"></i><b>18</b> Expressions</a><ul>
<li class="chapter" data-level="18.1" data-path="expressions.html"><a href="expressions.html#introduction-15"><i class="fa fa-check"></i><b>18.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="expressions.html"><a href="expressions.html#outline-13"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="expressions.html"><a href="expressions.html#prerequisites-8"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="expressions.html"><a href="expressions.html#abstract-syntax-trees"><i class="fa fa-check"></i><b>18.2</b> Abstract syntax trees</a><ul>
<li class="chapter" data-level="18.2.1" data-path="expressions.html"><a href="expressions.html#infix-vs.prefix-calls"><i class="fa fa-check"></i><b>18.2.1</b> Infix vs. prefix calls</a></li>
<li class="chapter" data-level="18.2.2" data-path="expressions.html"><a href="expressions.html#special-forms-1"><i class="fa fa-check"></i><b>18.2.2</b> Special forms</a></li>
<li class="chapter" data-level="18.2.3" data-path="expressions.html"><a href="expressions.html#function-factories-1"><i class="fa fa-check"></i><b>18.2.3</b> Function factories</a></li>
<li class="chapter" data-level="18.2.4" data-path="expressions.html"><a href="expressions.html#argument-names-1"><i class="fa fa-check"></i><b>18.2.4</b> Argument names</a></li>
<li class="chapter" data-level="18.2.5" data-path="expressions.html"><a href="expressions.html#exercises-52"><i class="fa fa-check"></i><b>18.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="expressions.html"><a href="expressions.html#rs-grammar"><i class="fa fa-check"></i><b>18.3</b> R’s grammar</a><ul>
<li class="chapter" data-level="18.3.1" data-path="expressions.html"><a href="expressions.html#operator-precedence"><i class="fa fa-check"></i><b>18.3.1</b> Operator precedence</a></li>
<li class="chapter" data-level="18.3.2" data-path="expressions.html"><a href="expressions.html#associativity"><i class="fa fa-check"></i><b>18.3.2</b> Associativity</a></li>
<li class="chapter" data-level="18.3.3" data-path="expressions.html"><a href="expressions.html#whitespace"><i class="fa fa-check"></i><b>18.3.3</b> Whitespace</a></li>
<li class="chapter" data-level="18.3.4" data-path="expressions.html"><a href="expressions.html#exercises-53"><i class="fa fa-check"></i><b>18.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="expressions.html"><a href="expressions.html#data-structures"><i class="fa fa-check"></i><b>18.4</b> Data structures</a><ul>
<li class="chapter" data-level="18.4.1" data-path="expressions.html"><a href="expressions.html#naming-conventions"><i class="fa fa-check"></i><b>18.4.1</b> Naming conventions</a></li>
<li class="chapter" data-level="18.4.2" data-path="expressions.html"><a href="expressions.html#constants"><i class="fa fa-check"></i><b>18.4.2</b> Constants</a></li>
<li class="chapter" data-level="18.4.3" data-path="expressions.html"><a href="expressions.html#symbols"><i class="fa fa-check"></i><b>18.4.3</b> Symbols</a></li>
<li class="chapter" data-level="18.4.4" data-path="expressions.html"><a href="expressions.html#calls"><i class="fa fa-check"></i><b>18.4.4</b> Calls</a></li>
<li class="chapter" data-level="18.4.5" data-path="expressions.html"><a href="expressions.html#pairlists"><i class="fa fa-check"></i><b>18.4.5</b> Pairlists</a></li>
<li class="chapter" data-level="18.4.6" data-path="expressions.html"><a href="expressions.html#expression-objects"><i class="fa fa-check"></i><b>18.4.6</b> Expression objects</a></li>
<li class="chapter" data-level="18.4.7" data-path="expressions.html"><a href="expressions.html#exercises-54"><i class="fa fa-check"></i><b>18.4.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="expressions.html"><a href="expressions.html#parsing-and-deparsing"><i class="fa fa-check"></i><b>18.5</b> Parsing and deparsing</a><ul>
<li class="chapter" data-level="18.5.1" data-path="expressions.html"><a href="expressions.html#exercises-55"><i class="fa fa-check"></i><b>18.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="expressions.html"><a href="expressions.html#ast-funs"><i class="fa fa-check"></i><b>18.6</b> Case study: Walking the AST with recursive functions</a><ul>
<li class="chapter" data-level="18.6.1" data-path="expressions.html"><a href="expressions.html#finding-f-and-t"><i class="fa fa-check"></i><b>18.6.1</b> Finding F and T</a></li>
<li class="chapter" data-level="18.6.2" data-path="expressions.html"><a href="expressions.html#finding-all-variables-created-by-assignment"><i class="fa fa-check"></i><b>18.6.2</b> Finding all variables created by assignment</a></li>
<li class="chapter" data-level="18.6.3" data-path="expressions.html"><a href="expressions.html#exercises-56"><i class="fa fa-check"></i><b>18.6.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="quasiquotation.html"><a href="quasiquotation.html"><i class="fa fa-check"></i><b>19</b> Quasiquotation</a><ul>
<li class="chapter" data-level="19.1" data-path="quasiquotation.html"><a href="quasiquotation.html#introduction-16"><i class="fa fa-check"></i><b>19.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#outline-14"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#prerequisites-9"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="19.2" data-path="quasiquotation.html"><a href="quasiquotation.html#motivation-1"><i class="fa fa-check"></i><b>19.2</b> Motivation</a><ul>
<li class="chapter" data-level="19.2.1" data-path="quasiquotation.html"><a href="quasiquotation.html#vocabulary"><i class="fa fa-check"></i><b>19.2.1</b> Vocabulary</a></li>
<li class="chapter" data-level="19.2.2" data-path="quasiquotation.html"><a href="quasiquotation.html#theory"><i class="fa fa-check"></i><b>19.2.2</b> Theory</a></li>
<li class="chapter" data-level="19.2.3" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-57"><i class="fa fa-check"></i><b>19.2.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="quasiquotation.html"><a href="quasiquotation.html#quotation"><i class="fa fa-check"></i><b>19.3</b> Quotation</a><ul>
<li class="chapter" data-level="19.3.1" data-path="quasiquotation.html"><a href="quasiquotation.html#with-rlang"><i class="fa fa-check"></i><b>19.3.1</b> With rlang</a></li>
<li class="chapter" data-level="19.3.2" data-path="quasiquotation.html"><a href="quasiquotation.html#with-base-r"><i class="fa fa-check"></i><b>19.3.2</b> With base R</a></li>
<li class="chapter" data-level="19.3.3" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-58"><i class="fa fa-check"></i><b>19.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="quasiquotation.html"><a href="quasiquotation.html#eval-basics"><i class="fa fa-check"></i><b>19.4</b> Evaluation</a></li>
<li class="chapter" data-level="19.5" data-path="quasiquotation.html"><a href="quasiquotation.html#unquotation"><i class="fa fa-check"></i><b>19.5</b> Unquotation</a><ul>
<li class="chapter" data-level="19.5.1" data-path="quasiquotation.html"><a href="quasiquotation.html#with-rlang-1"><i class="fa fa-check"></i><b>19.5.1</b> With rlang</a></li>
<li class="chapter" data-level="19.5.2" data-path="quasiquotation.html"><a href="quasiquotation.html#the-polite-fiction-of"><i class="fa fa-check"></i><b>19.5.2</b> The polite fiction of <code>!!</code></a></li>
<li class="chapter" data-level="19.5.3" data-path="quasiquotation.html"><a href="quasiquotation.html#unquote-base"><i class="fa fa-check"></i><b>19.5.3</b> With base R</a></li>
<li class="chapter" data-level="19.5.4" data-path="quasiquotation.html"><a href="quasiquotation.html#non-standard-asts"><i class="fa fa-check"></i><b>19.5.4</b> Non-standard ASTs</a></li>
<li class="chapter" data-level="19.5.5" data-path="quasiquotation.html"><a href="quasiquotation.html#missing-arguments-1"><i class="fa fa-check"></i><b>19.5.5</b> Missing arguments</a></li>
<li class="chapter" data-level="19.5.6" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-59"><i class="fa fa-check"></i><b>19.5.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.6" data-path="quasiquotation.html"><a href="quasiquotation.html#quasi-case-studies"><i class="fa fa-check"></i><b>19.6</b> Case studies</a><ul>
<li class="chapter" data-level="19.6.1" data-path="quasiquotation.html"><a href="quasiquotation.html#map-reduce-to-generate-code"><i class="fa fa-check"></i><b>19.6.1</b> Map-reduce to generate code</a></li>
<li class="chapter" data-level="19.6.2" data-path="quasiquotation.html"><a href="quasiquotation.html#partition"><i class="fa fa-check"></i><b>19.6.2</b> Partition</a></li>
<li class="chapter" data-level="19.6.3" data-path="quasiquotation.html"><a href="quasiquotation.html#slicing-an-array"><i class="fa fa-check"></i><b>19.6.3</b> Slicing an array</a></li>
<li class="chapter" data-level="19.6.4" data-path="quasiquotation.html"><a href="quasiquotation.html#quasi-function"><i class="fa fa-check"></i><b>19.6.4</b> Creating functions</a></li>
<li class="chapter" data-level="19.6.5" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-60"><i class="fa fa-check"></i><b>19.6.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.7" data-path="quasiquotation.html"><a href="quasiquotation.html#dot-dot-dot-..."><i class="fa fa-check"></i><b>19.7</b> Dot-dot-dot (<code>...</code>)</a><ul>
<li class="chapter" data-level="19.7.1" data-path="quasiquotation.html"><a href="quasiquotation.html#do.call"><i class="fa fa-check"></i><b>19.7.1</b> <code>do.call()</code></a></li>
<li class="chapter" data-level="19.7.2" data-path="quasiquotation.html"><a href="quasiquotation.html#the-tidyverse-approach"><i class="fa fa-check"></i><b>19.7.2</b> The tidyverse approach</a></li>
<li class="chapter" data-level="19.7.3" data-path="quasiquotation.html"><a href="quasiquotation.html#list2"><i class="fa fa-check"></i><b>19.7.3</b> <code>list2()</code></a></li>
<li class="chapter" data-level="19.7.4" data-path="quasiquotation.html"><a href="quasiquotation.html#application-invoke-and-lang"><i class="fa fa-check"></i><b>19.7.4</b> Application: <code>invoke()</code> and <code>lang()</code></a></li>
<li class="chapter" data-level="19.7.5" data-path="quasiquotation.html"><a href="quasiquotation.html#other-approaches"><i class="fa fa-check"></i><b>19.7.5</b> Other approaches</a></li>
<li class="chapter" data-level="19.7.6" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-61"><i class="fa fa-check"></i><b>19.7.6</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="evaluation.html"><a href="evaluation.html"><i class="fa fa-check"></i><b>20</b> Evaluation</a><ul>
<li class="chapter" data-level="20.1" data-path="evaluation.html"><a href="evaluation.html#introduction-17"><i class="fa fa-check"></i><b>20.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="evaluation.html"><a href="evaluation.html#outline-15"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="evaluation.html"><a href="evaluation.html#prerequisites-10"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="20.2" data-path="evaluation.html"><a href="evaluation.html#evaluation-basics"><i class="fa fa-check"></i><b>20.2</b> Evaluation basics</a><ul>
<li class="chapter" data-level="20.2.1" data-path="evaluation.html"><a href="evaluation.html#application-local"><i class="fa fa-check"></i><b>20.2.1</b> Application: <code>local()</code></a></li>
<li class="chapter" data-level="20.2.2" data-path="evaluation.html"><a href="evaluation.html#application-source"><i class="fa fa-check"></i><b>20.2.2</b> Application: <code>source()</code></a></li>
<li class="chapter" data-level="20.2.3" data-path="evaluation.html"><a href="evaluation.html#gotcha-function"><i class="fa fa-check"></i><b>20.2.3</b> Gotcha: <code>function()</code></a></li>
<li class="chapter" data-level="20.2.4" data-path="evaluation.html"><a href="evaluation.html#eval-frame"><i class="fa fa-check"></i><b>20.2.4</b> Advanced: environments vs. frames</a></li>
<li class="chapter" data-level="20.2.5" data-path="evaluation.html"><a href="evaluation.html#base-r"><i class="fa fa-check"></i><b>20.2.5</b> Base R</a></li>
<li class="chapter" data-level="20.2.6" data-path="evaluation.html"><a href="evaluation.html#exercises-62"><i class="fa fa-check"></i><b>20.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="evaluation.html"><a href="evaluation.html#quosures"><i class="fa fa-check"></i><b>20.3</b> Quosures</a><ul>
<li class="chapter" data-level="20.3.1" data-path="evaluation.html"><a href="evaluation.html#motivation-2"><i class="fa fa-check"></i><b>20.3.1</b> Motivation</a></li>
<li class="chapter" data-level="20.3.2" data-path="evaluation.html"><a href="evaluation.html#creating-and-manipulating"><i class="fa fa-check"></i><b>20.3.2</b> Creating and manipulating</a></li>
<li class="chapter" data-level="20.3.3" data-path="evaluation.html"><a href="evaluation.html#evaluating"><i class="fa fa-check"></i><b>20.3.3</b> Evaluating</a></li>
<li class="chapter" data-level="20.3.4" data-path="evaluation.html"><a href="evaluation.html#implementation"><i class="fa fa-check"></i><b>20.3.4</b> Implementation</a></li>
<li class="chapter" data-level="20.3.5" data-path="evaluation.html"><a href="evaluation.html#when-not-to-use-quosures"><i class="fa fa-check"></i><b>20.3.5</b> When not to use quosures</a></li>
<li class="chapter" data-level="20.3.6" data-path="evaluation.html"><a href="evaluation.html#exercises-63"><i class="fa fa-check"></i><b>20.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="evaluation.html"><a href="evaluation.html#tidy-evaluation"><i class="fa fa-check"></i><b>20.4</b> Tidy evaluation</a><ul>
<li class="chapter" data-level="20.4.1" data-path="evaluation.html"><a href="evaluation.html#data-masks"><i class="fa fa-check"></i><b>20.4.1</b> Data masks</a></li>
<li class="chapter" data-level="20.4.2" data-path="evaluation.html"><a href="evaluation.html#subset"><i class="fa fa-check"></i><b>20.4.2</b> Application: <code>subset()</code></a></li>
<li class="chapter" data-level="20.4.3" data-path="evaluation.html"><a href="evaluation.html#application-arrange"><i class="fa fa-check"></i><b>20.4.3</b> Application: <code>arrange()</code></a></li>
<li class="chapter" data-level="20.4.4" data-path="evaluation.html"><a href="evaluation.html#ambiguity-and-pronouns"><i class="fa fa-check"></i><b>20.4.4</b> Ambiguity and pronouns</a></li>
<li class="chapter" data-level="20.4.5" data-path="evaluation.html"><a href="evaluation.html#base-subset"><i class="fa fa-check"></i><b>20.4.5</b> Base <code>subset()</code></a></li>
<li class="chapter" data-level="20.4.6" data-path="evaluation.html"><a href="evaluation.html#tidy-eval-performance"><i class="fa fa-check"></i><b>20.4.6</b> Performance</a></li>
<li class="chapter" data-level="20.4.7" data-path="evaluation.html"><a href="evaluation.html#exercises-64"><i class="fa fa-check"></i><b>20.4.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.5" data-path="evaluation.html"><a href="evaluation.html#wrapping-quoting-functions"><i class="fa fa-check"></i><b>20.5</b> Wrapping quoting functions</a><ul>
<li class="chapter" data-level="20.5.1" data-path="evaluation.html"><a href="evaluation.html#tidy-evaluation-1"><i class="fa fa-check"></i><b>20.5.1</b> Tidy evaluation</a></li>
<li class="chapter" data-level="20.5.2" data-path="evaluation.html"><a href="evaluation.html#base-r-1"><i class="fa fa-check"></i><b>20.5.2</b> Base R</a></li>
<li class="chapter" data-level="20.5.3" data-path="evaluation.html"><a href="evaluation.html#the-evaluation-environment"><i class="fa fa-check"></i><b>20.5.3</b> The evaluation environment</a></li>
<li class="chapter" data-level="20.5.4" data-path="evaluation.html"><a href="evaluation.html#making-formulas"><i class="fa fa-check"></i><b>20.5.4</b> Making formulas</a></li>
<li class="chapter" data-level="20.5.5" data-path="evaluation.html"><a href="evaluation.html#exercises-65"><i class="fa fa-check"></i><b>20.5.5</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="21" data-path="translation.html"><a href="translation.html"><i class="fa fa-check"></i><b>21</b> Translating R code</a><ul>
<li class="chapter" data-level="21.1" data-path="translation.html"><a href="translation.html#introduction-18"><i class="fa fa-check"></i><b>21.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="translation.html"><a href="translation.html#outline-16"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="translation.html"><a href="translation.html#prequisites-1"><i class="fa fa-check"></i>Prequisites</a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="translation.html"><a href="translation.html#html"><i class="fa fa-check"></i><b>21.2</b> HTML</a><ul>
<li class="chapter" data-level="21.2.1" data-path="translation.html"><a href="translation.html#goal"><i class="fa fa-check"></i><b>21.2.1</b> Goal</a></li>
<li class="chapter" data-level="21.2.2" data-path="translation.html"><a href="translation.html#escaping"><i class="fa fa-check"></i><b>21.2.2</b> Escaping</a></li>
<li class="chapter" data-level="21.2.3" data-path="translation.html"><a href="translation.html#basic-tag-functions"><i class="fa fa-check"></i><b>21.2.3</b> Basic tag functions</a></li>
<li class="chapter" data-level="21.2.4" data-path="translation.html"><a href="translation.html#tag-functions"><i class="fa fa-check"></i><b>21.2.4</b> Tag functions</a></li>
<li class="chapter" data-level="21.2.5" data-path="translation.html"><a href="translation.html#processing-all-tags"><i class="fa fa-check"></i><b>21.2.5</b> Processing all tags</a></li>
<li class="chapter" data-level="21.2.6" data-path="translation.html"><a href="translation.html#exercises-66"><i class="fa fa-check"></i><b>21.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="21.3" data-path="translation.html"><a href="translation.html#latex"><i class="fa fa-check"></i><b>21.3</b> LaTeX</a><ul>
<li class="chapter" data-level="21.3.1" data-path="translation.html"><a href="translation.html#latex-mathematics"><i class="fa fa-check"></i><b>21.3.1</b> LaTeX mathematics</a></li>
<li class="chapter" data-level="21.3.2" data-path="translation.html"><a href="translation.html#goal-1"><i class="fa fa-check"></i><b>21.3.2</b> Goal</a></li>
<li class="chapter" data-level="21.3.3" data-path="translation.html"><a href="translation.html#to_math"><i class="fa fa-check"></i><b>21.3.3</b> <code>to_math</code></a></li>
<li class="chapter" data-level="21.3.4" data-path="translation.html"><a href="translation.html#known-symbols"><i class="fa fa-check"></i><b>21.3.4</b> Known symbols</a></li>
<li class="chapter" data-level="21.3.5" data-path="translation.html"><a href="translation.html#unknown-symbols"><i class="fa fa-check"></i><b>21.3.5</b> Unknown symbols</a></li>
<li class="chapter" data-level="21.3.6" data-path="translation.html"><a href="translation.html#known-functions"><i class="fa fa-check"></i><b>21.3.6</b> Known functions</a></li>
<li class="chapter" data-level="21.3.7" data-path="translation.html"><a href="translation.html#unknown-functions"><i class="fa fa-check"></i><b>21.3.7</b> Unknown functions</a></li>
<li class="chapter" data-level="21.3.8" data-path="translation.html"><a href="translation.html#exercises-67"><i class="fa fa-check"></i><b>21.3.8</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Techniques</b></span></li>
<li class="chapter" data-level="22" data-path="debugging.html"><a href="debugging.html"><i class="fa fa-check"></i><b>22</b> Debugging</a><ul>
<li class="chapter" data-level="22.1" data-path="debugging.html"><a href="debugging.html#introduction-19"><i class="fa fa-check"></i><b>22.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="debugging.html"><a href="debugging.html#outline-17"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="22.2" data-path="debugging.html"><a href="debugging.html#debugging-techniques"><i class="fa fa-check"></i><b>22.2</b> Techniques</a></li>
<li class="chapter" data-level="22.3" data-path="debugging.html"><a href="debugging.html#debugging-tools"><i class="fa fa-check"></i><b>22.3</b> Tools</a><ul>
<li class="chapter" data-level="22.3.1" data-path="debugging.html"><a href="debugging.html#determining-the-sequence-of-calls"><i class="fa fa-check"></i><b>22.3.1</b> Determining the sequence of calls</a></li>
<li class="chapter" data-level="22.3.2" data-path="debugging.html"><a href="debugging.html#browsing-on-error"><i class="fa fa-check"></i><b>22.3.2</b> Browsing on error</a></li>
<li class="chapter" data-level="22.3.3" data-path="debugging.html"><a href="debugging.html#browsing-arbitrary-code"><i class="fa fa-check"></i><b>22.3.3</b> Browsing arbitrary code</a></li>
<li class="chapter" data-level="22.3.4" data-path="debugging.html"><a href="debugging.html#the-call-stack-traceback-where-and-recover"><i class="fa fa-check"></i><b>22.3.4</b> The call stack: <code>traceback()</code>, <code>where</code>, and <code>recover()</code></a></li>
<li class="chapter" data-level="22.3.5" data-path="debugging.html"><a href="debugging.html#other-types-of-failure"><i class="fa fa-check"></i><b>22.3.5</b> Other types of failure</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="23" data-path="performance.html"><a href="performance.html"><i class="fa fa-check"></i><b>23</b> Performance</a><ul>
<li class="chapter" data-level="23.1" data-path="performance.html"><a href="performance.html#why-is-r-slow"><i class="fa fa-check"></i><b>23.1</b> Why is R slow?</a></li>
<li class="chapter" data-level="23.2" data-path="performance.html"><a href="performance.html#microbenchmarking"><i class="fa fa-check"></i><b>23.2</b> Microbenchmarking</a><ul>
<li class="chapter" data-level="23.2.1" data-path="performance.html"><a href="performance.html#exercises-68"><i class="fa fa-check"></i><b>23.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="23.3" data-path="performance.html"><a href="performance.html#language-performance"><i class="fa fa-check"></i><b>23.3</b> Language performance</a><ul>
<li class="chapter" data-level="23.3.1" data-path="performance.html"><a href="performance.html#extreme-dynamism"><i class="fa fa-check"></i><b>23.3.1</b> Extreme dynamism</a></li>
<li class="chapter" data-level="23.3.2" data-path="performance.html"><a href="performance.html#name-lookup-with-mutable-environments"><i class="fa fa-check"></i><b>23.3.2</b> Name lookup with mutable environments</a></li>
<li class="chapter" data-level="23.3.3" data-path="performance.html"><a href="performance.html#lazy-evaluation-overhead"><i class="fa fa-check"></i><b>23.3.3</b> Lazy evaluation overhead</a></li>
<li class="chapter" data-level="23.3.4" data-path="performance.html"><a href="performance.html#exercises-69"><i class="fa fa-check"></i><b>23.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="23.4" data-path="performance.html"><a href="performance.html#implementation-performance"><i class="fa fa-check"></i><b>23.4</b> Implementation performance</a><ul>
<li class="chapter" data-level="23.4.1" data-path="performance.html"><a href="performance.html#extracting-a-single-value-from-a-data-frame"><i class="fa fa-check"></i><b>23.4.1</b> Extracting a single value from a data frame</a></li>
<li class="chapter" data-level="23.4.2" data-path="performance.html"><a href="performance.html#ifelse-pmin-and-pmax"><i class="fa fa-check"></i><b>23.4.2</b> <code>ifelse()</code>, <code>pmin()</code>, and <code>pmax()</code></a></li>
<li class="chapter" data-level="23.4.3" data-path="performance.html"><a href="performance.html#exercises-70"><i class="fa fa-check"></i><b>23.4.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="23.5" data-path="performance.html"><a href="performance.html#faster-r"><i class="fa fa-check"></i><b>23.5</b> Alternative R implementations</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="profiling.html"><a href="profiling.html"><i class="fa fa-check"></i><b>24</b> Optimising code</a><ul>
<li class="chapter" data-level="24.1" data-path="profiling.html"><a href="profiling.html#introduction-20"><i class="fa fa-check"></i><b>24.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="profiling.html"><a href="profiling.html#outline-18"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="profiling.html"><a href="profiling.html#prerequisites-11"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="24.2" data-path="profiling.html"><a href="profiling.html#measure-perf"><i class="fa fa-check"></i><b>24.2</b> Measuring performance</a><ul>
<li class="chapter" data-level="24.2.1" data-path="profiling.html"><a href="profiling.html#limitations"><i class="fa fa-check"></i><b>24.2.1</b> Limitations</a></li>
</ul></li>
<li class="chapter" data-level="24.3" data-path="profiling.html"><a href="profiling.html#memory-profiling"><i class="fa fa-check"></i><b>24.3</b> Memory profiling with lineprof</a><ul>
<li class="chapter" data-level="24.3.1" data-path="profiling.html"><a href="profiling.html#exercises-71"><i class="fa fa-check"></i><b>24.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.4" data-path="profiling.html"><a href="profiling.html#improve-perf"><i class="fa fa-check"></i><b>24.4</b> Improving performance</a></li>
<li class="chapter" data-level="24.5" data-path="profiling.html"><a href="profiling.html#code-organisation"><i class="fa fa-check"></i><b>24.5</b> Code organisation</a></li>
<li class="chapter" data-level="24.6" data-path="profiling.html"><a href="profiling.html#already-solved"><i class="fa fa-check"></i><b>24.6</b> Has someone already solved the problem?</a><ul>
<li class="chapter" data-level="24.6.1" data-path="profiling.html"><a href="profiling.html#exercises-72"><i class="fa fa-check"></i><b>24.6.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.7" data-path="profiling.html"><a href="profiling.html#be-lazy"><i class="fa fa-check"></i><b>24.7</b> Do as little as possible</a><ul>
<li class="chapter" data-level="24.7.1" data-path="profiling.html"><a href="profiling.html#exercises-73"><i class="fa fa-check"></i><b>24.7.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.8" data-path="profiling.html"><a href="profiling.html#vectorise"><i class="fa fa-check"></i><b>24.8</b> Vectorise</a><ul>
<li class="chapter" data-level="24.8.1" data-path="profiling.html"><a href="profiling.html#exercises-74"><i class="fa fa-check"></i><b>24.8.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.9" data-path="profiling.html"><a href="profiling.html#avoid-copies"><i class="fa fa-check"></i><b>24.9</b> Avoid copies</a></li>
<li class="chapter" data-level="24.10" data-path="profiling.html"><a href="profiling.html#byte-code"><i class="fa fa-check"></i><b>24.10</b> Byte code compilation</a></li>
<li class="chapter" data-level="24.11" data-path="profiling.html"><a href="profiling.html#t-test"><i class="fa fa-check"></i><b>24.11</b> Case study: t-test</a></li>
<li class="chapter" data-level="24.12" data-path="profiling.html"><a href="profiling.html#parallelise"><i class="fa fa-check"></i><b>24.12</b> Parallelise</a></li>
<li class="chapter" data-level="24.13" data-path="profiling.html"><a href="profiling.html#more-techniques"><i class="fa fa-check"></i><b>24.13</b> Other techniques</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="rcpp.html"><a href="rcpp.html"><i class="fa fa-check"></i><b>25</b> Rewriting R code in C++</a><ul>
<li class="chapter" data-level="25.1" data-path="rcpp.html"><a href="rcpp.html#introduction-21"><i class="fa fa-check"></i><b>25.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="rcpp.html"><a href="rcpp.html#outline-19"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="rcpp.html"><a href="rcpp.html#prerequistes"><i class="fa fa-check"></i>Prerequistes</a></li>
</ul></li>
<li class="chapter" data-level="25.2" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro"><i class="fa fa-check"></i><b>25.2</b> Getting started with C++</a><ul>
<li class="chapter" data-level="25.2.1" data-path="rcpp.html"><a href="rcpp.html#no-inputs-scalar-output"><i class="fa fa-check"></i><b>25.2.1</b> No inputs, scalar output</a></li>
<li class="chapter" data-level="25.2.2" data-path="rcpp.html"><a href="rcpp.html#scalar-input-scalar-output"><i class="fa fa-check"></i><b>25.2.2</b> Scalar input, scalar output</a></li>
<li class="chapter" data-level="25.2.3" data-path="rcpp.html"><a href="rcpp.html#vector-input-scalar-output"><i class="fa fa-check"></i><b>25.2.3</b> Vector input, scalar output</a></li>
<li class="chapter" data-level="25.2.4" data-path="rcpp.html"><a href="rcpp.html#vector-input-vector-output"><i class="fa fa-check"></i><b>25.2.4</b> Vector input, vector output</a></li>
<li class="chapter" data-level="25.2.5" data-path="rcpp.html"><a href="rcpp.html#matrix-input-vector-output"><i class="fa fa-check"></i><b>25.2.5</b> Matrix input, vector output</a></li>
<li class="chapter" data-level="25.2.6" data-path="rcpp.html"><a href="rcpp.html#sourceCpp"><i class="fa fa-check"></i><b>25.2.6</b> Using sourceCpp</a></li>
<li class="chapter" data-level="25.2.7" data-path="rcpp.html"><a href="rcpp.html#exercises-75"><i class="fa fa-check"></i><b>25.2.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.3" data-path="rcpp.html"><a href="rcpp.html#rcpp-classes"><i class="fa fa-check"></i><b>25.3</b> Attributes and other classes</a><ul>
<li class="chapter" data-level="25.3.1" data-path="rcpp.html"><a href="rcpp.html#lists-and-data-frames"><i class="fa fa-check"></i><b>25.3.1</b> Lists and data frames</a></li>
<li class="chapter" data-level="25.3.2" data-path="rcpp.html"><a href="rcpp.html#functions-rcpp"><i class="fa fa-check"></i><b>25.3.2</b> Functions</a></li>
<li class="chapter" data-level="25.3.3" data-path="rcpp.html"><a href="rcpp.html#other-types"><i class="fa fa-check"></i><b>25.3.3</b> Other types</a></li>
</ul></li>
<li class="chapter" data-level="25.4" data-path="rcpp.html"><a href="rcpp.html#rcpp-na"><i class="fa fa-check"></i><b>25.4</b> Missing values</a><ul>
<li class="chapter" data-level="25.4.1" data-path="rcpp.html"><a href="rcpp.html#scalars-1"><i class="fa fa-check"></i><b>25.4.1</b> Scalars</a></li>
<li class="chapter" data-level="25.4.2" data-path="rcpp.html"><a href="rcpp.html#strings"><i class="fa fa-check"></i><b>25.4.2</b> Strings</a></li>
<li class="chapter" data-level="25.4.3" data-path="rcpp.html"><a href="rcpp.html#boolean"><i class="fa fa-check"></i><b>25.4.3</b> Boolean</a></li>
<li class="chapter" data-level="25.4.4" data-path="rcpp.html"><a href="rcpp.html#vectors-rcpp"><i class="fa fa-check"></i><b>25.4.4</b> Vectors</a></li>
<li class="chapter" data-level="25.4.5" data-path="rcpp.html"><a href="rcpp.html#exercises-76"><i class="fa fa-check"></i><b>25.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.5" data-path="rcpp.html"><a href="rcpp.html#rcpp-sugar"><i class="fa fa-check"></i><b>25.5</b> Rcpp sugar</a><ul>
<li class="chapter" data-level="25.5.1" data-path="rcpp.html"><a href="rcpp.html#arithmetic-and-logical-operators"><i class="fa fa-check"></i><b>25.5.1</b> Arithmetic and logical operators</a></li>
<li class="chapter" data-level="25.5.2" data-path="rcpp.html"><a href="rcpp.html#logical-summary-functions"><i class="fa fa-check"></i><b>25.5.2</b> Logical summary functions</a></li>
<li class="chapter" data-level="25.5.3" data-path="rcpp.html"><a href="rcpp.html#vector-views"><i class="fa fa-check"></i><b>25.5.3</b> Vector views</a></li>
<li class="chapter" data-level="25.5.4" data-path="rcpp.html"><a href="rcpp.html#other-useful-functions"><i class="fa fa-check"></i><b>25.5.4</b> Other useful functions</a></li>
</ul></li>
<li class="chapter" data-level="25.6" data-path="rcpp.html"><a href="rcpp.html#stl"><i class="fa fa-check"></i><b>25.6</b> The STL</a><ul>
<li class="chapter" data-level="25.6.1" data-path="rcpp.html"><a href="rcpp.html#using-iterators"><i class="fa fa-check"></i><b>25.6.1</b> Using iterators</a></li>
<li class="chapter" data-level="25.6.2" data-path="rcpp.html"><a href="rcpp.html#algorithms"><i class="fa fa-check"></i><b>25.6.2</b> Algorithms</a></li>
<li class="chapter" data-level="25.6.3" data-path="rcpp.html"><a href="rcpp.html#data-structures-rcpp"><i class="fa fa-check"></i><b>25.6.3</b> Data structures</a></li>
<li class="chapter" data-level="25.6.4" data-path="rcpp.html"><a href="rcpp.html#vectors-stl"><i class="fa fa-check"></i><b>25.6.4</b> Vectors</a></li>
<li class="chapter" data-level="25.6.5" data-path="rcpp.html"><a href="rcpp.html#sets"><i class="fa fa-check"></i><b>25.6.5</b> Sets</a></li>
<li class="chapter" data-level="25.6.6" data-path="rcpp.html"><a href="rcpp.html#map-1"><i class="fa fa-check"></i><b>25.6.6</b> Map</a></li>
<li class="chapter" data-level="25.6.7" data-path="rcpp.html"><a href="rcpp.html#exercises-77"><i class="fa fa-check"></i><b>25.6.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.7" data-path="rcpp.html"><a href="rcpp.html#rcpp-case-studies"><i class="fa fa-check"></i><b>25.7</b> Case studies</a><ul>
<li class="chapter" data-level="25.7.1" data-path="rcpp.html"><a href="rcpp.html#gibbs-sampler"><i class="fa fa-check"></i><b>25.7.1</b> Gibbs sampler</a></li>
<li class="chapter" data-level="25.7.2" data-path="rcpp.html"><a href="rcpp.html#r-vectorisation-vs.c-vectorisation"><i class="fa fa-check"></i><b>25.7.2</b> R vectorisation vs. C++ vectorisation</a></li>
</ul></li>
<li class="chapter" data-level="25.8" data-path="rcpp.html"><a href="rcpp.html#rcpp-package"><i class="fa fa-check"></i><b>25.8</b> Using Rcpp in a package</a></li>
<li class="chapter" data-level="25.9" data-path="rcpp.html"><a href="rcpp.html#rcpp-more"><i class="fa fa-check"></i><b>25.9</b> Learning more</a></li>
<li class="chapter" data-level="25.10" data-path="rcpp.html"><a href="rcpp.html#acknowledgments"><i class="fa fa-check"></i><b>25.10</b> Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="quasiquotation" class="section level1">
<h1><span class="header-section-number">19</span> Quasiquotation</h1>
<div id="introduction-16" class="section level2">
<h2><span class="header-section-number">19.1</span> Introduction</h2>
<p>Now that you understand the tree structure of R code, it’s time to come back to one of the fundamental ideas that make <code>expr()</code> and <code>ast()</code> work: <strong>quasiquotation</strong>. There are two sides to quasiquotation:</p>
<ul>
<li><p><strong>Quotation</strong> allows you to capture the AST associated with an argument.
As a function author, this gives you a lot of power to influence how
expressions are evaluated.</p></li>
<li><p><strong>Unquotation</strong> allows you to selectively evaluate parts of a quoted
expression. This is a powerful tool that makes it easy to build up a
complex AST from simpler fragments.</p></li>
</ul>
<p>The combination of these two ideas makes it easy to compose expressions that are mixtures of direct and indirect specification, and helps to solve a wide variety of challenging problems.</p>
<p>Quoting functions have deep connections to Lisp <strong>macros</strong>. But macros are usually run at compile-time, which doesn’t have any meaning in R, and they always input and output ASTs. (<span class="citation">Lumley (<a href="#ref-lumley-2001">2001</a>)</span> shows one way you might implement them in R). Quoting functions are more closely related to Lisp <a href="http://en.wikipedia.org/wiki/Fexpr"><strong>fexprs</strong></a>, functions where all arguments are quoted by default. These terms are useful to know when looking for related techniques in other programming languages.  </p>
<div id="outline-14" class="section level3 unnumbered">
<h3>Outline</h3>
</div>
<div id="prerequisites-9" class="section level3 unnumbered">
<h3>Prerequisites</h3>
<p>Make sure you’re familiar with the tree structure of code described in <a href="expressions.html#abstract-syntax-trees">Abstract syntax trees</a>.</p>
<p>You’ll also need the development version of rlang:</p>
<div class="sourceCode" id="cb725"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb725-1" data-line-number="1"><span class="cf">if</span> (<span class="kw">packageVersion</span>(<span class="st">&quot;rlang&quot;</span>) <span class="op">&lt;</span><span class="st"> &quot;0.2.0&quot;</span>) {</a>
<a class="sourceLine" id="cb725-2" data-line-number="2">  <span class="kw">stop</span>(<span class="st">&quot;This chapter requires rlang 0.2.0&quot;</span>, <span class="dt">call. =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb725-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb725-4" data-line-number="4"><span class="kw">library</span>(rlang)</a></code></pre></div>
</div>
</div>
<div id="motivation-1" class="section level2">
<h2><span class="header-section-number">19.2</span> Motivation</h2>
<p>We’ll start with a simple and concrete example that helps motivate the need for unquoting, and hence quasiquotation. Imagine you’re creating a lot of strings by joining together words:</p>
<div class="sourceCode" id="cb726"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb726-1" data-line-number="1"><span class="kw">paste</span>(<span class="st">&quot;Good&quot;</span>, <span class="st">&quot;morning&quot;</span>, <span class="st">&quot;Hadley&quot;</span>)</a>
<a class="sourceLine" id="cb726-2" data-line-number="2"><span class="co">#&gt; [1] &quot;Good morning Hadley&quot;</span></a>
<a class="sourceLine" id="cb726-3" data-line-number="3"><span class="kw">paste</span>(<span class="st">&quot;Good&quot;</span>, <span class="st">&quot;afternoon&quot;</span>, <span class="st">&quot;Alice&quot;</span>)</a>
<a class="sourceLine" id="cb726-4" data-line-number="4"><span class="co">#&gt; [1] &quot;Good afternoon Alice&quot;</span></a></code></pre></div>
<p>You are sick and tired of writing all those quotes, and instead you just want to use bare words. To that end, you’ve managed to write the following function:</p>
<div class="sourceCode" id="cb727"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb727-1" data-line-number="1">cement &lt;-<span class="st"> </span><span class="cf">function</span>(...) {</a>
<a class="sourceLine" id="cb727-2" data-line-number="2">  dots &lt;-<span class="st"> </span><span class="kw">exprs</span>(...)</a>
<a class="sourceLine" id="cb727-3" data-line-number="3">  <span class="kw">paste</span>(purrr<span class="op">::</span><span class="kw">map</span>(dots, expr_name), <span class="dt">collapse =</span> <span class="st">&quot; &quot;</span>)</a>
<a class="sourceLine" id="cb727-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb727-5" data-line-number="5"></a>
<a class="sourceLine" id="cb727-6" data-line-number="6"><span class="kw">cement</span>(Good, morning, Hadley)</a>
<a class="sourceLine" id="cb727-7" data-line-number="7"><span class="co">#&gt; [1] &quot;Good morning Hadley&quot;</span></a>
<a class="sourceLine" id="cb727-8" data-line-number="8"><span class="kw">cement</span>(Good, afternoon, Alice)</a>
<a class="sourceLine" id="cb727-9" data-line-number="9"><span class="co">#&gt; [1] &quot;Good afternoon Alice&quot;</span></a></code></pre></div>
<p>(You’ll learn what <code>exprs()</code> does shortly; for now just look at the results.)</p>
<p>Formally, this function <strong>quotes</strong> the arguments in <code>...</code>. You can think of it as automatically putting quotation marks around each argument. That’s not precisely true as the intermediate objects it generates are expressions, not strings, but it’s a useful approximation for now.</p>
<p>This function is nice because we no longer need to type quotes. The problem, however, comes when we want to use variables. It’s easy to use variables with <code>paste()</code> as we just don’t surround them with quotes:</p>
<div class="sourceCode" id="cb728"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb728-1" data-line-number="1">name &lt;-<span class="st"> &quot;Hadley&quot;</span></a>
<a class="sourceLine" id="cb728-2" data-line-number="2">time &lt;-<span class="st"> &quot;morning&quot;</span></a>
<a class="sourceLine" id="cb728-3" data-line-number="3"></a>
<a class="sourceLine" id="cb728-4" data-line-number="4"><span class="kw">paste</span>(<span class="st">&quot;Good&quot;</span>, time, name)</a>
<a class="sourceLine" id="cb728-5" data-line-number="5"><span class="co">#&gt; [1] &quot;Good morning Hadley&quot;</span></a></code></pre></div>
<p>Obviously this doesn’t work with <code>cement()</code> because every input is automatically quoted:</p>
<div class="sourceCode" id="cb729"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb729-1" data-line-number="1"><span class="kw">cement</span>(Good, time, name)</a>
<a class="sourceLine" id="cb729-2" data-line-number="2"><span class="co">#&gt; [1] &quot;Good time name&quot;</span></a></code></pre></div>
<p>We need some way to explicitly <strong>unquote</strong> the input, to tell <code>cement()</code> to remove the automatic quote marks. Here we need <code>time</code> and <code>name</code> to be treated differently to <code>Good</code>. Quasiquotation give us a standard tool to do so: <code>!!</code>, called “unquote”, and pronounced bang-bang. <code>!!</code> tells a quoting function to drop the implicit quotes:</p>
<div class="sourceCode" id="cb730"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb730-1" data-line-number="1"><span class="kw">cement</span>(Good, <span class="op">!!</span>time, <span class="op">!!</span>name)</a>
<a class="sourceLine" id="cb730-2" data-line-number="2"><span class="co">#&gt; [1] &quot;Good morning Hadley&quot;</span></a></code></pre></div>
<p>It’s useful to compare <code>cement()</code> and <code>paste()</code> directly. <code>paste()</code> evaluates its arguments, so we need to quote where needed; <code>cement()</code> quotes its arguments, so we need to unquote where needed.</p>
<div class="sourceCode" id="cb731"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb731-1" data-line-number="1"><span class="kw">paste</span>(<span class="st">&quot;Good&quot;</span>, time, name)</a>
<a class="sourceLine" id="cb731-2" data-line-number="2"><span class="kw">cement</span>(Good, <span class="op">!!</span>time, <span class="op">!!</span>name)</a></code></pre></div>
<div id="vocabulary" class="section level3">
<h3><span class="header-section-number">19.2.1</span> Vocabulary</h3>
<p>The distinction between quoted and evaluated arguments is important:</p>
<ul>
<li><p>An <strong>evaluated</strong> argument obeys R’s usual evaluation rules.</p></li>
<li><p>A <strong>quoted</strong> argument is captured by the function and something unusual
will happen.</p></li>
</ul>
<p>If you’re even unsure about whether an argument is quoted or evaluated, try executing the code outside of the function. If it doesn’t work, then that argument is quoted. For example, you can use this technique to determine that the first argument to <code>library()</code> is quoted:</p>
<div class="sourceCode" id="cb732"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb732-1" data-line-number="1"><span class="co"># works</span></a>
<a class="sourceLine" id="cb732-2" data-line-number="2"><span class="kw">library</span>(MASS)</a>
<a class="sourceLine" id="cb732-3" data-line-number="3"></a>
<a class="sourceLine" id="cb732-4" data-line-number="4"><span class="co"># fails</span></a>
<a class="sourceLine" id="cb732-5" data-line-number="5">MASS</a>
<a class="sourceLine" id="cb732-6" data-line-number="6"><span class="co">#&gt; Error in eval(expr, envir, enclos):</span></a>
<a class="sourceLine" id="cb732-7" data-line-number="7"><span class="co">#&gt;   object &#39;MASS&#39; not found</span></a></code></pre></div>
<p>Talking about whether an argument is quoted or evaluated is a more precise way of stating whether or not a function uses NSE. I will sometimes use “quoting function” as short-hand for a “function that quotes one or more arguments”, but generally, I’ll refer to quoted arguments since that is the level at which the difference occurs.</p>
</div>
<div id="theory" class="section level3">
<h3><span class="header-section-number">19.2.2</span> Theory</h3>
<p>Now that you’ve seen the basic idea, it’s time to talk a little bit about the theory. The idea of quasiquotation is an old one. It was first developed by a philosopher, Willard van Orman Quine<a href="#fn40" class="footnote-ref" id="fnref40"><sup>40</sup></a>, in the early 1940s. It’s needed in philosophy because it helps when precisely delineating the use and mention of words, i.e. between the object and the words we use to refer to that object.</p>
<p>Quasiquotation was first used in a programming language, LISP, in the mid-1970s <span class="citation">(Bawden <a href="#ref-bawden-1999">1999</a>)</span>. LISP has one quoting function <code>`</code>, and uses <code>,</code> for unquoting. Most languages with a LISP heritage behave similarly. For example, racket (<code>`</code> and <code>@</code>), clojure (<code>`</code> and <code>~</code>), and julia (<code>:</code> and <code>@</code>) all have quasiquotation tools that differ only slightly from LISP.</p>
<p>Quasiquotation has only come to R recently (2017). Despite its newness, I teach it in this book because it is a rich and powerful theory that makes many hard problems much easier. Quasiquotation in R is a little different to LISP and descendants. In LISP there is only one function that does quasiquotation (the quote function), and you must call it explicitly when needed. This makes these languages less ambiguous (because there’s a clear code signal that something odd is happening), but is less appropriate for R because quasiquotation is such an important part of DSLs for data analysis.</p>
</div>
<div id="exercises-57" class="section level3">
<h3><span class="header-section-number">19.2.3</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>For each function in the following base R code, identify which arguments
are quoted and which are evaluated.</p>
<div class="sourceCode" id="cb733"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb733-1" data-line-number="1"><span class="kw">library</span>(MASS)</a>
<a class="sourceLine" id="cb733-2" data-line-number="2"></a>
<a class="sourceLine" id="cb733-3" data-line-number="3">mtcars2 &lt;-<span class="st"> </span><span class="kw">subset</span>(mtcars, cyl <span class="op">==</span><span class="st"> </span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb733-4" data-line-number="4"></a>
<a class="sourceLine" id="cb733-5" data-line-number="5"><span class="kw">with</span>(mtcars2, <span class="kw">sum</span>(vs))</a>
<a class="sourceLine" id="cb733-6" data-line-number="6"><span class="kw">sum</span>(mtcars2<span class="op">$</span>am)</a>
<a class="sourceLine" id="cb733-7" data-line-number="7"></a>
<a class="sourceLine" id="cb733-8" data-line-number="8"><span class="kw">rm</span>(mtcars2)</a></code></pre></div></li>
<li><p>For each function in the following tidyverse code, identify which arguments
are quoted and which are evaluated.</p>
<div class="sourceCode" id="cb734"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb734-1" data-line-number="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb734-2" data-line-number="2"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb734-3" data-line-number="3"></a>
<a class="sourceLine" id="cb734-4" data-line-number="4">by_cyl &lt;-<span class="st"> </span>mtcars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb734-5" data-line-number="5"><span class="st">  </span><span class="kw">group_by</span>(cyl) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb734-6" data-line-number="6"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(mpg))</a>
<a class="sourceLine" id="cb734-7" data-line-number="7"></a>
<a class="sourceLine" id="cb734-8" data-line-number="8"><span class="kw">ggplot</span>(by_cyl, <span class="kw">aes</span>(cyl, mean)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a></code></pre></div></li>
</ol>
</div>
</div>
<div id="quotation" class="section level2">
<h2><span class="header-section-number">19.3</span> Quotation</h2>
<p>The first part of quasiquotation is quotation: capturing an AST without evaluating it. There are two components to this: capturing an expression directly, and capturing an expression from a lazily-evaluated function argument. We’ll discuss two sets of tools for these two ways of capturing: those provided by rlang, and those provided by base R.</p>
<div id="with-rlang" class="section level3">
<h3><span class="header-section-number">19.3.1</span> With rlang</h3>
<p>There are four important quoting functions, broken down by whether they capture one or many expressions, and whether they capture the developer’s or user’s expression:</p>
<table>
<thead>
<tr class="header">
<th></th>
<th>Developer</th>
<th>User</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>One</td>
<td><code>expr()</code></td>
<td><code>enexpr()</code></td>
</tr>
<tr class="even">
<td>Many</td>
<td><code>exprs()</code></td>
<td><code>enexprs()</code></td>
</tr>
</tbody>
</table>
<p>For interactive exploration, the most important quoting function is <code>expr()</code>. It captures its argument exactly as provided:</p>
<div class="sourceCode" id="cb735"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb735-1" data-line-number="1"><span class="kw">expr</span>(x <span class="op">+</span><span class="st"> </span>y)</a>
<a class="sourceLine" id="cb735-2" data-line-number="2"><span class="co">#&gt; x + y</span></a>
<a class="sourceLine" id="cb735-3" data-line-number="3"><span class="kw">expr</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb735-4" data-line-number="4"><span class="co">#&gt; 1/2/3</span></a></code></pre></div>
<p>(Remember that white space and comments are not part of the AST, so will not be captured by a quoting function.)</p>
<p><code>expr()</code> is great for interactive exploration, because it captures what you, the developer, typed. It’s not useful inside a function:</p>
<div class="sourceCode" id="cb736"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb736-1" data-line-number="1">f1 &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">expr</span>(x)</a>
<a class="sourceLine" id="cb736-2" data-line-number="2"><span class="kw">f1</span>(a <span class="op">+</span><span class="st"> </span>b <span class="op">+</span><span class="st"> </span>c)</a>
<a class="sourceLine" id="cb736-3" data-line-number="3"><span class="co">#&gt; x</span></a></code></pre></div>
<p>Instead, we need another function: <code>enexpr()</code>. This captures what the user supplies to the function by looking at the internal promise object that powers lazy evaluation.</p>
<div class="sourceCode" id="cb737"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb737-1" data-line-number="1">f2 &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">enexpr</span>(x)</a>
<a class="sourceLine" id="cb737-2" data-line-number="2"><span class="kw">f2</span>(a <span class="op">+</span><span class="st"> </span>b <span class="op">+</span><span class="st"> </span>c)</a>
<a class="sourceLine" id="cb737-3" data-line-number="3"><span class="co">#&gt; a + b + c</span></a></code></pre></div>
<p>(Occasionaly you just want to capture symbols, and throw an error for other types of input. In that case you can use <code>ensym()</code>. In the next chapter, you’ll learn about <code>enquo()</code> which also captures the environment and is needed for tidy evaluation.)</p>
<p>To capture multiple arguments, use <code>enexprs()</code>:</p>
<div class="sourceCode" id="cb738"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb738-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>(...) <span class="kw">enexprs</span>(...)</a>
<a class="sourceLine" id="cb738-2" data-line-number="2"><span class="kw">f</span>(<span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">10</span> <span class="op">*</span><span class="st"> </span>z)</a>
<a class="sourceLine" id="cb738-3" data-line-number="3"><span class="co">#&gt; $x</span></a>
<a class="sourceLine" id="cb738-4" data-line-number="4"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb738-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb738-6" data-line-number="6"><span class="co">#&gt; $y</span></a>
<a class="sourceLine" id="cb738-7" data-line-number="7"><span class="co">#&gt; 10 * z</span></a></code></pre></div>
<p>Finally, <code>exprs()</code> is useful interactively to make a list of expressions:</p>
<div class="sourceCode" id="cb739"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb739-1" data-line-number="1"><span class="kw">exprs</span>(<span class="dt">x =</span> x <span class="op">^</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">y =</span> y <span class="op">^</span><span class="st"> </span><span class="dv">3</span>, <span class="dt">z =</span> z <span class="op">^</span><span class="st"> </span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb739-2" data-line-number="2"><span class="co">#&gt; $x</span></a>
<a class="sourceLine" id="cb739-3" data-line-number="3"><span class="co">#&gt; x^2</span></a>
<a class="sourceLine" id="cb739-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb739-5" data-line-number="5"><span class="co">#&gt; $y</span></a>
<a class="sourceLine" id="cb739-6" data-line-number="6"><span class="co">#&gt; y^3</span></a>
<a class="sourceLine" id="cb739-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb739-8" data-line-number="8"><span class="co">#&gt; $z</span></a>
<a class="sourceLine" id="cb739-9" data-line-number="9"><span class="co">#&gt; z^4</span></a>
<a class="sourceLine" id="cb739-10" data-line-number="10"><span class="co"># shorthand for</span></a>
<a class="sourceLine" id="cb739-11" data-line-number="11"><span class="co"># list(x = expr(x ^ 2), y = expr(y ^ 3), z = expr(z ^ 4))</span></a></code></pre></div>
<p>Note that it can return missing arguments:</p>
<div class="sourceCode" id="cb740"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb740-1" data-line-number="1">val &lt;-<span class="st"> </span><span class="kw">exprs</span>(<span class="dt">x =</span> )</a>
<a class="sourceLine" id="cb740-2" data-line-number="2"><span class="kw">is_missing</span>(val<span class="op">$</span>x)</a>
<a class="sourceLine" id="cb740-3" data-line-number="3"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
<p>There’s not much you can do with a list of expressions yet, but we’ll see a few techniques later in <a href="quasi-case-studies">case studies</a>: using purrr to work with lists of expressions turns out to be a surprisingly powerful tool.</p>
<p>Use <code>enexpr()</code> and <code>enexprs()</code> inside a function when you want to capture the expressions supplied as arguments <em>by the user</em> of that function. Use <code>expr()</code> and <code>exprs()</code> when you want to capture expressions that <em>you</em> supply.</p>
</div>
<div id="with-base-r" class="section level3">
<h3><span class="header-section-number">19.3.2</span> With base R</h3>
<p>The base equivalent of <code>expr()</code> is <code>quote()</code>:</p>
<div class="sourceCode" id="cb741"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb741-1" data-line-number="1"><span class="kw">quote</span>(x <span class="op">+</span><span class="st"> </span>y)</a>
<a class="sourceLine" id="cb741-2" data-line-number="2"><span class="co">#&gt; x + y</span></a>
<a class="sourceLine" id="cb741-3" data-line-number="3"><span class="kw">quote</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb741-4" data-line-number="4"><span class="co">#&gt; 1/2/3</span></a></code></pre></div>
<p>It is identical to <code>expr()</code> except that does not support unquoting, so it is a quoting function, not a quasiquoting function.</p>
<p>The base function closest to <code>enexpr()</code> is <code>substitute()</code>:</p>
<div class="sourceCode" id="cb742"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb742-1" data-line-number="1">f3 &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">substitute</span>(x)</a>
<a class="sourceLine" id="cb742-2" data-line-number="2"><span class="kw">f3</span>(x <span class="op">+</span><span class="st"> </span>y <span class="op">+</span><span class="st"> </span>z)</a>
<a class="sourceLine" id="cb742-3" data-line-number="3"><span class="co">#&gt; x + y + z</span></a></code></pre></div>
<p>You’ll most often see it used to capture unevaluated arguments; often in concert with <code>deparse()</code> to create labels for output. However, <code>substitute()</code> also does “substitution”: if you give it an expression, rather than a symbol, it will substitute in values of symbols defined in the current environment.</p>
<div class="sourceCode" id="cb743"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb743-1" data-line-number="1">f4 &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">substitute</span>(x <span class="op">*</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb743-2" data-line-number="2"><span class="kw">f4</span>(a <span class="op">+</span><span class="st"> </span>b <span class="op">+</span><span class="st"> </span>c)</a>
<a class="sourceLine" id="cb743-3" data-line-number="3"><span class="co">#&gt; (a + b + c) * 2</span></a></code></pre></div>
<p><code>substitute()</code> provides a sort of automatic unquoting for any symbol that is bound to a value. However, making use of this behaviour can make for hard to read code, because for example, taken out of context, you can’t tell if the goal of <code>substitute(x + y)</code> is to replace <code>x</code>, or, <code>y</code>, or both. If you do want to use <code>substitute()</code> in this way, I recommend that you use the 2nd argument to make it clear that is your goal:</p>
<div class="sourceCode" id="cb744"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb744-1" data-line-number="1"><span class="kw">substitute</span>(x <span class="op">*</span><span class="st"> </span>y <span class="op">*</span><span class="st"> </span>z, <span class="kw">list</span>(<span class="dt">x =</span> <span class="dv">10</span>, <span class="dt">y =</span> <span class="kw">quote</span>(a <span class="op">+</span><span class="st"> </span>b)))</a>
<a class="sourceLine" id="cb744-2" data-line-number="2"><span class="co">#&gt; 10 * (a + b) * z</span></a></code></pre></div>
<p>The base equivalent to <code>exprs()</code> is <code>alist()</code>:</p>
<div class="sourceCode" id="cb745"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb745-1" data-line-number="1"><span class="kw">alist</span>(<span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> x <span class="op">+</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb745-2" data-line-number="2"><span class="co">#&gt; $x</span></a>
<a class="sourceLine" id="cb745-3" data-line-number="3"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb745-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb745-5" data-line-number="5"><span class="co">#&gt; $y</span></a>
<a class="sourceLine" id="cb745-6" data-line-number="6"><span class="co">#&gt; x + 2</span></a></code></pre></div>
<p>There are two other important base quoting functions that we’ll cover elsewhere:</p>
<ul>
<li><p><code>bquote()</code> provides a limited form of quasiquotation, and is discussed in
<a href="quasiquotation.html#unquote-base">unquoting with base R</a>.</p></li>
<li><p><code>~</code>, the formula, is a quoting function that also captures the environment.
It’s the inspiration for quosures, the topic of the next chapter, and is
discussed in [formulas].</p></li>
</ul>
</div>
<div id="exercises-58" class="section level3">
<h3><span class="header-section-number">19.3.3</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>What happens if you try to use <code>enexpr()</code> with an expression?
What happens if you try to use <code>enexpr()</code> with a missing argument?</p></li>
<li><p>Compare and contrast the following two functions. Can you predict the
output before running them?</p>
<div class="sourceCode" id="cb746"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb746-1" data-line-number="1">f1 &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {</a>
<a class="sourceLine" id="cb746-2" data-line-number="2">  <span class="kw">exprs</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)</a>
<a class="sourceLine" id="cb746-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb746-4" data-line-number="4">f2 &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {</a>
<a class="sourceLine" id="cb746-5" data-line-number="5">  <span class="kw">enexprs</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)</a>
<a class="sourceLine" id="cb746-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb746-7" data-line-number="7"><span class="kw">f1</span>(a <span class="op">+</span><span class="st"> </span>b, c <span class="op">+</span><span class="st"> </span>d)</a>
<a class="sourceLine" id="cb746-8" data-line-number="8"><span class="kw">f2</span>(a <span class="op">+</span><span class="st"> </span>b, c <span class="op">+</span><span class="st"> </span>d)</a></code></pre></div></li>
<li><p>How are <code>exprs(a)</code> and <code>exprs(a = )</code> different? Think about both the
input and the output.</p></li>
<li><p>What does the following command return? What information is lost? Why?</p>
<div class="sourceCode" id="cb747"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb747-1" data-line-number="1"><span class="kw">expr</span>({</a>
<a class="sourceLine" id="cb747-2" data-line-number="2">  x <span class="op">+</span><span class="st">              </span>y <span class="co"># comment  </span></a>
<a class="sourceLine" id="cb747-3" data-line-number="3">})</a></code></pre></div></li>
<li><p>The documentation for <code>substitute()</code> says:</p>
<blockquote>
<p>Substitution takes place by examining each component of the parse tree
as follows: If it is not a bound symbol in env, it is unchanged. If it
is a promise object, i.e., a formal argument to a function or explicitly
created using delayedAssign(), the expression slot of the promise replaces
the symbol. If it is an ordinary variable, its value is substituted,
unless env is .GlobalEnv in which case the symbol is left unchanged.</p>
</blockquote>
<p>Create four examples that illustrate each of the different cases.</p></li>
</ol>
</div>
</div>
<div id="eval-basics" class="section level2">
<h2><span class="header-section-number">19.4</span> Evaluation</h2>
<p>Typically you have quoted a function argument for one of two reasons:</p>
<ul>
<li><p>You want to operate on the AST using the techniques described in the
previous chapter.</p></li>
<li><p>You want to run, or <strong>evaluate</strong> the code in a special context,
as described in depth next chapter.</p></li>
</ul>
<p>Evaluation is a rich topic, so we’ll cover it in depth in the next chapter. Here I’ll just illustrate the most important ideas.</p>
<p>The most important base R function is <code>base::eval()</code>. Its first argument is the expression to evalute:</p>
<div class="sourceCode" id="cb748"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb748-1" data-line-number="1">ru5 &lt;-<span class="st"> </span><span class="kw">expr</span>(<span class="kw">runif</span>(<span class="dv">5</span>))</a>
<a class="sourceLine" id="cb748-2" data-line-number="2">ru5</a>
<a class="sourceLine" id="cb748-3" data-line-number="3"><span class="co">#&gt; runif(5)</span></a>
<a class="sourceLine" id="cb748-4" data-line-number="4"></a>
<a class="sourceLine" id="cb748-5" data-line-number="5"><span class="kw">eval</span>(ru5)</a>
<a class="sourceLine" id="cb748-6" data-line-number="6"><span class="co">#&gt; [1] 0.0808 0.8343 0.6008 0.1572 0.0074</span></a>
<a class="sourceLine" id="cb748-7" data-line-number="7"><span class="kw">eval</span>(ru5)</a>
<a class="sourceLine" id="cb748-8" data-line-number="8"><span class="co">#&gt; [1] 0.466 0.498 0.290 0.733 0.773</span></a></code></pre></div>
<p>Note that every time we evaluate this expression we get a different result.</p>
<p>The second argument to <code>eval()</code> is the environment in which the expression is evaluated. Manipulating this environment gives us amazing power to control the execution of R code. This is the basic technique that gives dbplyr the ability to turn R code into SQL.</p>
<div class="sourceCode" id="cb749"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb749-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">9</span></a>
<a class="sourceLine" id="cb749-2" data-line-number="2">fx &lt;-<span class="st"> </span><span class="kw">expr</span>(<span class="kw">f</span>(x))</a>
<a class="sourceLine" id="cb749-3" data-line-number="3"></a>
<a class="sourceLine" id="cb749-4" data-line-number="4"><span class="kw">eval</span>(fx, <span class="kw">env</span>(<span class="dt">f =</span> <span class="cf">function</span>(x) x <span class="op">*</span><span class="st"> </span><span class="dv">10</span>))</a>
<a class="sourceLine" id="cb749-5" data-line-number="5"><span class="co">#&gt; [1] 90</span></a>
<a class="sourceLine" id="cb749-6" data-line-number="6"><span class="kw">eval</span>(fx, <span class="kw">env</span>(<span class="dt">f =</span> <span class="cf">function</span>(x) x <span class="op">^</span><span class="st"> </span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb749-7" data-line-number="7"><span class="co">#&gt; [1] 81</span></a></code></pre></div>
</div>
<div id="unquotation" class="section level2">
<h2><span class="header-section-number">19.5</span> Unquotation</h2>
<p>Evaluation is a developer tool: in combination with quoting, it allows the author of a function to capture an argument and evaluate it in a special way. Unquoting is related to evaluation, but it’s a user tool: it allows the person calling the function to selectively evaluate parts of the expression that would otherwise be quoted.</p>
<div id="with-rlang-1" class="section level3">
<h3><span class="header-section-number">19.5.1</span> With rlang</h3>
<p>All quoting functions in rlang (<code>expr()</code>, <code>enexpr()</code>, and friends) support unquoting with <code>!!</code> (called “unquote”, and pronounced bang-bang) and <code>!!!</code> (called “unquote-splice”, and pronounced bang-bang-bang). They both replace nodes in the AST. <code>!!</code> is a one-to-one replacement. It takes a single expression and inlines the AST at the location of the <code>!!</code>.</p>
<div class="sourceCode" id="cb750"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb750-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">expr</span>(a <span class="op">+</span><span class="st"> </span>b <span class="op">+</span><span class="st"> </span>c)</a>
<a class="sourceLine" id="cb750-2" data-line-number="2"><span class="kw">expr</span>(<span class="kw">f</span>(<span class="op">!!</span>x, y))</a>
<a class="sourceLine" id="cb750-3" data-line-number="3"><span class="co">#&gt; f(a + b + c, y)</span></a></code></pre></div>
<p><img src="diagrams/expressions/bang-bang.png" style="display: block; margin: auto;" /></p>
<p><code>!!!</code> is a one-to-many replacement. It takes a list of expressions and inserts them at the location of the <code>!!!</code>:</p>
<div class="sourceCode" id="cb751"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb751-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">exprs</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dt">y =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb751-2" data-line-number="2"><span class="kw">expr</span>(<span class="kw">f</span>(<span class="op">!!!</span>x, <span class="dt">z =</span> z))</a>
<a class="sourceLine" id="cb751-3" data-line-number="3"><span class="co">#&gt; f(1, 2, 3, y = 10, z = z)</span></a></code></pre></div>
<p><img src="diagrams/expressions/bang-bang-bang.png" style="display: block; margin: auto;" /></p>
</div>
<div id="the-polite-fiction-of" class="section level3">
<h3><span class="header-section-number">19.5.2</span> The polite fiction of <code>!!</code></h3>
<p>So far we have acted as if <code>!!</code> and <code>!!!</code> are regular prefix operators like <code>+</code> , <code>-</code>, and <code>!</code>. They’re not. Instead, from R’s perspective, <code>!!</code> and <code>!!!</code> are simply the repeated application of <code>!</code>:</p>
<div class="sourceCode" id="cb752"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb752-1" data-line-number="1"><span class="op">!!</span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb752-2" data-line-number="2"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb752-3" data-line-number="3"><span class="op">!!!</span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb752-4" data-line-number="4"><span class="co">#&gt; [1] FALSE</span></a></code></pre></div>
<p><code>!!</code> and <code>!!!</code> have special behaviour inside all quoting functions powered by rlang, and the unquoting operators are given precedence similar to <code>+</code> and <code>-</code>, not <code>!</code>. We do this because the operator precedence for <code>!</code> is surprisingly low: it has lower precedence than that of the binary algebraic and logical operators. Most of the time this doesn’t matter as it is unusual to mix <code>!</code> and binary operators (e.g. you typically would not write <code>!x + y</code> or <code>!x &gt; y</code>). However, expressions like <code>!!x + !!y</code> are not uncommon when unquoting, and requiring explicit parentheses, <code>(!!x) + (!!y)</code>, feels onerous. For this reason, rlang manipulates the AST to give the unquoting operators a higher, more natural, precedence.</p>
<p>You might wonder why rlang does not use a regular function call. Indeed, early versions of rlang provided <code>UQ()</code> and <code>UQS()</code> as alternatives to <code>!!</code> and <code>!!!</code>. However, these looked like regular function calls, rather than special syntactic operators, and evoked a misleading mental model, which made them harder to use correctly. In particular, function calls only happen (lazily) at evaluation time; unquoting always happens at quotation time. We adopted <code>!!</code> and <code>!!!</code> as the best compromise: they are strong visual symbols, don’t look like existing syntax, and take over a rarely used piece of syntax. (And if for some reason you do need to doubly negate a value in a quasiquoting function, you can just add parentheses <code>!(!x)</code>.)</p>
<p>The biggest downside<a href="#fn41" class="footnote-ref" id="fnref41"><sup>41</sup></a> to using a fake operator is that you might get silent errors when misusing <code>!!</code> outside of quasiquoting functions. Most of the time this is not an issue because <code>!!</code> is typically used to unquote expressions or quosures. Since expressions are not supported by the negation operator, you will get an argument type error in this case:</p>
<div class="sourceCode" id="cb753"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb753-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">quote</span>(variable)</a>
<a class="sourceLine" id="cb753-2" data-line-number="2"><span class="op">!!</span>x</a>
<a class="sourceLine" id="cb753-3" data-line-number="3"><span class="co">#&gt; Error in !x:</span></a>
<a class="sourceLine" id="cb753-4" data-line-number="4"><span class="co">#&gt;   invalid argument type</span></a></code></pre></div>
<p>However be extra careful when unquoting numeric values that can be negated silently:</p>
<div class="sourceCode" id="cb754"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb754-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb754-2" data-line-number="2"><span class="kw">with</span>(mtcars, cyl <span class="op">+</span><span class="st"> </span><span class="op">!!</span>x)</a>
<a class="sourceLine" id="cb754-3" data-line-number="3"><span class="co">#&gt;  [1] 7 7 5 7 9 7 9 5 5 7 7 9 9 9 9 9 9 5 5 5 5 9 9 9 9 5 5 5 9 7 9 5</span></a></code></pre></div>
<p>Instead of adding the value of <code>x</code> to <code>cyl</code> as intended, we have in fact added the double negation of <code>x</code>:</p>
<div class="sourceCode" id="cb755"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb755-1" data-line-number="1"><span class="op">!</span>x</a>
<a class="sourceLine" id="cb755-2" data-line-number="2"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb755-3" data-line-number="3"><span class="op">!!</span>x</a>
<a class="sourceLine" id="cb755-4" data-line-number="4"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
</div>
<div id="unquote-base" class="section level3">
<h3><span class="header-section-number">19.5.3</span> With base R</h3>
<p>Base R has one function that implements quasiquotation: <code>bquote()</code>. It uses <code>.()</code> for unquoting:</p>
<div class="sourceCode" id="cb756"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb756-1" data-line-number="1">xyz &lt;-<span class="st"> </span><span class="kw">bquote</span>((x <span class="op">+</span><span class="st"> </span>y <span class="op">+</span><span class="st"> </span>z))</a>
<a class="sourceLine" id="cb756-2" data-line-number="2"><span class="kw">bquote</span>(<span class="op">-</span>.(xyz) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb756-3" data-line-number="3"><span class="co">#&gt; -(x + y + z)/2</span></a></code></pre></div>
<p><code>bquote()</code> is a neat function, but is not used by any other function in base R. Instead functions that quote an argument use some other technique to allow indirect specification. There are four basic forms seen in base R:</p>
<ul>
<li><p>A pair of quoting and non-quoting functions. For example, <code>$</code> has two
arguments, and the second argument is quoted. This is easier to see if you
write in prefix form: <code>mtcars$cyl</code> is equivalent to <code>`$`(mtcars, cyl)</code>.
If you want to refer to a variable indirectly, you use <code>[[</code>, as it
takes the name of a variable as a string.</p>
<div class="sourceCode" id="cb757"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb757-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">var =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb757-2" data-line-number="2">var &lt;-<span class="st"> &quot;y&quot;</span></a>
<a class="sourceLine" id="cb757-3" data-line-number="3"></a>
<a class="sourceLine" id="cb757-4" data-line-number="4">x<span class="op">$</span>var</a>
<a class="sourceLine" id="cb757-5" data-line-number="5"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb757-6" data-line-number="6">x[[var]]</a>
<a class="sourceLine" id="cb757-7" data-line-number="7"><span class="co">#&gt; [1] 2</span></a></code></pre></div>
<p><code>&lt;-</code>/<code>assign()</code> and <code>::</code>/<code>getExportedValue()</code> work similarly.</p></li>
<li><p>A pair of quoting and non-quoting arguments. For example, <code>data()</code>, <code>rm()</code>,
and <code>save()</code> allow you to provide bare variable names in <code>...</code>, or a
character vector of variable names in <code>list</code>:</p>
<div class="sourceCode" id="cb758"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb758-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb758-2" data-line-number="2"><span class="kw">rm</span>(x)</a>
<a class="sourceLine" id="cb758-3" data-line-number="3"></a>
<a class="sourceLine" id="cb758-4" data-line-number="4">y &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb758-5" data-line-number="5">vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;y&quot;</span>, <span class="st">&quot;vars&quot;</span>)</a>
<a class="sourceLine" id="cb758-6" data-line-number="6"><span class="kw">rm</span>(<span class="dt">list =</span> vars)</a></code></pre></div></li>
<li><p>An argument that controls whether a different argument is quoting or
non-quoting. For example, in <code>library()</code>, the <code>character.only</code> argument
controls the quoting behaviour of of the first argument, <code>package</code>:</p>
<div class="sourceCode" id="cb759"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb759-1" data-line-number="1"><span class="kw">library</span>(MASS)</a>
<a class="sourceLine" id="cb759-2" data-line-number="2"></a>
<a class="sourceLine" id="cb759-3" data-line-number="3">pkg &lt;-<span class="st"> &quot;MASS&quot;</span></a>
<a class="sourceLine" id="cb759-4" data-line-number="4"><span class="kw">library</span>(pkg, <span class="dt">character.only =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><code>demo()</code>, <code>detach()</code>, <code>example()</code>, and <code>require()</code> work similarly.</p></li>
<li><p>Quoting if evaluation fails. For example, the first argument to <code>help()</code>
is non-quoting if it evaluates to a string; if evaluation fails, the
first argument is quoted.</p>
<div class="sourceCode" id="cb760"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb760-1" data-line-number="1"><span class="co"># Shows help for var</span></a>
<a class="sourceLine" id="cb760-2" data-line-number="2"><span class="kw">help</span>(var)</a>
<a class="sourceLine" id="cb760-3" data-line-number="3"></a>
<a class="sourceLine" id="cb760-4" data-line-number="4">var &lt;-<span class="st"> &quot;mean&quot;</span></a>
<a class="sourceLine" id="cb760-5" data-line-number="5"><span class="co"># Shows help for mean</span></a>
<a class="sourceLine" id="cb760-6" data-line-number="6"><span class="kw">help</span>(var)</a>
<a class="sourceLine" id="cb760-7" data-line-number="7"></a>
<a class="sourceLine" id="cb760-8" data-line-number="8">var &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb760-9" data-line-number="9"><span class="co"># Shows help for var</span></a>
<a class="sourceLine" id="cb760-10" data-line-number="10"><span class="kw">help</span>(var)</a></code></pre></div>
<p><code>ls()</code>, <code>page()</code>, and <code>match.fun()</code> work similarly.</p></li>
</ul>
<p>Some quoting functions, like <code>subset()</code>, <code>transform()</code>, and <code>with()</code>, don’t have a non-quoting form. This is because they are seen as wrappers around <code>[</code> and <code>[&lt;-</code> that are only suitable for interactive use.</p>
<p>Another important class of quoting functions are the base modelling and plotting functions, which quote some of their arguments, and follow that so-called standard non-standard evaluation rules: <a href="http://developer.r-project.org/nonstandard-eval.pdf" class="uri">http://developer.r-project.org/nonstandard-eval.pdf</a>. For example, <code>lm()</code> quotes the <code>weight</code> and <code>subset</code> arguments, and when used with a formula argument, the plotting function quotes the aesthetic arguments (<code>col</code>, <code>cex</code>, etc):</p>
<div class="sourceCode" id="cb761"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb761-1" data-line-number="1"><span class="kw">palette</span>(RColorBrewer<span class="op">::</span><span class="kw">brewer.pal</span>(<span class="dv">3</span>, <span class="st">&quot;Set1&quot;</span>))</a>
<a class="sourceLine" id="cb761-2" data-line-number="2"><span class="kw">plot</span>(Sepal.Length <span class="op">~</span><span class="st"> </span>Petal.Length, <span class="dt">data =</span> iris, <span class="dt">col =</span> Species, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">cex =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="Quotation_files/figure-html/unnamed-chunk-40-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>In the next chapter, you’ll learn how to simulate unquoting for these functions using tools from rlang.</p>
</div>
<div id="non-standard-asts" class="section level3">
<h3><span class="header-section-number">19.5.4</span> Non-standard ASTs</h3>
<p>Before we continue on to the case studies, we need to discuss a couple of technical issues. You might want to skip these sections on your first read through.</p>
<p>With unquoting, it is easy to create non-standard ASTs, i.e. ASTs that contain components that are not constants, symbols, or calls. (It is also possible to create non-standard ASTs by directly manipulating the underlying objects, but it’s harder to do so accidentally.) These are valid, and occasionally useful, but their correct use is beyond the scope of this book. However, it’s important to learn about them because they can be deparsed, and hence printed, in misleading ways.</p>
<p>For example, if you inline more complex objects, their attributes are not printed. This can lead to confusing output:</p>
<div class="sourceCode" id="cb762"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb762-1" data-line-number="1">x1 &lt;-<span class="st"> </span><span class="kw">expr</span>(<span class="kw">class</span>(<span class="op">!!</span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">10</span>)))</a>
<a class="sourceLine" id="cb762-2" data-line-number="2">x1</a>
<a class="sourceLine" id="cb762-3" data-line-number="3"><span class="co">#&gt; class(list(x = 10))</span></a>
<a class="sourceLine" id="cb762-4" data-line-number="4">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="op">!!</span>x1)</a>
<a class="sourceLine" id="cb762-5" data-line-number="5"><span class="co">#&gt; █─class </span></a>
<a class="sourceLine" id="cb762-6" data-line-number="6"><span class="co">#&gt; └─&lt;inline data.frame&gt;</span></a>
<a class="sourceLine" id="cb762-7" data-line-number="7"><span class="kw">eval</span>(x1)</a>
<a class="sourceLine" id="cb762-8" data-line-number="8"><span class="co">#&gt; [1] &quot;data.frame&quot;</span></a></code></pre></div>
<p>In other cases, R will print parentheses that do not exist in the AST:</p>
<div class="sourceCode" id="cb763"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb763-1" data-line-number="1">y2 &lt;-<span class="st"> </span><span class="kw">expr</span>(<span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb763-2" data-line-number="2">x2 &lt;-<span class="st"> </span><span class="kw">expr</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="op">!!</span>y2)</a>
<a class="sourceLine" id="cb763-3" data-line-number="3">x2</a>
<a class="sourceLine" id="cb763-4" data-line-number="4"><span class="co">#&gt; 1 + (2 + 3)</span></a>
<a class="sourceLine" id="cb763-5" data-line-number="5">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="op">!!</span>x2)</a>
<a class="sourceLine" id="cb763-6" data-line-number="6"><span class="co">#&gt; █─`+` </span></a>
<a class="sourceLine" id="cb763-7" data-line-number="7"><span class="co">#&gt; ├─1 </span></a>
<a class="sourceLine" id="cb763-8" data-line-number="8"><span class="co">#&gt; └─█─`+` </span></a>
<a class="sourceLine" id="cb763-9" data-line-number="9"><span class="co">#&gt;   ├─2 </span></a>
<a class="sourceLine" id="cb763-10" data-line-number="10"><span class="co">#&gt;   └─3</span></a></code></pre></div>
<p>And finally, R will display integer sequences as if they were generated with <code>:</code>.</p>
<div class="sourceCode" id="cb764"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb764-1" data-line-number="1">x3 &lt;-<span class="st"> </span><span class="kw">expr</span>(<span class="kw">f</span>(<span class="op">!!</span><span class="kw">c</span>(1L, 2L, 3L, 4L, 5L)))</a>
<a class="sourceLine" id="cb764-2" data-line-number="2">x3</a>
<a class="sourceLine" id="cb764-3" data-line-number="3"><span class="co">#&gt; f(1:5)</span></a>
<a class="sourceLine" id="cb764-4" data-line-number="4">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="op">!!</span>x3)</a>
<a class="sourceLine" id="cb764-5" data-line-number="5"><span class="co">#&gt; █─f </span></a>
<a class="sourceLine" id="cb764-6" data-line-number="6"><span class="co">#&gt; └─&lt;inline integer&gt;</span></a></code></pre></div>
<p>In general, if you’re ever confused about what is actually in an AST, display the object with <code>lobstr::ast()</code>!</p>
</div>
<div id="missing-arguments-1" class="section level3">
<h3><span class="header-section-number">19.5.5</span> Missing arguments</h3>
<p>Occasionally it is useful to unquote a missing argument, but the naive approach doesn’t work:</p>
<div class="sourceCode" id="cb765"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb765-1" data-line-number="1">arg &lt;-<span class="st"> </span><span class="kw">missing_arg</span>()</a>
<a class="sourceLine" id="cb765-2" data-line-number="2"><span class="kw">expr</span>(<span class="kw">foo</span>(<span class="op">!!</span>arg, <span class="op">!!</span>arg))</a>
<a class="sourceLine" id="cb765-3" data-line-number="3"><span class="co">#&gt; Error in enexpr(expr):</span></a>
<a class="sourceLine" id="cb765-4" data-line-number="4"><span class="co">#&gt;   argument &quot;arg&quot; is missing, with no default</span></a></code></pre></div>
<p>You can either wrap in a list and use unquote-splice, or use the <code>maybe_missing()</code> helper:</p>
<div class="sourceCode" id="cb766"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb766-1" data-line-number="1">args &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">missing_arg</span>(), <span class="kw">missing_arg</span>())</a>
<a class="sourceLine" id="cb766-2" data-line-number="2"><span class="kw">expr</span>(<span class="kw">foo</span>(<span class="op">!!!</span>args))</a>
<a class="sourceLine" id="cb766-3" data-line-number="3"><span class="co">#&gt; foo(, )</span></a>
<a class="sourceLine" id="cb766-4" data-line-number="4"></a>
<a class="sourceLine" id="cb766-5" data-line-number="5"><span class="kw">expr</span>(<span class="kw">foo</span>(<span class="op">!!</span><span class="kw">maybe_missing</span>(arg), <span class="op">!!</span><span class="kw">maybe_missing</span>(arg)))</a>
<a class="sourceLine" id="cb766-6" data-line-number="6"><span class="co">#&gt; foo(, )</span></a></code></pre></div>
</div>
<div id="exercises-59" class="section level3">
<h3><span class="header-section-number">19.5.6</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Given the following components:</p>
<div class="sourceCode" id="cb767"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb767-1" data-line-number="1">xy &lt;-<span class="st"> </span><span class="kw">expr</span>(x <span class="op">+</span><span class="st"> </span>y)</a>
<a class="sourceLine" id="cb767-2" data-line-number="2">xz &lt;-<span class="st"> </span><span class="kw">expr</span>(x <span class="op">+</span><span class="st"> </span>z)</a>
<a class="sourceLine" id="cb767-3" data-line-number="3">yz &lt;-<span class="st"> </span><span class="kw">expr</span>(y <span class="op">+</span><span class="st"> </span>z)</a>
<a class="sourceLine" id="cb767-4" data-line-number="4">abc &lt;-<span class="st"> </span><span class="kw">exprs</span>(a, b, c)</a></code></pre></div>
<p>Use quasiquotation to construct the following calls:</p>
<div class="sourceCode" id="cb768"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb768-1" data-line-number="1">(x <span class="op">+</span><span class="st"> </span>y) <span class="op">/</span><span class="st"> </span>(y <span class="op">+</span><span class="st"> </span>z)</a>
<a class="sourceLine" id="cb768-2" data-line-number="2"><span class="op">-</span>(x <span class="op">+</span><span class="st"> </span>z) <span class="op">^</span><span class="st"> </span>(y <span class="op">+</span><span class="st"> </span>z)</a>
<a class="sourceLine" id="cb768-3" data-line-number="3">(x <span class="op">+</span><span class="st"> </span>y) <span class="op">+</span><span class="st"> </span>(y <span class="op">+</span><span class="st"> </span>z) <span class="op">-</span><span class="st"> </span>(x <span class="op">+</span><span class="st"> </span>y)</a>
<a class="sourceLine" id="cb768-4" data-line-number="4"><span class="kw">atan2</span>(x <span class="op">+</span><span class="st"> </span>y, y <span class="op">+</span><span class="st"> </span>z)</a>
<a class="sourceLine" id="cb768-5" data-line-number="5"><span class="kw">sum</span>(x <span class="op">+</span><span class="st"> </span>y, x <span class="op">+</span><span class="st"> </span>y, y <span class="op">+</span><span class="st"> </span>z)</a>
<a class="sourceLine" id="cb768-6" data-line-number="6"><span class="kw">sum</span>(a, b, c)</a>
<a class="sourceLine" id="cb768-7" data-line-number="7"><span class="kw">mean</span>(<span class="kw">c</span>(a, b, c), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb768-8" data-line-number="8"><span class="kw">foo</span>(<span class="dt">a =</span> x <span class="op">+</span><span class="st"> </span>y, <span class="dt">b =</span> y <span class="op">+</span><span class="st"> </span>z)</a></code></pre></div></li>
<li><p>Explain why both <code>!0 + !0</code> and <code>!1 + !1</code> return <code>FALSE</code> while
<code>!0 + !1</code> returns <code>TRUE</code>.</p></li>
<li><p>Base functions <code>match.fun()</code>, <code>page()</code>, and <code>ls()</code> all try to
automatically determine whether you want standard or non-standard
evaluation. Each uses a different approach. Figure out the essence
of each approach by reading the source code, then compare and contrast
the techniques.</p></li>
<li><p>The following two calls print the same, but are actually different:</p>
<div class="sourceCode" id="cb769"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb769-1" data-line-number="1">(a &lt;-<span class="st"> </span><span class="kw">expr</span>(<span class="kw">mean</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)))</a>
<a class="sourceLine" id="cb769-2" data-line-number="2"><span class="co">#&gt; mean(1:10)</span></a>
<a class="sourceLine" id="cb769-3" data-line-number="3">(b &lt;-<span class="st"> </span><span class="kw">expr</span>(<span class="kw">mean</span>(<span class="op">!!</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>))))</a>
<a class="sourceLine" id="cb769-4" data-line-number="4"><span class="co">#&gt; mean(1:10)</span></a>
<a class="sourceLine" id="cb769-5" data-line-number="5"><span class="kw">identical</span>(a, b)</a>
<a class="sourceLine" id="cb769-6" data-line-number="6"><span class="co">#&gt; [1] FALSE</span></a></code></pre></div>
<p>What’s the difference? Which one is more natural?</p></li>
</ol>
</div>
</div>
<div id="quasi-case-studies" class="section level2">
<h2><span class="header-section-number">19.6</span> Case studies</h2>
<p>To make these ideas concrete, this section contains a few smaller case studies that show how quasiquotation can be used to solve real problems. Some of the case studies also use purrr: I find the combination of quasiquotation and functional programming to be particularly elegant.</p>
<div class="sourceCode" id="cb770"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb770-1" data-line-number="1"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb770-2" data-line-number="2"><span class="kw">library</span>(dplyr)</a></code></pre></div>
<div id="map-reduce-to-generate-code" class="section level3">
<h3><span class="header-section-number">19.6.1</span> Map-reduce to generate code</h3>
<p>Quasiquotation gives us powerful tools for generating code, particularly when combined with <code>purrr::map()</code> and <code>purr::reduce()</code>. For example, assume you have a linear model specified by the following coefficients:</p>
<div class="sourceCode" id="cb771"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb771-1" data-line-number="1">intercept &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb771-2" data-line-number="2">coefs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">x1 =</span> <span class="dv">5</span>, <span class="dt">x2 =</span> <span class="dv">-4</span>)</a></code></pre></div>
<p>And you want to convert it into an expression like <code>10 + (5 * x1) + (-4 * x2)</code>. The first thing we need to do is turn the character names vector into a list of symbols. <code>rlang::syms()</code> is designed precisely for this case:</p>
<div class="sourceCode" id="cb772"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb772-1" data-line-number="1">coef_sym &lt;-<span class="st"> </span><span class="kw">syms</span>(<span class="kw">names</span>(coefs))</a>
<a class="sourceLine" id="cb772-2" data-line-number="2">coef_sym</a>
<a class="sourceLine" id="cb772-3" data-line-number="3"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb772-4" data-line-number="4"><span class="co">#&gt; x1</span></a>
<a class="sourceLine" id="cb772-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb772-6" data-line-number="6"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb772-7" data-line-number="7"><span class="co">#&gt; x2</span></a></code></pre></div>
<p>Next we need to combine each variable name with its coefficient. We can do this by combining <code>expr()</code> with <code>map2()</code>:</p>
<div class="sourceCode" id="cb773"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb773-1" data-line-number="1">summands &lt;-<span class="st"> </span><span class="kw">map2</span>(coef_sym, coefs, <span class="op">~</span><span class="st"> </span><span class="kw">expr</span>((<span class="op">!!</span>.x <span class="op">*</span><span class="st"> </span><span class="op">!!</span>.y)))</a>
<a class="sourceLine" id="cb773-2" data-line-number="2">summands</a>
<a class="sourceLine" id="cb773-3" data-line-number="3"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb773-4" data-line-number="4"><span class="co">#&gt; (x1 * 5)</span></a>
<a class="sourceLine" id="cb773-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb773-6" data-line-number="6"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb773-7" data-line-number="7"><span class="co">#&gt; (x2 * -4)</span></a></code></pre></div>
<p>In this case, the intercept is also a part of the sum, although it doesn’t involve a multiplication. We can just add it to the start of the <code>summands</code> vector:</p>
<div class="sourceCode" id="cb774"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb774-1" data-line-number="1">summands &lt;-<span class="st"> </span><span class="kw">c</span>(intercept, summands)</a>
<a class="sourceLine" id="cb774-2" data-line-number="2">summands</a>
<a class="sourceLine" id="cb774-3" data-line-number="3"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb774-4" data-line-number="4"><span class="co">#&gt; [1] 10</span></a>
<a class="sourceLine" id="cb774-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb774-6" data-line-number="6"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb774-7" data-line-number="7"><span class="co">#&gt; (x1 * 5)</span></a>
<a class="sourceLine" id="cb774-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb774-9" data-line-number="9"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb774-10" data-line-number="10"><span class="co">#&gt; (x2 * -4)</span></a></code></pre></div>
<p>Finally, we need to reduce the individual terms in to a single sum by adding the pieces together:</p>
<div class="sourceCode" id="cb775"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb775-1" data-line-number="1">eq &lt;-<span class="st"> </span><span class="kw">reduce</span>(summands, <span class="op">~</span><span class="st"> </span><span class="kw">expr</span>(<span class="op">!!</span>.x <span class="op">+</span><span class="st"> </span><span class="op">!!</span>.y))</a>
<a class="sourceLine" id="cb775-2" data-line-number="2">eq</a>
<a class="sourceLine" id="cb775-3" data-line-number="3"><span class="co">#&gt; 10 + (x1 * 5) + (x2 * -4)</span></a></code></pre></div>
<p>This map-reduce pattern is an elegant way to solve many code generation problems.</p>
<p>Once you have this expression, you could evaluate it with new data, or turn it into a function:</p>
<div class="sourceCode" id="cb776"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb776-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x1 =</span> <span class="kw">runif</span>(<span class="dv">5</span>), <span class="dt">x2 =</span> <span class="kw">runif</span>(<span class="dv">5</span>))</a>
<a class="sourceLine" id="cb776-2" data-line-number="2"><span class="kw">eval</span>(eq, df)</a>
<a class="sourceLine" id="cb776-3" data-line-number="3"><span class="co">#&gt; [1] 13.59  9.26  9.92 10.05  8.11</span></a>
<a class="sourceLine" id="cb776-4" data-line-number="4"></a>
<a class="sourceLine" id="cb776-5" data-line-number="5">args &lt;-<span class="st"> </span><span class="kw">map</span>(coefs, <span class="op">~</span><span class="st"> </span><span class="kw">missing_arg</span>())</a>
<a class="sourceLine" id="cb776-6" data-line-number="6"><span class="kw">new_function</span>(args, <span class="kw">expr</span>({<span class="op">!!</span>eq}))</a>
<a class="sourceLine" id="cb776-7" data-line-number="7"><span class="co">#&gt; function (x1, x2) </span></a>
<a class="sourceLine" id="cb776-8" data-line-number="8"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb776-9" data-line-number="9"><span class="co">#&gt;     10 + (x1 * 5) + (x2 * -4)</span></a>
<a class="sourceLine" id="cb776-10" data-line-number="10"><span class="co">#&gt; }</span></a></code></pre></div>
</div>
<div id="partition" class="section level3">
<h3><span class="header-section-number">19.6.2</span> Partition</h3>
<p>Imagine that you want to extend <code>dplyr::select()</code> to return two data frames: one with the variables you selected, and one with the variables that remain. (This problem was inspired by <a href="https://stackoverflow.com/questions/46828296/" class="uri">https://stackoverflow.com/questions/46828296/</a>.) There are plenty of ways to attack this problem, but one way is to take advantage of <code>select()'s</code> ability to negate column selection expression in order to remove those columns.</p>
<p>We can capture the inputs with quasiquotation, then invert each selection call by negating it. We start by practicing interactively with a list of variables created with <code>exprs()</code>:</p>
<div class="sourceCode" id="cb777"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb777-1" data-line-number="1">vars &lt;-<span class="st"> </span><span class="kw">exprs</span>(x, y, <span class="kw">c</span>(a, b), <span class="kw">starts_with</span>(<span class="st">&quot;x&quot;</span>))</a>
<a class="sourceLine" id="cb777-2" data-line-number="2"><span class="kw">map</span>(vars, <span class="op">~</span><span class="st"> </span><span class="kw">expr</span>(<span class="op">-!!</span>.x))</a>
<a class="sourceLine" id="cb777-3" data-line-number="3"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb777-4" data-line-number="4"><span class="co">#&gt; -x</span></a>
<a class="sourceLine" id="cb777-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb777-6" data-line-number="6"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb777-7" data-line-number="7"><span class="co">#&gt; -y</span></a>
<a class="sourceLine" id="cb777-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb777-9" data-line-number="9"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb777-10" data-line-number="10"><span class="co">#&gt; -c(a, b)</span></a>
<a class="sourceLine" id="cb777-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb777-12" data-line-number="12"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb777-13" data-line-number="13"><span class="co">#&gt; -starts_with(&quot;x&quot;)</span></a></code></pre></div>
<p>Then turn it into a function:</p>
<div class="sourceCode" id="cb778"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb778-1" data-line-number="1">partition_cols &lt;-<span class="st"> </span><span class="cf">function</span>(.data, ...) {</a>
<a class="sourceLine" id="cb778-2" data-line-number="2">  included &lt;-<span class="st"> </span><span class="kw">enexprs</span>(...)</a>
<a class="sourceLine" id="cb778-3" data-line-number="3">  excluded &lt;-<span class="st"> </span><span class="kw">map</span>(included, <span class="op">~</span><span class="st"> </span><span class="kw">expr</span>(<span class="op">-!!</span>.x))</a>
<a class="sourceLine" id="cb778-4" data-line-number="4"></a>
<a class="sourceLine" id="cb778-5" data-line-number="5">  <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb778-6" data-line-number="6">    <span class="dt">incl =</span> <span class="kw">select</span>(.data, <span class="op">!!!</span>included),</a>
<a class="sourceLine" id="cb778-7" data-line-number="7">    <span class="dt">excl =</span> <span class="kw">select</span>(.data, <span class="op">!!!</span>excluded)</a>
<a class="sourceLine" id="cb778-8" data-line-number="8">  )</a>
<a class="sourceLine" id="cb778-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb778-10" data-line-number="10"></a>
<a class="sourceLine" id="cb778-11" data-line-number="11">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x1 =</span> <span class="dv">1</span>, <span class="dt">x2 =</span> <span class="dv">3</span>, <span class="dt">y =</span> <span class="st">&quot;a&quot;</span>, <span class="dt">z =</span> <span class="st">&quot;b&quot;</span>)</a>
<a class="sourceLine" id="cb778-12" data-line-number="12"><span class="kw">partition_cols</span>(df, <span class="kw">starts_with</span>(<span class="st">&quot;x&quot;</span>))</a>
<a class="sourceLine" id="cb778-13" data-line-number="13"><span class="co">#&gt; $incl</span></a>
<a class="sourceLine" id="cb778-14" data-line-number="14"><span class="co">#&gt;   x1 x2</span></a>
<a class="sourceLine" id="cb778-15" data-line-number="15"><span class="co">#&gt; 1  1  3</span></a>
<a class="sourceLine" id="cb778-16" data-line-number="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb778-17" data-line-number="17"><span class="co">#&gt; $excl</span></a>
<a class="sourceLine" id="cb778-18" data-line-number="18"><span class="co">#&gt;   y z</span></a>
<a class="sourceLine" id="cb778-19" data-line-number="19"><span class="co">#&gt; 1 a b</span></a></code></pre></div>
<p>Note the name of the first argument: <code>.data</code>. This is a standard convention through the tidyverse because you don’t need to explicitly name this argument (because it’s always used), and it avoids potential clashes with argument names in <code>...</code>.</p>
</div>
<div id="slicing-an-array" class="section level3">
<h3><span class="header-section-number">19.6.3</span> Slicing an array</h3>
<p>One occassionally useful tool that’s missing from base R is the ability to extract a slice of an array given a dimension and an index. For example, we’d like to write <code>slice(x, 2, 1)</code> to extract the first slice along the second dimension, which you can write as <code>x[, 1, ]</code>.</p>
<p>We’ll need to generated a call will multiple missing arguments. Fortunately is easy with <code>rep()</code> and <code>missing_arg()</code>. Once we have those arguments, we can unquote-splice them into a call:</p>
<div class="sourceCode" id="cb779"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb779-1" data-line-number="1">indices &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">list</span>(<span class="kw">missing_arg</span>()), <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb779-2" data-line-number="2"><span class="kw">expr</span>(x[<span class="op">!!!</span>indices])</a>
<a class="sourceLine" id="cb779-3" data-line-number="3"><span class="co">#&gt; x[, , ]</span></a></code></pre></div>
<p>We then wrap this into a function, using subset-assignment to insert the index in the desired position:</p>
<div class="sourceCode" id="cb780"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb780-1" data-line-number="1">slice &lt;-<span class="st"> </span><span class="cf">function</span>(x, along, index) {</a>
<a class="sourceLine" id="cb780-2" data-line-number="2">  <span class="kw">stopifnot</span>(<span class="kw">length</span>(index) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb780-3" data-line-number="3">    </a>
<a class="sourceLine" id="cb780-4" data-line-number="4">  nd &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">dim</span>(x))</a>
<a class="sourceLine" id="cb780-5" data-line-number="5">  indices &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">list</span>(<span class="kw">missing_arg</span>()), nd)</a>
<a class="sourceLine" id="cb780-6" data-line-number="6">  indices[along] &lt;-<span class="st"> </span>index</a>
<a class="sourceLine" id="cb780-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb780-8" data-line-number="8">  <span class="kw">expr</span>(x[<span class="op">!!!</span>indices])</a>
<a class="sourceLine" id="cb780-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb780-10" data-line-number="10"></a>
<a class="sourceLine" id="cb780-11" data-line-number="11">x &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="kw">sample</span>(<span class="dv">30</span>), <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb780-12" data-line-number="12"><span class="kw">slice</span>(x, <span class="dv">1</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb780-13" data-line-number="13"><span class="co">#&gt; x[3, , ]</span></a>
<a class="sourceLine" id="cb780-14" data-line-number="14"><span class="kw">slice</span>(x, <span class="dv">2</span>, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb780-15" data-line-number="15"><span class="co">#&gt; x[, 2, ]</span></a>
<a class="sourceLine" id="cb780-16" data-line-number="16"><span class="kw">slice</span>(x, <span class="dv">3</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb780-17" data-line-number="17"><span class="co">#&gt; x[, , 1]</span></a></code></pre></div>
<p>A real <code>slice()</code> would evaluate the generated call, but here I think it’s more illuminating to see the code that’s generated, as that’s the hard part of the challenge.</p>
</div>
<div id="quasi-function" class="section level3">
<h3><span class="header-section-number">19.6.4</span> Creating functions</h3>
<p>Another powerful function to use in combination with unquoting is <code>rlang::new_function()</code>: it allows us to create a function by supplying the arguments, the body, and (optionally) the environment:</p>
<div class="sourceCode" id="cb781"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb781-1" data-line-number="1"><span class="kw">new_function</span>(</a>
<a class="sourceLine" id="cb781-2" data-line-number="2">  <span class="kw">exprs</span>(<span class="dt">x =</span> , <span class="dt">y =</span> ), </a>
<a class="sourceLine" id="cb781-3" data-line-number="3">  <span class="kw">expr</span>({x <span class="op">+</span><span class="st"> </span>y})</a>
<a class="sourceLine" id="cb781-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb781-5" data-line-number="5"><span class="co">#&gt; function (x, y) </span></a>
<a class="sourceLine" id="cb781-6" data-line-number="6"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb781-7" data-line-number="7"><span class="co">#&gt;     x + y</span></a>
<a class="sourceLine" id="cb781-8" data-line-number="8"><span class="co">#&gt; }</span></a></code></pre></div>
<p>One application is to create functions that work like <code>graphics::curve()</code>. <code>curve()</code> allows you to plot a mathematical expression, without creating a function:</p>
<div class="sourceCode" id="cb782"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb782-1" data-line-number="1"><span class="kw">curve</span>(<span class="kw">sin</span>(<span class="kw">exp</span>(<span class="dv">4</span> <span class="op">*</span><span class="st"> </span>x)), <span class="dt">n =</span> <span class="dv">1000</span>)</a></code></pre></div>
<p><img src="Quotation_files/figure-html/curve-demo-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Here <code>x</code> is a pronoun. As with <code>.</code> in pipelines and <code>.x</code> and <code>.y</code> in purrr functionals, <code>x</code> doesn’t represent a single concrete value, but is instead a placeholder that varies over the range of the plot. Functions, like <code>curve()</code>, that use an expression containing a pronoun are known as <strong>anaphoric</strong> functions<a href="#fn42" class="footnote-ref" id="fnref42"><sup>42</sup></a>.</p>
<p> </p>
<p>One way to implement <code>curve()</code> is to turn the expression into a function with a single argument, then call that function:</p>
<div class="sourceCode" id="cb783"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb783-1" data-line-number="1">curve2 &lt;-<span class="st"> </span><span class="cf">function</span>(expr, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">n =</span> <span class="dv">100</span>) {</a>
<a class="sourceLine" id="cb783-2" data-line-number="2">  expr &lt;-<span class="st"> </span><span class="kw">enexpr</span>(expr)</a>
<a class="sourceLine" id="cb783-3" data-line-number="3">  f &lt;-<span class="st"> </span><span class="kw">new_function</span>(<span class="kw">exprs</span>(<span class="dt">x =</span> ), expr)</a>
<a class="sourceLine" id="cb783-4" data-line-number="4">  </a>
<a class="sourceLine" id="cb783-5" data-line-number="5">  x &lt;-<span class="st"> </span><span class="kw">seq</span>(xlim[<span class="dv">1</span>], xlim[<span class="dv">2</span>], <span class="dt">length =</span> n)</a>
<a class="sourceLine" id="cb783-6" data-line-number="6">  y &lt;-<span class="st"> </span><span class="kw">f</span>(x)</a>
<a class="sourceLine" id="cb783-7" data-line-number="7"></a>
<a class="sourceLine" id="cb783-8" data-line-number="8">  <span class="kw">plot</span>(x, y, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">ylab =</span> <span class="kw">expr_text</span>(expr))</a>
<a class="sourceLine" id="cb783-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb783-10" data-line-number="10"><span class="kw">curve2</span>(<span class="kw">sin</span>(<span class="kw">exp</span>(<span class="dv">4</span> <span class="op">*</span><span class="st"> </span>x)), <span class="dt">n =</span> <span class="dv">1000</span>)</a></code></pre></div>
<p>Another use for <code>new_function()</code> is as an alternative to simple function factories and function operators. The primary advantage is that the generated functions have readable source code:</p>
<div class="sourceCode" id="cb784"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb784-1" data-line-number="1">negate1 &lt;-<span class="st"> </span><span class="cf">function</span>(f) {</a>
<a class="sourceLine" id="cb784-2" data-line-number="2">  <span class="kw">force</span>(f)</a>
<a class="sourceLine" id="cb784-3" data-line-number="3">  <span class="cf">function</span>(...) <span class="op">!</span><span class="kw">f</span>(...)</a>
<a class="sourceLine" id="cb784-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb784-5" data-line-number="5"><span class="kw">negate1</span>(is.null)</a>
<a class="sourceLine" id="cb784-6" data-line-number="6"><span class="co">#&gt; function(...) !f(...)</span></a>
<a class="sourceLine" id="cb784-7" data-line-number="7"><span class="co">#&gt; &lt;environment: 0x7ff0488e96b8&gt;</span></a>
<a class="sourceLine" id="cb784-8" data-line-number="8"></a>
<a class="sourceLine" id="cb784-9" data-line-number="9">negate2 &lt;-<span class="st"> </span><span class="cf">function</span>(f) {</a>
<a class="sourceLine" id="cb784-10" data-line-number="10">  f &lt;-<span class="st"> </span><span class="kw">enexpr</span>(f)</a>
<a class="sourceLine" id="cb784-11" data-line-number="11">  <span class="kw">new_function</span>(<span class="kw">exprs</span>(<span class="dt">... =</span> ), <span class="kw">expr</span>(<span class="op">!</span>(<span class="op">!!</span>f)(...)), <span class="kw">caller_env</span>())</a>
<a class="sourceLine" id="cb784-12" data-line-number="12">}</a>
<a class="sourceLine" id="cb784-13" data-line-number="13"><span class="kw">negate2</span>(is.null)</a>
<a class="sourceLine" id="cb784-14" data-line-number="14"><span class="co">#&gt; function (...) </span></a>
<a class="sourceLine" id="cb784-15" data-line-number="15"><span class="co">#&gt; !is.null(...)</span></a></code></pre></div>
<p>Note that this is often useful if the higher order function have arguments that are expressions: inlining more complex objects into the AST can yield confusing source code.</p>
</div>
<div id="exercises-60" class="section level3">
<h3><span class="header-section-number">19.6.5</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Implement <code>arrange_desc()</code>, a variant of <code>dplyr::arrange()</code> that sorts
in descending order by default.</p></li>
<li><p>Implement <code>filter_or()</code>, a variant of <code>dplyr::filter()</code> that combines
multiple arguments using <code>|</code> instead of <code>&amp;</code>.</p></li>
<li><p>Implement <code>partition_rows()</code> which, like <code>partition_cols()</code>, returns two
data frames, one containing the selected rows, and the other containing
the rows that weren’t selected.</p></li>
<li><p>Add error handling to <code>slice()</code>. Give clear error messages if either
<code>along</code> or <code>index</code> have invalid values (i.e. not numeric, not length 1,
too small, or too big).</p></li>
<li><p>Re-implement the Box-Cox transform defined below using unquoting and
<code>new_function()</code>:</p>
<div class="sourceCode" id="cb785"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb785-1" data-line-number="1">bc &lt;-<span class="st"> </span><span class="cf">function</span>(lambda) {</a>
<a class="sourceLine" id="cb785-2" data-line-number="2">  <span class="cf">if</span> (lambda <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb785-3" data-line-number="3">    <span class="cf">function</span>(x) <span class="kw">log</span>(x)</a>
<a class="sourceLine" id="cb785-4" data-line-number="4">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb785-5" data-line-number="5">    <span class="cf">function</span>(x) (x <span class="op">^</span><span class="st"> </span>lambda <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span>lambda</a>
<a class="sourceLine" id="cb785-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb785-7" data-line-number="7">}</a></code></pre></div></li>
<li><p>Re-implement the simple <code>compose()</code> defined below using quasiquotation and
<code>new_function()</code>:</p>
<div class="sourceCode" id="cb786"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb786-1" data-line-number="1">compose &lt;-<span class="st"> </span><span class="cf">function</span>(f, g) {</a>
<a class="sourceLine" id="cb786-2" data-line-number="2">  <span class="cf">function</span>(...) <span class="kw">f</span>(<span class="kw">g</span>(...))</a>
<a class="sourceLine" id="cb786-3" data-line-number="3">}</a></code></pre></div></li>
</ol>
</div>
</div>
<div id="dot-dot-dot-..." class="section level2">
<h2><span class="header-section-number">19.7</span> Dot-dot-dot (<code>...</code>)</h2>
<p>Quasiquotation ensures that every quoted argument has an escape hatch that allows the user to unquote, or evaluate, selected components, if needed. A similar and related need arises with functions that take arbitrary additional arguments with <code>...</code>. Take the following two motivating problems:</p>
<ul>
<li><p>What do you do if the elements you want to put in <code>...</code> are already stored
in a list? For example, imagine you have a list of data frames that
you want to <code>rbind()</code> together:</p>
<div class="sourceCode" id="cb787"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb787-1" data-line-number="1">dfs &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb787-2" data-line-number="2">  <span class="dt">a =</span> <span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb787-3" data-line-number="3">  <span class="dt">b =</span> <span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">3</span>, <span class="dt">y =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb787-4" data-line-number="4">)</a></code></pre></div>
<p>You could solve this specific case with <code>rbind(dfs$a, df$b)</code>, but how
do you generalise that solution to a list of arbitrary length?</p></li>
<li><p>What do you do if you want to supply the argument name indirectly? For
example, imagine you want to create a single column data frame where
the name of the column is specified in a variable:</p>
<div class="sourceCode" id="cb788"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb788-1" data-line-number="1">var &lt;-<span class="st"> &quot;x&quot;</span></a>
<a class="sourceLine" id="cb788-2" data-line-number="2">val &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">9</span>)</a></code></pre></div>
<p>In this case, you could create a data frame and then change names
(i.e. <code>setNames(data.frame(val), var)</code>), but this feels inelegant.
How can we do better?</p></li>
</ul>
<div id="do.call" class="section level3">
<h3><span class="header-section-number">19.7.1</span> <code>do.call()</code></h3>
<p>Base R provides a swiss-army knife to solve these problems: <code>do.call()</code>. <code>do.call()</code> has two main arguments. The first argument, <code>what</code>, gives a function to call. The second argument, <code>args</code>, is a list of arguments to pass to that function, and so <code>do.call(&quot;f&quot;, list(x, y, z))</code> is equivalent to <code>f(x, y, z)</code>.</p>
<ul>
<li><p><code>do.call()</code> gives a straightforward solution to <code>rbind()</code>ing together many
data frames:</p>
<div class="sourceCode" id="cb789"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb789-1" data-line-number="1"><span class="kw">do.call</span>(<span class="st">&quot;rbind&quot;</span>, dfs)</a>
<a class="sourceLine" id="cb789-2" data-line-number="2"><span class="co">#&gt;   x y</span></a>
<a class="sourceLine" id="cb789-3" data-line-number="3"><span class="co">#&gt; a 1 2</span></a>
<a class="sourceLine" id="cb789-4" data-line-number="4"><span class="co">#&gt; b 3 4</span></a></code></pre></div></li>
<li><p>With a little more work, we can use <code>do.call()</code> to solve the second problem.
We first create a list of arguments, then name that, then use <code>do.call()</code>:</p>
<div class="sourceCode" id="cb790"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb790-1" data-line-number="1">args &lt;-<span class="st"> </span><span class="kw">list</span>(val)</a>
<a class="sourceLine" id="cb790-2" data-line-number="2"><span class="kw">names</span>(args) &lt;-<span class="st"> </span>var</a>
<a class="sourceLine" id="cb790-3" data-line-number="3"></a>
<a class="sourceLine" id="cb790-4" data-line-number="4"><span class="kw">do.call</span>(<span class="st">&quot;data.frame&quot;</span>, args)</a>
<a class="sourceLine" id="cb790-5" data-line-number="5"><span class="co">#&gt;   x</span></a>
<a class="sourceLine" id="cb790-6" data-line-number="6"><span class="co">#&gt; 1 4</span></a>
<a class="sourceLine" id="cb790-7" data-line-number="7"><span class="co">#&gt; 2 3</span></a>
<a class="sourceLine" id="cb790-8" data-line-number="8"><span class="co">#&gt; 3 9</span></a></code></pre></div></li>
</ul>
</div>
<div id="the-tidyverse-approach" class="section level3">
<h3><span class="header-section-number">19.7.2</span> The tidyverse approach</h3>
<p>The tidyverse solves these problems in a different way to base R, by drawing parallel to quasiquotation:</p>
<ul>
<li><p>Row-binding multiple data frames is like unquote-splicing: we want to inline
individual elements of the list into the call:</p>
<div class="sourceCode" id="cb791"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb791-1" data-line-number="1">dplyr<span class="op">::</span><span class="kw">bind_rows</span>(<span class="op">!!!</span>dfs)</a>
<a class="sourceLine" id="cb791-2" data-line-number="2"><span class="co">#&gt;   x y</span></a>
<a class="sourceLine" id="cb791-3" data-line-number="3"><span class="co">#&gt; 1 1 2</span></a>
<a class="sourceLine" id="cb791-4" data-line-number="4"><span class="co">#&gt; 2 3 4</span></a></code></pre></div>
<p>When used in this context, the behaviour of <code>!!!</code> is known as spatting in
Ruby, Go, PHP, and Julia. It is closely related to <code>*args</code> (star-args) and
<code>**kwarg</code> (star-star-kwargs) in Python, which are sometimes called argument
unpacking.</p></li>
<li><p>The second problem is like unquoting on the LHS of <code>=</code>: rather than
interpreting <code>var</code> literaly, we want to use the value stored in the variable
called <code>var</code>:</p>
<div class="sourceCode" id="cb792"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb792-1" data-line-number="1">tibble<span class="op">::</span><span class="kw">tibble</span>(<span class="op">!!</span>var <span class="op">:</span><span class="er">=</span><span class="st"> </span>val)</a>
<a class="sourceLine" id="cb792-2" data-line-number="2"><span class="co">#&gt; # A tibble: 3 x 1</span></a>
<a class="sourceLine" id="cb792-3" data-line-number="3"><span class="co">#&gt;       x</span></a>
<a class="sourceLine" id="cb792-4" data-line-number="4"><span class="co">#&gt;   &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb792-5" data-line-number="5"><span class="co">#&gt; 1     4</span></a>
<a class="sourceLine" id="cb792-6" data-line-number="6"><span class="co">#&gt; 2     3</span></a>
<a class="sourceLine" id="cb792-7" data-line-number="7"><span class="co">#&gt; 3     9</span></a></code></pre></div>
<p>Note the use of <code>:=</code> (pronounced colon-equals) rather than <code>=</code>. Unfortunately
we need this new operation because R’s grammar does not allow expressions as
argument names:</p>
<div class="sourceCode" id="cb793"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb793-1" data-line-number="1">tibble<span class="op">::</span><span class="kw">tibble</span>(<span class="op">!!</span><span class="dt">var =</span> value)</a>
<a class="sourceLine" id="cb793-2" data-line-number="2"><span class="co">#&gt; Error: unexpected &#39;=&#39; in &quot;tibble::tibble(!!var =&quot;</span></a></code></pre></div>
<p><code>:=</code> is like a vestigial organ: it’s recognised by R’s parser, but it doesn’t
have any code associated with it. It looks like an <code>=</code> but allows
expressions on either side, making it a more flexible alternative to <code>=</code>.
It is used in data.table for similar reasons.</p></li>
</ul>
</div>
<div id="list2" class="section level3">
<h3><span class="header-section-number">19.7.3</span> <code>list2()</code></h3>
<p>Both <code>dplyr::bind_rows()</code> and <code>tibble::tibble()</code> are powered by <code>rlang::list2(...)</code>. This function is very similar to <code>list(...)</code>, but it understands <code>!!!</code> and <code>!!</code>. If you want to take advantage of this behaviour in your own function, all you need to do is use <code>list2()</code> in your own code. For example, imagine you want to make a version of <code>structure()</code> that understands <code>!!!</code> and <code>!!</code>. We’ll call it <code>set_attr()</code>:</p>
<div class="sourceCode" id="cb794"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb794-1" data-line-number="1">set_attr &lt;-<span class="st"> </span><span class="cf">function</span>(.x, ...) {</a>
<a class="sourceLine" id="cb794-2" data-line-number="2">  attr &lt;-<span class="st"> </span>rlang<span class="op">::</span><span class="kw">list2</span>(...)</a>
<a class="sourceLine" id="cb794-3" data-line-number="3">  <span class="kw">attributes</span>(.x) &lt;-<span class="st"> </span>attr</a>
<a class="sourceLine" id="cb794-4" data-line-number="4">  .x</a>
<a class="sourceLine" id="cb794-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb794-6" data-line-number="6"></a>
<a class="sourceLine" id="cb794-7" data-line-number="7">attrs &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb794-8" data-line-number="8">attr_name &lt;-<span class="st"> &quot;z&quot;</span></a>
<a class="sourceLine" id="cb794-9" data-line-number="9"></a>
<a class="sourceLine" id="cb794-10" data-line-number="10"><span class="dv">1</span><span class="op">:</span><span class="dv">10</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb794-11" data-line-number="11"><span class="st">  </span><span class="kw">set_attr</span>(<span class="dt">w =</span> <span class="dv">0</span>, <span class="op">!!!</span>attrs, <span class="op">!!</span>attr_name <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb794-12" data-line-number="12"><span class="st">  </span><span class="kw">str</span>()</a>
<a class="sourceLine" id="cb794-13" data-line-number="13"><span class="co">#&gt;  int [1:10] 1 2 3 4 5 6 7 8 9 10</span></a>
<a class="sourceLine" id="cb794-14" data-line-number="14"><span class="co">#&gt;  - attr(*, &quot;w&quot;)= num 0</span></a>
<a class="sourceLine" id="cb794-15" data-line-number="15"><span class="co">#&gt;  - attr(*, &quot;x&quot;)= num 1</span></a>
<a class="sourceLine" id="cb794-16" data-line-number="16"><span class="co">#&gt;  - attr(*, &quot;y&quot;)= num 2</span></a>
<a class="sourceLine" id="cb794-17" data-line-number="17"><span class="co">#&gt;  - attr(*, &quot;z&quot;)= num 3</span></a></code></pre></div>
<p>(rlang also provides a <code>set_attr()</code> function with a few extra conveniences, but the essence is the same.)</p>
<p>Note that we call the first argument <code>.x</code>: whenever you use <code>...</code> to take arbitrary data, it’s good practice to give the other argument names a <code>.</code> prefix. This eliminates any ambiguity about who owns the argument, and in this case makes it possible to set the <code>x</code> attribute.</p>
<p><code>list2()</code> provides one other handy feature: by default it will ignore any empty arguments at the end. This is useful in functions like <code>tibble::tibble()</code> because it means that you can easily change the order of variables without worrying about the final comma:</p>
<div class="sourceCode" id="cb795"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb795-1" data-line-number="1"><span class="co"># Can easily move x to first entry:</span></a>
<a class="sourceLine" id="cb795-2" data-line-number="2">tibble<span class="op">::</span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb795-3" data-line-number="3">  <span class="dt">y =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb795-4" data-line-number="4">  <span class="dt">z =</span> <span class="dv">3</span><span class="op">:-</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb795-5" data-line-number="5">  <span class="dt">x =</span> <span class="dv">5</span><span class="op">:</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb795-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb795-7" data-line-number="7"></a>
<a class="sourceLine" id="cb795-8" data-line-number="8"><span class="co"># Need to remove comma from z and add comma to x</span></a>
<a class="sourceLine" id="cb795-9" data-line-number="9"><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb795-10" data-line-number="10">  <span class="dt">y =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb795-11" data-line-number="11">  <span class="dt">z =</span> <span class="dv">3</span><span class="op">:-</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb795-12" data-line-number="12">  <span class="dt">x =</span> <span class="dv">5</span><span class="op">:</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb795-13" data-line-number="13">)</a></code></pre></div>
<p>As well as <code>list2()</code>, rlang also provides <code>lgl()</code>, <code>int()</code>, <code>dbl()</code>, and <code>chr()</code> which create atomic vectors in the same way.</p>
</div>
<div id="application-invoke-and-lang" class="section level3">
<h3><span class="header-section-number">19.7.4</span> Application: <code>invoke()</code> and <code>lang()</code></h3>
<p>One useful application of <code>list2()</code> is <code>invoke()</code>:</p>
<div class="sourceCode" id="cb796"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb796-1" data-line-number="1">invoke &lt;-<span class="st"> </span><span class="cf">function</span>(.f, ...) {</a>
<a class="sourceLine" id="cb796-2" data-line-number="2">  <span class="kw">do.call</span>(.f, <span class="kw">list2</span>(...), <span class="dt">envir =</span> <span class="kw">parent.frame</span>())</a>
<a class="sourceLine" id="cb796-3" data-line-number="3">}</a></code></pre></div>
<p>(At time of writing, both <code>purrr::invoke()</code> and <code>rlang::invoke()</code> have somewhat different definitions because they were written before we understood how quasiquotation syntax and <code>...</code> intersected.)</p>
<p>As a wrapper around <code>do.call()</code>, <code>invoke()</code> gives powerful ways to call functions with arguments supplied directly (in …) or indirectly (in a list):</p>
<div class="sourceCode" id="cb797"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb797-1" data-line-number="1"><span class="kw">invoke</span>(<span class="st">&quot;mean&quot;</span>, <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb797-2" data-line-number="2"></a>
<a class="sourceLine" id="cb797-3" data-line-number="3"><span class="co"># Equivalent to</span></a>
<a class="sourceLine" id="cb797-4" data-line-number="4">x &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb797-5" data-line-number="5"><span class="kw">invoke</span>(<span class="st">&quot;mean&quot;</span>, <span class="op">!!!</span>x)</a></code></pre></div>
<p>It also allows us to specify argument names indirectly:</p>
<div class="sourceCode" id="cb798"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb798-1" data-line-number="1">arg_name &lt;-<span class="st"> &quot;na.rm&quot;</span></a>
<a class="sourceLine" id="cb798-2" data-line-number="2">arg_val &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb798-3" data-line-number="3"><span class="kw">invoke</span>(<span class="st">&quot;mean&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="op">!!</span>arg_name <span class="op">:</span><span class="er">=</span><span class="st"> </span>arg_val)</a></code></pre></div>
<p>Closely related to <code>invoke()</code> is <code>rlang::call2()</code>. It constructs a call from its components:</p>
<div class="sourceCode" id="cb799"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb799-1" data-line-number="1"><span class="kw">call2</span>(<span class="st">&quot;mean&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="op">!!</span>arg_name <span class="op">:</span><span class="er">=</span><span class="st"> </span>arg_val)</a>
<a class="sourceLine" id="cb799-2" data-line-number="2"><span class="co">#&gt; mean(1:10, na.rm = TRUE)</span></a></code></pre></div>
<p>The chief advantage of <code>call2()</code> over <code>expr()</code> is that it can use <code>:=</code>.</p>
</div>
<div id="other-approaches" class="section level3">
<h3><span class="header-section-number">19.7.5</span> Other approaches</h3>
<p>Apart from <code>rlang::list2()</code> there are several other techniques used to overcome the motivating challenges described above. One technique is to take <code>...</code> and a single unnamed argument that is a list, making <code>f(list(x, y, z))</code> equivalent to <code>f(x, y, z)</code>. The implementation looks something like this:</p>
<div class="sourceCode" id="cb800"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb800-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>(...) {</a>
<a class="sourceLine" id="cb800-2" data-line-number="2">  dots &lt;-<span class="st"> </span><span class="kw">list</span>(...)</a>
<a class="sourceLine" id="cb800-3" data-line-number="3">  <span class="cf">if</span> (<span class="kw">length</span>(dots) <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">is.list</span>(dots[[<span class="dv">1</span>]])) {</a>
<a class="sourceLine" id="cb800-4" data-line-number="4">    dots &lt;-<span class="st"> </span>dots[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb800-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb800-6" data-line-number="6">  </a>
<a class="sourceLine" id="cb800-7" data-line-number="7">  <span class="co"># Do something</span></a>
<a class="sourceLine" id="cb800-8" data-line-number="8">  ...</a>
<a class="sourceLine" id="cb800-9" data-line-number="9">}</a></code></pre></div>
<p>Base functions that use this technique include <code>interaction()</code>, <code>expand.grid()</code>, <code>options()</code>, and <code>par()</code>. Since these functions take either a list or <code>...</code>, but not both, they are slightly less flexible than functions powered by <code>list2()</code>.</p>
<p>Another related technique is used in the <code>RCurl::getURL()</code> function written by Duncan Temple Lang. <code>getURL()</code> take both <code>...</code> and <code>.opts</code> which are concatenated together. This is useful when writing functions to call web APIs because you often have some options that need to be passed to every request. You put these in a common list and pass to <code>.opts</code>, saving <code>...</code> for the options unique for a given call.</p>
<p>I found this technique particularly compelling so you can see it used throughout the tidyverse. Now, however, <code>rlang::list2()</code> dots solves more problems, more elegantly, by using the ideas from tidy eval. The tidyverse is slowly migrating to <code>list2()</code> style for all functions that take <code>...</code>.</p>
</div>
<div id="exercises-61" class="section level3">
<h3><span class="header-section-number">19.7.6</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Carefully read the source code for <code>interaction()</code>, <code>expand.grid()</code>, and
<code>par()</code>. Compare and contrast the techniques they use for switching
between dots and list behaviour.</p></li>
<li><p>Explain the problem with this definition of <code>set_attr()</code></p>
<div class="sourceCode" id="cb801"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb801-1" data-line-number="1">set_attr &lt;-<span class="st"> </span><span class="cf">function</span>(x, ...) {</a>
<a class="sourceLine" id="cb801-2" data-line-number="2">  attr &lt;-<span class="st"> </span>rlang<span class="op">::</span><span class="kw">list2</span>(...)</a>
<a class="sourceLine" id="cb801-3" data-line-number="3">  <span class="kw">attributes</span>(x) &lt;-<span class="st"> </span>attr</a>
<a class="sourceLine" id="cb801-4" data-line-number="4">  x</a>
<a class="sourceLine" id="cb801-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb801-6" data-line-number="6"><span class="kw">set_attr</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">x =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb801-7" data-line-number="7"><span class="co">#&gt; Error in attributes(x) &lt;- attr:</span></a>
<a class="sourceLine" id="cb801-8" data-line-number="8"><span class="co">#&gt;   attributes must be named</span></a></code></pre></div></li>
</ol>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-lumley-2001">
<p>Lumley, Thomas. 2001. “Programmer’s Niche: Macros in R.” <em>R News</em> 1 (3): 11–13. <a href="https://www.r-project.org/doc/Rnews/Rnews_2001-3.pdf" class="uri">https://www.r-project.org/doc/Rnews/Rnews_2001-3.pdf</a>.</p>
</div>
<div id="ref-bawden-1999">
<p>Bawden, Alan. 1999. “Quasiquotation in Lisp.” In <em>PEPM ’99</em>, 4–12. <a href="http://repository.readscheme.org/ftp/papers/pepm99/bawden.pdf" class="uri">http://repository.readscheme.org/ftp/papers/pepm99/bawden.pdf</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="40">
<li id="fn40"><p>You might be familiar with the name Quine from “quines”, computer programs that when run return a copy of their own source code.<a href="quasiquotation.html#fnref40" class="footnote-back">↩</a></p></li>
<li id="fn41"><p>Prior to R 3.5.1, there was another major downside: the R deparser was treating <code>!!x</code> as <code>!(!x)</code>. This is why in old versions of R you might see extra parentheses when printing tidyeval functions at the console. The good news is that these parentheses are not real and can be safely ignored most of the time. The bad news is that they will become real if you reparse that printed output to R code. These roundtripped functions will not work as expected since <code>!(!x)</code> does not unquote anything.<a href="quasiquotation.html#fnref41" class="footnote-back">↩</a></p></li>
<li id="fn42"><p>Anaphoric comes from the linguistics term “anaphora”, an expression that is context dependent. Anaphoric functions are found in <a href="http://www.arcfn.com/doc/anaphoric.html">Arc</a> (a LISP like language), <a href="http://www.perlmonks.org/index.pl?node_id=666047">Perl</a>, and <a href="http://amalloy.hubpages.com/hub/Unhygenic-anaphoric-Clojure-macros-for-fun-and-profit">Clojure</a>.<a href="quasiquotation.html#fnref42" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="expressions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="evaluation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/hadley/adv-r/edit/master/Quotation.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
